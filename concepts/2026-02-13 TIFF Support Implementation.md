# TIFF/TIF Support for File Analyzer

**Date:** 2026-02-13  
**Status:** Implemented  
**Issue:** TIF/TIFF Support for Analyse

## Problem Statement

Enterprise customers have tons of TIF/TIFF files, which often have been generated by OCR systems. These customers want to use the file analyzer with their TIF/TIFF files.

## Research Findings

### LLM Provider Support for TIFF

We researched the native TIFF support across major LLM providers:

| Provider | TIFF Support | Supported Formats |
|----------|--------------|-------------------|
| **OpenAI GPT-4 Vision** | ❌ NO | JPEG, PNG, WebP, GIF |
| **Anthropic Claude** | ❌ NO | JPEG, PNG, GIF, WebP |
| **Google Gemini** | ✅ YES | JPEG, PNG, GIF, BMP, WebP, RAW, ICO, PDF, **TIFF** |
| **Mistral Vision** | ❌ NO | JPEG, PNG, GIF, WebP |

**Key Finding:** Only Google Gemini natively supports TIFF format.

## Solution Implemented

### Approach

Since Google Gemini natively supports TIFF, and other providers do not, we implemented a client-side solution that:

1. **Accepts TIFF files** - Added `image/tiff` and `image/tif` MIME types to supported formats
2. **Automatic conversion** - Leverages existing image processing pipeline that converts all images to JPEG when resizing is enabled
3. **Browser compatibility** - Uses HTML5 Canvas API which can read TIFF files (with browser support)

### Technical Implementation

The existing `ImageUploader` component already converts all uploaded images to JPEG format when `resizeImages` is enabled (default: true). This means:

- **For Gemini models**: TIFF files are converted to JPEG, which Gemini supports (no functionality loss)
- **For other models**: TIFF files are converted to JPEG, enabling compatibility with OpenAI, Anthropic, and Mistral
- **Performance**: Images are resized to max 1024px dimension and compressed to 80% JPEG quality
- **File size**: Reduces file size for faster uploads and processing

### Changes Made

1. **File Processing Utilities** (`client/src/features/upload/utils/fileProcessing.js`):
   - Added TIFF MIME types to `MIME_TO_EXTENSION` mapping
   - Added TIFF file type display support

2. **Configuration Updates**:
   - `server/defaults/apps/file-analysis.json` - Added TIFF to supported formats
   - `examples/apps/file-analysis.json` - Added TIFF to supported formats

### Code Locations

- **Image Processing**: `client/src/features/upload/components/ImageUploader.jsx`
  - Lines 22-83: `processImage()` function handles TIFF conversion
  - Line 62: Converts to JPEG via `canvas.toDataURL('image/jpeg', 0.8)`
  
- **MIME Type Mappings**: `client/src/features/upload/utils/fileProcessing.js`
  - Lines 52-84: `MIME_TO_EXTENSION` object
  - Lines 102-148: `getFileTypeDisplay()` function

- **App Configuration**: 
  - `server/defaults/apps/file-analysis.json`
  - `examples/apps/file-analysis.json`

## Browser Compatibility

Modern browsers (Chrome, Firefox, Safari, Edge) have native support for rendering TIFF images in the `<img>` tag and Canvas API, which enables:
- Direct TIFF file reading
- Canvas-based conversion to JPEG
- No additional libraries required

**Note**: Older browsers may require polyfills or server-side conversion, but this is not currently implemented as modern browsers are sufficient for enterprise use cases.

## Testing Recommendations

1. **Upload TIFF files** to the File Analyzer app
2. **Verify conversion** - Check that images are properly displayed in preview
3. **Test with different models**:
   - Google Gemini (native TIFF support, but converted to JPEG)
   - OpenAI GPT-4 Vision (converted to JPEG)
   - Anthropic Claude (converted to JPEG)
4. **Test file sizes** - Verify TIFF files are properly compressed
5. **Test multi-page TIFF** - Note: Only first page is converted (Canvas limitation)

## Future Enhancements

1. **Multi-page TIFF support** - Extract all pages from multi-page TIFF files
2. **Server-side conversion** - For browsers without native TIFF support
3. **Direct TIFF upload for Gemini** - Bypass conversion for Gemini models to preserve quality
4. **TIFF metadata extraction** - Extract and display EXIF/metadata from TIFF files

## References

- [OpenAI Vision API Documentation](https://platform.openai.com/docs/guides/vision)
- [Anthropic Claude Vision Documentation](https://platform.claude.com/docs/en/build-with-claude/vision)
- [Google Gemini Image Understanding](https://ai.google.dev/gemini-api/docs/image-understanding)
- [Canvas API Documentation](https://developer.mozilla.org/en-US/docs/Web/API/Canvas_API)
