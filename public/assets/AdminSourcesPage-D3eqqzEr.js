import{u as U,j as e,I as i}from"./index-BImwYGvy.js";import{e as _,r as d}from"./vendor-react-9AdXaApd.js";import{A as T}from"./AdminAuth-DlQsuewr.js";import{A as E}from"./AdminNavigation-BmtWl3vA.js";import{m as h}from"./adminApi-ChCbw-zB.js";import"./mermaid-DechTdnA.js";import"./vendor-utils-CF1RCcgi.js";import"./teams-CwMtNG0x.js";import"./vendor-ui-lZiltAcz.js";import"./vendor-forms-DyVXvDXu.js";const Z=()=>{const{t}=U(),f=_(),[l,g]=d.useState([]),[O,w]=d.useState(!0),[v,c]=d.useState(null),[p,D]=d.useState(""),[j,F]=d.useState("all"),[y,$]=d.useState("all"),[x,o]=d.useState(new Set),[b,S]=d.useState(!1),[N,k]=d.useState(null);d.useEffect(()=>{C()},[]);const C=async()=>{try{w(!0),c(null);const s=await h("/admin/sources"),a=Array.isArray(s)?s:(s==null?void 0:s.data)||[];g(a)}catch(s){console.error("Failed to load sources:",s),c(s.message||"Failed to load sources")}finally{w(!1)}},m=Array.isArray(l)?l.filter(s=>{const a=!p||Object.values(s.name||{}).some(u=>u.toLowerCase().includes(p.toLowerCase()))||s.id.toLowerCase().includes(p.toLowerCase()),r=j==="all"||s.type===j,n=y==="all"||y==="enabled"&&s.enabled!==!1||y==="disabled"&&s.enabled===!1;return a&&r&&n}):[],L=async s=>{try{const r=!(Array.isArray(l)?l.find(n=>n.id===s):null).enabled;await h("/admin/sources/_toggle",{method:"POST",body:JSON.stringify({sourceIds:[s],enabled:r})}),g(n=>n.map(u=>u.id===s?{...u,enabled:r}:u))}catch(a){c(a.message)}},A=async s=>{try{S(!0);const a=Array.from(x);await h("/admin/sources/_toggle",{method:"POST",body:JSON.stringify({sourceIds:a,enabled:s})}),g(r=>r.map(n=>a.includes(n.id)?{...n,enabled:s}:n)),o(new Set)}catch(a){c(a.message)}finally{S(!1)}},P=async s=>{try{k(s);const a=await h(`/admin/sources/${s}/test`,{method:"POST"});a.success?alert(`Source test successful:
${JSON.stringify(a.result,null,2)}`):alert(`Source test failed: ${a.error}`)}catch(a){alert(`Source test failed: ${a.message}`)}finally{k(null)}},B=async s=>{if(window.confirm(t("admin.sources.deleteConfirm","Are you sure you want to delete this source?")))try{await h(`/admin/sources/${s}`,{method:"DELETE"}),g(a=>a.filter(r=>r.id!==s)),o(a=>{const r=new Set(a);return r.delete(s),r})}catch(a){a.message.includes("dependencies")?alert(t("admin.sources.deleteDependencies","Cannot delete source: it is used by other apps.")):c(a.message)}},z=(s,a)=>{o(r=>{const n=new Set(r);return a?n.add(s):n.delete(s),n})},J=s=>{const a=s.enabled!==!1;return e.jsx("span",{className:`px-2 py-1 text-xs font-medium rounded-full ${a?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:a?t("common.enabled","Enabled"):t("common.disabled","Disabled")})},R=s=>{const a={filesystem:"bg-blue-100 text-blue-800",url:"bg-purple-100 text-purple-800",ifinder:"bg-orange-100 text-orange-800"};return e.jsx("span",{className:`px-2 py-1 text-xs font-medium rounded-full ${a[s]||"bg-gray-100 text-gray-800"}`,children:s})};return O?e.jsx(T,{children:e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx(E,{}),e.jsx("div",{className:"max-w-7xl mx-auto py-6 px-4",children:e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsxs("div",{className:"text-center",children:[e.jsx(i,{name:"arrow-path",className:"animate-spin h-8 w-8 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500",children:t("common.loading","Loading...")})]})})})]})}):e.jsx(T,{children:e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx(E,{}),e.jsxs("div",{className:"max-w-7xl mx-auto py-6 px-4",children:[e.jsx("div",{className:"mb-8",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-semibold text-gray-900 flex items-center",children:[e.jsx(i,{name:"database",className:"h-6 w-6 mr-2"}),t("admin.navigation.sources","Sources")]}),e.jsx("p",{className:"text-gray-600 mt-1",children:t("admin.sources.description","Manage data sources for your applications")})]}),e.jsxs("button",{onClick:()=>f("/admin/sources/new"),className:"bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 rounded-lg font-medium flex items-center",children:[e.jsx(i,{name:"plus",className:"h-4 w-4 mr-2"}),t("admin.sources.createNew","Create Source")]})]})}),v&&e.jsx("div",{className:"mb-6 bg-red-50 border border-red-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(i,{name:"x-circle",className:"h-5 w-5 text-red-400 mr-2"}),e.jsx("p",{className:"text-red-800",children:v}),e.jsx("button",{onClick:()=>c(null),className:"ml-auto text-red-600 hover:text-red-800",children:e.jsx(i,{name:"x-mark",className:"h-4 w-4"})})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow-sm p-6 mb-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:t("admin.sources.search","Search")}),e.jsxs("div",{className:"relative",children:[e.jsx(i,{name:"magnifying-glass",className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx("input",{type:"text",value:p,onChange:s=>D(s.target.value),placeholder:t("admin.sources.searchPlaceholder","Search sources..."),className:"pl-10 w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:t("admin.sources.filterType","Type")}),e.jsxs("select",{value:j,onChange:s=>F(s.target.value),className:"w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500",children:[e.jsx("option",{value:"all",children:t("admin.sources.allTypes","All Types")}),e.jsx("option",{value:"filesystem",children:t("admin.sources.filesystem","Filesystem")}),e.jsx("option",{value:"url",children:t("admin.sources.url","URL")}),e.jsx("option",{value:"ifinder",children:t("admin.sources.ifinder","iFinder")})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:t("admin.sources.filterStatus","Status")}),e.jsxs("select",{value:y,onChange:s=>$(s.target.value),className:"w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500",children:[e.jsx("option",{value:"all",children:t("admin.sources.allStatuses","All Statuses")}),e.jsx("option",{value:"enabled",children:t("common.enabled","Enabled")}),e.jsx("option",{value:"disabled",children:t("common.disabled","Disabled")})]})]}),e.jsx("div",{className:"flex items-end",children:e.jsxs("button",{onClick:C,className:"bg-gray-100 hover:bg-gray-200 text-gray-700 px-4 py-2 rounded-lg font-medium flex items-center",children:[e.jsx(i,{name:"arrow-path",className:"h-4 w-4 mr-2"}),t("common.refresh","Refresh")]})})]})}),x.size>0&&e.jsx("div",{className:"bg-indigo-50 border border-indigo-200 rounded-lg p-4 mb-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(i,{name:"check-circle",className:"h-5 w-5 text-indigo-600 mr-2"}),e.jsx("span",{className:"text-indigo-800 font-medium",children:t("admin.sources.selectedCount","{{count}} sources selected",{count:x.size})})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:()=>A(!0),disabled:b,className:"bg-green-600 hover:bg-green-700 disabled:opacity-50 text-white px-3 py-1 rounded text-sm font-medium",children:b?t("common.processing","Processing..."):t("admin.sources.enableSelected","Enable")}),e.jsx("button",{onClick:()=>A(!1),disabled:b,className:"bg-red-600 hover:bg-red-700 disabled:opacity-50 text-white px-3 py-1 rounded text-sm font-medium",children:b?t("common.processing","Processing..."):t("admin.sources.disableSelected","Disable")}),e.jsx("button",{onClick:()=>o(new Set),className:"bg-gray-500 hover:bg-gray-600 text-white px-3 py-1 rounded text-sm font-medium",children:t("common.clearSelection","Clear")})]})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow-sm overflow-hidden",children:m.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(i,{name:"database",className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:(Array.isArray(l)?l.length:0)===0?t("admin.sources.noSources","No sources configured"):t("admin.sources.noFilteredSources","No sources match your filters")}),e.jsx("p",{className:"text-gray-500 mb-4",children:(Array.isArray(l)?l.length:0)===0?t("admin.sources.createFirstSource","Create your first source to get started"):t("admin.sources.adjustFilters","Try adjusting your search and filters")}),(Array.isArray(l)?l.length:0)===0&&e.jsx("button",{onClick:()=>f("/admin/sources/new"),className:"bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 rounded-lg font-medium",children:t("admin.sources.createNew","Create Source")})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left",children:e.jsx("input",{type:"checkbox",checked:x.size===m.length&&m.length>0,onChange:s=>{s.target.checked?o(new Set(m.map(a=>a.id))):o(new Set)},className:"h-4 w-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500"})}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:t("admin.sources.name","Name")}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:t("admin.sources.type","Type")}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:t("admin.sources.status","Status")}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:t("admin.sources.updated","Updated")}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:t("admin.sources.actions","Actions")})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:m.map(s=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("input",{type:"checkbox",checked:x.has(s.id),onChange:a=>z(s.id,a.target.checked),className:"h-4 w-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:Object.values(s.name||{})[0]||s.id}),e.jsx("div",{className:"text-sm text-gray-500 font-mono",children:s.id}),s.description&&Object.values(s.description)[0]&&e.jsx("div",{className:"text-xs text-gray-400 mt-1",children:Object.values(s.description)[0]})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:R(s.type)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:J(s)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:s.updated?new Date(s.updated).toLocaleDateString():"-"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:e.jsxs("div",{className:"flex items-center justify-end space-x-2",children:[e.jsx("button",{onClick:()=>P(s.id),disabled:N===s.id,className:"text-indigo-600 hover:text-indigo-900 disabled:opacity-50",title:t("admin.sources.testSource","Test Source"),children:e.jsx(i,{name:N===s.id?"arrow-path":"beaker",className:`h-4 w-4 ${N===s.id?"animate-spin":""}`})}),e.jsx("button",{onClick:()=>f(`/admin/sources/${s.id}`),className:"text-gray-600 hover:text-gray-900",title:t("admin.sources.editSource","Edit Source"),children:e.jsx(i,{name:"pencil",className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>L(s.id),className:`${s.enabled!==!1?"text-red-600 hover:text-red-900":"text-green-600 hover:text-green-900"}`,title:s.enabled!==!1?t("common.disable","Disable"):t("common.enable","Enable"),children:e.jsx(i,{name:s.enabled!==!1?"eye-slash":"eye",className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>B(s.id),className:"text-red-600 hover:text-red-900",title:t("admin.sources.deleteSource","Delete Source"),children:e.jsx(i,{name:"trash",className:"h-4 w-4"})})]})})]},s.id))})]})})}),e.jsx("div",{className:"mt-6 text-center text-sm text-gray-500",children:t("admin.sources.summary","Showing {{filtered}} of {{total}} sources",{filtered:m.length,total:Array.isArray(l)?l.length:0})})]})]})})};export{Z as default};
