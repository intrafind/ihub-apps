import{u as R,j as e,I as S,L as P}from"./index-BImwYGvy.js";import{r as m,u as q,e as F}from"./vendor-react-9AdXaApd.js";import{A}from"./AdminAuth-DlQsuewr.js";import{A as I}from"./AdminNavigation-BmtWl3vA.js";import{D as M}from"./DualModeEditor-DudKIsvj.js";import{R as D}from"./ResourceSelector-BCe_WFe3.js";import{i as G,v as O,e as L}from"./schemaValidation-BmW9IFx4.js";import{m as T}from"./adminApi-ChCbw-zB.js";import{g as $}from"./schemaService-CVoZgOcb.js";import"./mermaid-DechTdnA.js";import"./vendor-utils-CF1RCcgi.js";import"./teams-CwMtNG0x.js";import"./vendor-ui-lZiltAcz.js";import"./vendor-forms-DyVXvDXu.js";import"./monaco-CCrBizaJ.js";const B=({value:a,onChange:r,onValidationChange:g,resources:c={apps:[],models:[],prompts:[]},jsonSchema:d})=>{var b,v,w,k;const{t:i}=R(),[l,j]=m.useState({}),y=s=>{let n={};if(d){const h=O(s,d);h.isValid||(n=L(h.errors))}else s.id?/^[a-zA-Z0-9_-]+$/.test(s.id)||(n.id=i("admin.groups.validation.idInvalid","Group ID can only contain letters, numbers, hyphens, and underscores")):n.id=i("admin.groups.validation.idRequired","Group ID is required"),s.name||(n.name=i("admin.groups.validation.nameRequired","Group name is required"));j(n);const o=Object.keys(n).length===0;return g&&g({isValid:o,errors:Object.entries(n).map(([h,t])=>({field:h,message:t,severity:"error"}))}),o};m.useEffect(()=>{a&&y(a)},[a]);const u=(s,n)=>{const o={...a,[s]:n};r(o)},x=(s,n)=>{const o={...a,permissions:{...a.permissions,[s]:n}};r(o)},E=s=>{const n=s.split(",").map(o=>o.trim()).filter(o=>o.length>0);u("mappings",n)},N=s=>["admin","user","anonymous","authenticated"].includes(s);return a?e.jsxs("div",{className:"group-form-editor space-y-6",children:[e.jsx("div",{className:"bg-white shadow px-4 py-5 sm:rounded-lg sm:p-6",children:e.jsxs("div",{className:"md:grid md:grid-cols-3 md:gap-6",children:[e.jsxs("div",{className:"md:col-span-1",children:[e.jsx("h3",{className:"text-lg font-medium leading-6 text-gray-900",children:i("admin.groups.basicInformation","Basic Information")}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:i("admin.groups.basicGroupConfiguration","Basic group configuration and metadata")})]}),e.jsx("div",{className:"mt-5 md:col-span-2 md:mt-0",children:e.jsxs("div",{className:"grid grid-cols-6 gap-6",children:[e.jsxs("div",{className:"col-span-6 sm:col-span-3",children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700",children:[i("admin.groups.groupId","Group ID"),G("id",d)&&e.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),e.jsx("input",{type:"text",required:G("id",d),value:a.id||"",onChange:s=>u("id",s.target.value),disabled:N(a.id),className:`mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm disabled:bg-gray-100 ${l.id?"border-red-300":""}`,placeholder:"Enter unique group ID"}),l.id&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:l.id}),N(a.id)&&e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:i("admin.groups.protectedSystemGroup","This is a protected system group")})]}),e.jsxs("div",{className:"col-span-6 sm:col-span-3",children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700",children:[i("admin.groups.groupName","Group Name"),G("name",d)&&e.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),e.jsx("input",{type:"text",required:G("name",d),value:a.name||"",onChange:s=>u("name",s.target.value),className:`mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm ${l.name?"border-red-300":""}`,placeholder:"Enter group display name"}),l.name&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:l.name})]}),e.jsxs("div",{className:"col-span-6",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:i("admin.groups.description","Description")}),e.jsx("textarea",{value:a.description||"",onChange:s=>u("description",s.target.value),rows:3,className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm",placeholder:"Enter group description"})]}),e.jsxs("div",{className:"col-span-6",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:((b=a.permissions)==null?void 0:b.adminAccess)||!1,onChange:s=>x("adminAccess",s.target.checked),className:"h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded"}),e.jsx("label",{className:"ml-2 block text-sm text-gray-900",children:i("admin.groups.adminAccess","Admin Access")})]}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Allow members of this group to access administrative functions"})]}),e.jsx("div",{className:"col-span-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:a.enabled!==!1,onChange:s=>u("enabled",s.target.checked),className:"h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded"}),e.jsx("label",{className:"ml-2 block text-sm text-gray-900",children:i("admin.groups.enabled","Enabled")})]})})]})})]})}),e.jsx("div",{className:"bg-white shadow px-4 py-5 sm:rounded-lg sm:p-6",children:e.jsxs("div",{className:"md:grid md:grid-cols-3 md:gap-6",children:[e.jsxs("div",{className:"md:col-span-1",children:[e.jsx("h3",{className:"text-lg font-medium leading-6 text-gray-900",children:"External Group Mappings"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"Map external groups from OIDC, LDAP, or other providers to this internal group"})]}),e.jsx("div",{className:"mt-5 md:col-span-2 md:mt-0",children:e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"External Group Names (comma-separated)"}),e.jsx("input",{type:"text",value:(a.mappings||[]).join(", "),onChange:s=>E(s.target.value),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm",placeholder:"IT-Admin, Platform-Admins, HR-Team"}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Enter external group names that should be mapped to this group. Users with these external groups will automatically be assigned to this internal group."})]})})]})}),e.jsx("div",{className:"bg-white shadow px-4 py-5 sm:rounded-lg sm:p-6",children:e.jsxs("div",{className:"md:grid md:grid-cols-3 md:gap-6",children:[e.jsxs("div",{className:"md:col-span-1",children:[e.jsx("h3",{className:"text-lg font-medium leading-6 text-gray-900",children:i("admin.groups.permissions","Permissions")}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"Configure which apps, models, and prompts members of this group can access"})]}),e.jsx("div",{className:"mt-5 md:col-span-2 md:mt-0",children:e.jsxs("div",{className:"space-y-6",children:[e.jsx(D,{label:"Apps",resources:c.apps,selectedResources:((v=a.permissions)==null?void 0:v.apps)||[],onSelectionChange:s=>x("apps",s),placeholder:"Search apps to add...",emptyMessage:"No apps selected - users won't see any apps"}),e.jsx(D,{label:"Models",resources:c.models,selectedResources:((w=a.permissions)==null?void 0:w.models)||[],onSelectionChange:s=>x("models",s),placeholder:"Search models to add...",emptyMessage:"No models selected - users can't use any AI models"}),e.jsx(D,{label:"Prompts",resources:c.prompts,selectedResources:((k=a.permissions)==null?void 0:k.prompts)||[],onSelectionChange:s=>x("prompts",s),placeholder:"Search prompts to add...",emptyMessage:"No prompts selected - users can't access any prompt templates"})]})})]})})]}):e.jsxs("div",{className:"p-8 text-center text-gray-500",children:[e.jsx(S,{name:"exclamation-triangle",className:"h-12 w-12 mx-auto mb-4 text-gray-400"}),e.jsx("p",{className:"text-lg font-medium",children:i("admin.groups.edit.noGroupData","No group data available")})]})},te=()=>{const{t:a}=R(),{groupId:r}=q(),g=F(),[c,d]=m.useState(null),[i,l]=m.useState(!0),[j,y]=m.useState(!1),[u,x]=m.useState(null),[E,N]=m.useState({apps:[],models:[],prompts:[]}),[b,v]=m.useState(null);m.useEffect(()=>{w(),k(),r==="new"?(d({id:"",name:"",description:"",permissions:{apps:[],prompts:[],models:[],adminAccess:!1},mappings:[],enabled:!0}),l(!1)):s()},[r]);const w=async()=>{try{const p=(await T("/admin/groups/resources")).data;N(p)}catch(t){console.error("Failed to load resources:",t)}},k=async()=>{try{const t=await $("group");v(t)}catch(t){console.error("Failed to load group schema:",t)}},s=m.useCallback(async()=>{try{l(!0);const f=(await T("/admin/groups")).data.groups[r];if(!f)throw new Error("Group not found");d(f)}catch(t){x(t.message)}finally{l(!1)}},[r]),n=async t=>{if(t||(t=c),!t.id||!t.name){x("Group ID and name are required");return}try{y(!0);const p=r==="new"?"POST":"PUT",f=r==="new"?"/admin/groups":`/admin/groups/${r}`,C=await T(f,{method:p,headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});g("/admin/groups")}catch(p){throw x(p.message),p}finally{y(!1)}},o=t=>{d(t)},h=async t=>{t.preventDefault(),await n(c)};return i?e.jsxs(A,{children:[e.jsx(I,{}),e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsx(P,{size:"lg"})})]}):u?e.jsxs(A,{children:[e.jsx(I,{}),e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-md p-4",children:e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx(S,{name:"warning",size:"md",className:"text-red-400"})}),e.jsxs("div",{className:"ml-3",children:[e.jsx("h3",{className:"text-sm font-medium text-red-800",children:"Error"}),e.jsx("div",{className:"mt-2 text-sm text-red-700",children:u})]})]})})})]}):e.jsxs(A,{children:[e.jsx(I,{}),e.jsxs("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[e.jsx("div",{className:"mb-8",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-semibold text-gray-900",children:r==="new"?a("admin.groups.edit.createTitle","Create New Group"):a("admin.groups.edit.editTitle","Edit Group")}),e.jsx("p",{className:"mt-1 text-sm text-gray-600",children:r==="new"?a("admin.groups.edit.createDesc","Create a new user group with permissions and external mappings"):a("admin.groups.edit.editDesc","Edit group settings, permissions, and external mappings")})]}),e.jsxs("div",{className:"flex space-x-3",children:[r!=="new"&&e.jsxs("button",{type:"button",onClick:()=>{const t=JSON.stringify(c,null,2),p="data:application/json;charset=utf-8,"+encodeURIComponent(t),f=`group-${c.id}.json`,C=document.createElement("a");C.setAttribute("href",p),C.setAttribute("download",f),C.click()},className:"inline-flex items-center px-4 py-2 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500",children:[e.jsx(S,{name:"download",className:"h-4 w-4 mr-2"}),a("common.download")]}),e.jsxs("button",{onClick:()=>g("/admin/groups"),className:"inline-flex items-center px-4 py-2 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500",children:[e.jsx(S,{name:"arrow-left",className:"h-4 w-4 mr-2"}),a("admin.groups.edit.backToList","Back to Groups")]})]})]})}),e.jsxs("form",{onSubmit:h,className:"space-y-8",children:[e.jsx(M,{value:c,onChange:o,formComponent:B,formProps:{resources:E,jsonSchema:b},jsonSchema:b,title:r==="new"?a("admin.groups.edit.createTitle","Create New Group"):a("admin.groups.edit.editTitle","Edit Group")}),e.jsxs("div",{className:"flex justify-end space-x-4",children:[e.jsx("button",{type:"button",onClick:()=>g("/admin/groups"),className:"px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500",children:a("admin.groups.edit.cancel","Cancel")}),e.jsx("button",{type:"submit",disabled:j,className:"px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 disabled:opacity-50",children:j?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2 inline-block"}),a("admin.groups.edit.saving","Saving...")]}):a("admin.groups.edit.save",r==="new"?"Create Group":"Save Group")})]})]})]})]})};export{te as default};
