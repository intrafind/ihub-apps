import{u as I,c as A,j as e,I as t}from"./index-BImwYGvy.js";import{f as R,e as C,r as d}from"./vendor-react-9AdXaApd.js";import"./mermaid-DechTdnA.js";import"./vendor-utils-CF1RCcgi.js";import"./teams-CwMtNG0x.js";import"./vendor-ui-lZiltAcz.js";import"./vendor-forms-DyVXvDXu.js";const L=()=>{var u,j,p,f,y;const{t:J}=I(),{user:c}=A(),x=R(),m=C(),[r,h]=d.useState({}),[N,g]=d.useState(!1),[i,a]=d.useState(null);d.useEffect(()=>{const o=new URLSearchParams(x.search),s=o.get("jira_connected"),n=o.get("jira_error");s==="true"?(a({type:"success",text:"JIRA account connected successfully! You can now use JIRA features in your apps."}),m("/settings/integrations",{replace:!0})):n&&(a({type:"error",text:`JIRA connection failed: ${decodeURIComponent(n)}`}),m("/settings/integrations",{replace:!0}))},[x.search,m]),d.useEffect(()=>{(async()=>{if(c!=null&&c.id){g(!0);try{const n=await(await fetch("/api/integrations/jira/status",{credentials:"include"})).json();h(l=>({...l,jira:n}))}catch(s){console.error("Error loading integrations:",s)}finally{g(!1)}}})()},[c==null?void 0:c.id]);const b=async o=>{try{const s=await fetch("/api/integrations/jira/auth",{credentials:"include",redirect:"manual"});if(s.type==="opaqueredirect"||s.status===302||s.status===301)window.location.href="/api/integrations/jira/auth";else if(!s.ok){const n=await s.json().catch(()=>({message:"Unknown error"}));a({type:"error",text:`Connection failed: ${n.message||"Unknown error"}`})}}catch(s){a({type:"error",text:`Connection failed: ${s.message}`})}},w=async o=>{try{(await fetch("/api/integrations/jira/disconnect",{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"}})).ok&&(h(n=>({...n,jira:{connected:!1,message:"JIRA account disconnected"}})),a({type:"success",text:"JIRA account disconnected successfully"}))}catch(s){a({type:"error",text:`Failed to disconnect JIRA: ${s.message}`})}},v=async o=>{var s;try{const l=await(await fetch("/api/integrations/jira/test",{credentials:"include"})).json();l.success?a({type:"success",text:`JIRA connection test successful! Found ${((s=l.testResults)==null?void 0:s.accessibleTickets)||0} accessible tickets.`}):a({type:"error",text:`JIRA connection test failed: ${l.message}`})}catch(n){a({type:"error",text:`JIRA connection test failed: ${n.message}`})}},k=()=>{a(null)};return c?e.jsx("div",{className:"min-h-screen bg-gray-50 py-6",children:e.jsx("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"bg-white shadow rounded-lg",children:[e.jsx("div",{className:"px-6 py-4 border-b border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Integrations"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Connect your external accounts to enhance your AI applications"})]}),e.jsx(t,{name:"link",className:"w-8 h-8 text-blue-600"})]})}),i&&e.jsx("div",{className:`px-6 py-4 border-b border-gray-200 ${i.type==="success"?"bg-green-50 border-green-200":"bg-red-50 border-red-200"}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(t,{name:i.type==="success"?"check-circle":"warning",className:`w-5 h-5 mr-2 ${i.type==="success"?"text-green-600":"text-red-600"}`}),e.jsx("span",{className:i.type==="success"?"text-green-800":"text-red-800",children:i.text})]}),e.jsx("button",{onClick:k,className:`p-1 rounded-full hover:bg-opacity-20 ${i.type==="success"?"hover:bg-green-600 text-green-600":"hover:bg-red-600 text-red-600"}`,children:e.jsx(t,{name:"x",className:"w-4 h-4"})})]})}),e.jsx("div",{className:"p-6",children:N?e.jsxs("div",{className:"flex items-center justify-center py-8",children:[e.jsx(t,{name:"spinner",className:"w-8 h-8 animate-spin text-blue-600"}),e.jsx("span",{className:"ml-3 text-gray-600",children:"Loading integrations..."})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"border border-gray-200 rounded-lg p-6",children:e.jsxs("div",{className:"flex items-start space-x-4",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("div",{className:"w-12 h-12 bg-blue-600 rounded-lg flex items-center justify-center",children:e.jsx(t,{name:"ticket",className:"w-7 h-7 text-white"})})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"JIRA"}),e.jsx("p",{className:"text-gray-600 text-sm",children:"Atlassian JIRA integration for ticket management and project insights"})]}),e.jsx("div",{className:"flex items-center",children:e.jsx("span",{className:`px-3 py-1 text-xs font-medium rounded-full ${(u=r.jira)!=null&&u.connected?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"}`,children:(j=r.jira)!=null&&j.connected?"Connected":"Not Connected"})})]}),((p=r.jira)==null?void 0:p.connected)&&r.jira.userInfo&&e.jsx("div",{className:"mt-3 p-3 bg-gray-50 rounded-md",children:e.jsxs("div",{className:"flex items-center text-sm text-gray-700",children:[e.jsx(t,{name:"user",className:"w-4 h-4 mr-2"}),e.jsx("span",{className:"font-medium",children:r.jira.userInfo.displayName}),e.jsxs("span",{className:"ml-2 text-gray-500",children:["(",r.jira.userInfo.emailAddress,")"]})]})}),e.jsx("div",{className:"mt-4 flex items-center space-x-3",children:(f=r.jira)!=null&&f.connected?e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>v(),className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-md font-medium transition-colors flex items-center",children:[e.jsx(t,{name:"check-circle",className:"w-4 h-4 mr-2"}),"Test Connection"]}),e.jsxs("button",{onClick:()=>w(),className:"bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-md font-medium transition-colors flex items-center",children:[e.jsx(t,{name:"x-circle",className:"w-4 h-4 mr-2"}),"Disconnect"]})]}):e.jsxs("button",{onClick:()=>b(),className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-md font-medium transition-colors flex items-center",children:[e.jsx(t,{name:"link",className:"w-4 h-4 mr-2"}),"Connect JIRA Account"]})}),((y=r.jira)==null?void 0:y.connected)&&e.jsxs("div",{className:"mt-3",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-900 mb-2",children:"Available Features:"}),e.jsxs("ul",{className:"text-sm text-gray-700 space-y-1",children:[e.jsxs("li",{className:"flex items-center",children:[e.jsx(t,{name:"check",className:"w-4 h-4 text-green-500 mr-2 flex-shrink-0"}),"Search and retrieve JIRA tickets"]}),e.jsxs("li",{className:"flex items-center",children:[e.jsx(t,{name:"check",className:"w-4 h-4 text-green-500 mr-2 flex-shrink-0"}),"Create new tickets and issues"]}),e.jsxs("li",{className:"flex items-center",children:[e.jsx(t,{name:"check",className:"w-4 h-4 text-green-500 mr-2 flex-shrink-0"}),"Update existing tickets"]}),e.jsxs("li",{className:"flex items-center",children:[e.jsx(t,{name:"check",className:"w-4 h-4 text-green-500 mr-2 flex-shrink-0"}),"Get project and user information"]})]})]})]})]})}),e.jsxs("div",{className:"border border-dashed border-gray-300 rounded-lg p-6 text-center",children:[e.jsx(t,{name:"plus",className:"w-8 h-8 text-gray-400 mx-auto mb-2"}),e.jsx("h3",{className:"text-lg font-medium text-gray-500 mb-1",children:"More Integrations Coming Soon"}),e.jsx("p",{className:"text-gray-400 text-sm",children:"We're working on adding more integrations to enhance your AI applications"})]})]})})]})})}):e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(t,{name:"lock",className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Authentication Required"}),e.jsx("p",{className:"text-gray-600",children:"Please log in to manage your integrations."})]})})};export{L as default};
