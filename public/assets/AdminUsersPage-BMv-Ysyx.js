import{j as e,L as S,I as r}from"./index-BImwYGvy.js";import{e as U,r as c}from"./vendor-react-9AdXaApd.js";import{A as u}from"./AdminAuth-DlQsuewr.js";import{A as g}from"./AdminNavigation-BmtWl3vA.js";import{m as o}from"./adminApi-ChCbw-zB.js";import"./mermaid-DechTdnA.js";import"./vendor-utils-CF1RCcgi.js";import"./teams-CwMtNG0x.js";import"./vendor-ui-lZiltAcz.js";import"./vendor-forms-DyVXvDXu.js";const P=()=>{const m=U(),[f,y]=c.useState(!0),[p,j]=c.useState([]),[n,i]=c.useState(""),[l,h]=c.useState("");c.useEffect(()=>{d()},[]);const d=async()=>{try{const t=(await o("/admin/auth/users")).data,a=Object.values(t.users||{});j(a)}catch(s){i({type:"error",text:`Failed to load users: ${s.message}`})}finally{y(!1)}},N=async s=>{if(window.confirm("Are you sure you want to delete this user?"))try{const t=await o(`/admin/auth/users/${s}`,{method:"DELETE"});i({type:"success",text:"User deleted successfully!"}),d()}catch(t){i({type:"error",text:`Failed to delete user: ${t.message}`})}},b=async s=>{const t=!s.active;try{const a=await o(`/admin/auth/users/${s.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:s.email,name:s.name,internalGroups:s.internalGroups||[],active:t})});i({type:"success",text:`User ${t?"enabled":"disabled"} successfully!`}),d()}catch(a){i({type:"error",text:`Failed to update user status: ${a.message}`})}},v=()=>{h("")},x=p.filter(s=>{if(!l)return!0;const t=l.toLowerCase(),a=(s.name||"").toLowerCase(),w=(s.username||"").toLowerCase(),k=(s.email||"").toLowerCase(),A=(s.internalGroups||[]).join(" ").toLowerCase(),C=(s.authMethods||["local"]).join(" ").toLowerCase();return a.includes(t)||w.includes(t)||k.includes(t)||A.includes(t)||C.includes(t)});return f?e.jsxs(u,{children:[e.jsx(g,{}),e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsx(S,{size:"lg"})})]}):e.jsxs(u,{children:[e.jsx(g,{}),e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx("div",{className:"bg-white shadow-sm border-b border-gray-200",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"User Management"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Manage local authentication users and their permissions"})]}),e.jsxs("button",{onClick:()=>m("/admin/users/new"),className:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:[e.jsx(r,{name:"plus",size:"md",className:"mr-2"}),"Add User"]})]})})}),e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[n&&e.jsx("div",{className:`mb-6 p-4 rounded-md ${n.type==="success"?"bg-green-50 border border-green-200":"bg-red-50 border border-red-200"}`,children:e.jsxs("div",{className:"flex",children:[e.jsx(r,{name:n.type==="success"?"check":"warning",size:"md",className:`mt-0.5 mr-3 ${n.type==="success"?"text-green-500":"text-red-500"}`}),e.jsx("p",{className:`text-sm ${n.type==="success"?"text-green-700":"text-red-700"}`,children:n.text})]})}),e.jsx("div",{className:"mb-6",children:e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(r,{name:"search",className:"h-5 w-5 text-gray-400"})}),e.jsx("input",{type:"text",placeholder:"Search users by name, username, email, groups, or auth method...",value:l,onChange:s=>h(s.target.value),className:"block w-full pl-10 pr-10 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500",autoComplete:"off"}),l&&e.jsx("button",{onClick:v,className:"absolute inset-y-0 right-0 pr-3 flex items-center text-gray-400 hover:text-gray-600","aria-label":"Clear search",children:e.jsx(r,{name:"x",className:"h-5 w-5"})})]})}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200",children:[e.jsx("div",{className:"px-6 py-4 border-b border-gray-200",children:e.jsxs("h3",{className:"text-lg font-semibold text-gray-900",children:["Users (",x.length,l&&` of ${p.length}`,")"]})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"User"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Auth Method"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Groups"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Last Active"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:x.length===0?e.jsx("tr",{children:e.jsxs("td",{colSpan:"6",className:"px-6 py-8 text-center text-gray-500",children:[e.jsx(r,{name:"users",size:"lg",className:"mx-auto mb-4 text-gray-400"}),l?e.jsxs(e.Fragment,{children:[e.jsxs("p",{children:['No users found matching "',l,'"']}),e.jsx("p",{className:"text-sm",children:"Try adjusting your search criteria"})]}):e.jsxs(e.Fragment,{children:[e.jsx("p",{children:"No users found"}),e.jsx("p",{className:"text-sm",children:"Create your first user to get started"})]})]})}):x.map(s=>e.jsxs("tr",{children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0 h-10 w-10",children:e.jsx("div",{className:"h-10 w-10 rounded-full bg-gray-300 flex items-center justify-center",children:e.jsx(r,{name:"user",size:"md",className:"text-gray-600"})})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:s.name||s.username}),e.jsx("div",{className:"text-sm text-gray-500",children:s.email}),e.jsxs("div",{className:"text-xs text-gray-400",children:["@",s.username]})]})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("div",{className:"flex flex-wrap gap-1",children:(s.authMethods||["local"]).map((t,a)=>e.jsxs("span",{className:`inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${t==="local"?"bg-gray-100 text-gray-800":t==="oidc"?"bg-blue-100 text-blue-800":"bg-purple-100 text-purple-800"}`,children:[e.jsx(r,{name:t==="local"?"key":t==="oidc"?"globe":"shield",size:"xs",className:"mr-1"}),t.toUpperCase()]},a))}),s.oidcData&&e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:s.oidcData.provider}),s.proxyData&&e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:"Proxy"})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex flex-wrap gap-1",children:[(s.internalGroups||[]).map((t,a)=>e.jsx("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800",children:t},a)),(!s.internalGroups||s.internalGroups.length===0)&&e.jsx("span",{className:"text-sm text-gray-400",children:"No groups"})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("span",{className:`inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${s.active!==!1?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:s.active!==!1?"Active":"Inactive"}),e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:s.active!==!1,onChange:()=>b(s),className:"sr-only peer"}),e.jsx("div",{className:"w-9 h-5 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-4 after:w-4 after:transition-all peer-checked:bg-blue-600"})]})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:s.lastActiveDate?e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{children:new Date(s.lastActiveDate).toLocaleDateString()}),e.jsxs("span",{className:"text-xs text-gray-400",children:[Math.floor((Date.now()-new Date(s.lastActiveDate))/(1e3*60*60*24))," ","days ago"]})]}):e.jsx("span",{className:"text-gray-400",children:"Never"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:()=>m(`/admin/users/${s.id}`),className:"text-blue-600 hover:text-blue-900",children:e.jsx(r,{name:"edit",size:"sm"})}),e.jsx("button",{onClick:()=>N(s.id),className:"text-red-600 hover:text-red-900",children:e.jsx(r,{name:"trash",size:"sm"})})]})})]},s.id))})]})})]})]})]})]})};export{P as default};
