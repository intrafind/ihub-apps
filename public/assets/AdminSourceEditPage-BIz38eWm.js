const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./monaco-CCrBizaJ.js","./vendor-react-9AdXaApd.js"])))=>i.map(i=>d[i]);
import{u as K,j as e,I as N}from"./index-BImwYGvy.js";import{r as x,u as Z,e as W}from"./vendor-react-9AdXaApd.js";import{A as _}from"./AdminAuth-DlQsuewr.js";import{A as B}from"./AdminNavigation-BmtWl3vA.js";import{D as G}from"./DynamicLanguageEditor-DRjlu0Xb.js";import{_ as Y}from"./mermaid-DechTdnA.js";import{m as R}from"./adminApi-ChCbw-zB.js";import"./vendor-utils-CF1RCcgi.js";import"./teams-CwMtNG0x.js";import"./vendor-ui-lZiltAcz.js";import"./vendor-forms-DyVXvDXu.js";const Q=x.lazy(()=>Y(()=>import("./monaco-CCrBizaJ.js"),__vite__mapDeps([0,1]),import.meta.url)),ee=({source:s,onChange:C,isEditing:$})=>{var A,H;const{t:o}=K(),[g,t]=x.useState(!1),[i,p]=x.useState(null),[r,I]=x.useState(null),[b,l]=x.useState(""),[U,E]=x.useState(!1),[y,S]=x.useState(!1),[F,n]=x.useState(!1),f=x.useCallback(async()=>{var a,c,w;if(!(!(s!=null&&s.id)||!((a=s==null?void 0:s.config)!=null&&a.path)))try{t(!0),p(null);const u=await R(`/admin/sources/${s.id}/files/content?path=${encodeURIComponent(s.config.path)}`);u.data.success&&(I({name:s.config.path.split("/").pop(),path:s.config.path,size:(c=u.data.metadata)==null?void 0:c.size,modified:(w=u.data.metadata)==null?void 0:w.modified}),l(u.data.content))}catch(u){console.error("Failed to load current file:",u)}finally{t(!1)}},[s]);x.useEffect(()=>{var a,c;(a=s==null?void 0:s.config)!=null&&a.path&&$?f():(c=s==null?void 0:s.config)!=null&&c.tempContent&&(I({name:s.config.originalFileName||"content.txt",path:s.config.path||"",size:new TextEncoder().encode(s.config.tempContent).length,modified:s.config.uploadedAt||new Date().toISOString()}),l(s.config.tempContent))},[(A=s==null?void 0:s.config)==null?void 0:A.path,(H=s==null?void 0:s.config)==null?void 0:H.tempContent,$,f]);const j=async a=>{if(!a)return;if(a.size>10*1024*1024){p(o("admin.sources.fileTooLarge","File size exceeds 10MB limit"));return}const c=[".txt",".md",".json",".xml",".csv",".log",".conf",".yaml",".yml"],w=a.name.substring(a.name.lastIndexOf(".")).toLowerCase();if(!c.includes(w)){p(o("admin.sources.unsupportedFileType","Unsupported file type"));return}try{t(!0),p(null);const u=await P(a),z=s.id||`temp_${Date.now()}`,J=Date.now(),V=a.name.substring(a.name.lastIndexOf(".")),q=`sources/${`${z}_${J}${V}`}`;if(s.id&&$){const M=await R(`/admin/sources/${s.id}/files`,{method:"POST",body:JSON.stringify({path:q,content:u,encoding:"utf8"})});if(M.data.success){const X={...s,config:{...s.config,path:q}};C(X),I({name:a.name,path:q,size:a.size,modified:new Date().toISOString()}),l(u),S(!1)}else p(M.data.error||"Failed to upload file")}else{const M={...s,config:{...s.config,path:q,tempContent:u,originalFileName:a.name,uploadedAt:new Date().toISOString()}};C(M),I({name:a.name,path:q,size:a.size,modified:new Date().toISOString()}),l(u),S(!1)}}catch(u){console.error("Failed to upload file:",u),p(u.message||"Failed to upload file")}finally{t(!1)}},T=async a=>{const c=a.target.files[0];await j(c)},P=a=>new Promise((c,w)=>{const u=new FileReader;u.onload=z=>c(z.target.result),u.onerror=()=>w(new Error("Failed to read file")),u.readAsText(a)}),m=a=>{a.preventDefault(),a.stopPropagation(),g||n(!0)},h=a=>{a.preventDefault(),a.stopPropagation(),a.currentTarget===a.target&&n(!1)},L=a=>{a.preventDefault(),a.stopPropagation()},O=async a=>{if(a.preventDefault(),a.stopPropagation(),n(!1),g)return;const c=Array.from(a.dataTransfer.files);c.length>0&&await j(c[0])},k=async()=>{if(!(!(r!=null&&r.path)&&!b.trim()))try{t(!0),p(null);let a=r==null?void 0:r.path;if(!a){const c=s.id||`temp_${Date.now()}`,w=Date.now();a=`sources/${`${c}_${w}.txt`}`}if(s.id&&$){const c=await R(`/admin/sources/${s.id}/files`,{method:"POST",body:JSON.stringify({path:a,content:b,encoding:"utf8"})});if(c.data.success){S(!1),E(!1);const w={...s,config:{...s.config,path:a}};C(w),I({name:(r==null?void 0:r.name)||"content.txt",path:a,size:new TextEncoder().encode(b).length,modified:new Date().toISOString()})}else p(c.data.error||"Failed to save file")}else{S(!1),E(!1);const c={...s,config:{...s.config,path:a,tempContent:b,originalFileName:(r==null?void 0:r.name)||"content.txt",uploadedAt:new Date().toISOString()}};C(c),I({name:(r==null?void 0:r.name)||"content.txt",path:a,size:new TextEncoder().encode(b).length,modified:new Date().toISOString()})}}catch(a){console.error("Failed to save file:",a),p(a.message||"Failed to save file")}finally{t(!1)}},v=()=>{const a=s.id||`temp_${Date.now()}`,c=Date.now(),u=`sources/${`${a}_${c}.txt`}`;I({name:"content.txt",path:u,size:0,modified:new Date().toISOString()}),l(""),E(!0),S(!1);const z={...s,config:{...s.config,path:u,tempContent:"",originalFileName:"content.txt",uploadedAt:new Date().toISOString()}};C(z)},D=a=>{if(!a)return"Unknown size";const c=["Bytes","KB","MB","GB"],w=Math.floor(Math.log(a)/Math.log(1024));return Math.round(a/Math.pow(1024,w)*100)/100+" "+c[w]},d=a=>{var u;if(!a)return"plaintext";const c=(u=a.split(".").pop())==null?void 0:u.toLowerCase();return{js:"javascript",jsx:"javascript",ts:"typescript",tsx:"typescript",json:"json",md:"markdown",yml:"yaml",yaml:"yaml",xml:"xml",html:"html",css:"css",py:"python",sh:"shell",bash:"shell",sql:"sql",txt:"plaintext",log:"plaintext",conf:"ini",ini:"ini",csv:"plaintext"}[c]||"plaintext"};return(s==null?void 0:s.type)!=="filesystem"?null:e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:o("admin.sources.sourceFile","Source File")}),r&&e.jsx("div",{className:"bg-gray-50 rounded-lg p-4 mb-4",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-start",children:[e.jsx(N,{name:"document-text",className:"h-5 w-5 text-gray-400 mr-3 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:r.name}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[D(r.size)," â€¢",r.modified&&` ${new Date(r.modified).toLocaleDateString()}`]})]})]}),e.jsx("div",{className:"flex items-center space-x-2",children:U?e.jsxs(e.Fragment,{children:[e.jsx("button",{type:"button",onClick:k,disabled:g||!y,className:"text-sm text-green-600 hover:text-green-700 font-medium disabled:opacity-50",children:o("common.save","Save")}),e.jsx("button",{type:"button",onClick:()=>{E(!1),S(!1),f()},className:"text-sm text-gray-600 hover:text-gray-700 font-medium",children:o("common.cancel","Cancel")})]}):e.jsx("button",{type:"button",onClick:()=>E(!0),className:"text-sm text-blue-600 hover:text-blue-700 font-medium",children:o("admin.sources.editContent","Edit Content")})})]})}),U&&r&&e.jsxs("div",{className:"mt-4 border rounded-lg overflow-hidden",children:[e.jsxs("div",{className:"bg-gray-50 px-4 py-2 border-b flex items-center justify-between",children:[e.jsx("p",{className:"text-sm font-medium text-gray-700",children:o("admin.sources.editingFile","Editing: {{file}}",{file:r.name})}),y&&e.jsx("span",{className:"text-xs text-orange-600 font-medium",children:o("admin.sources.unsavedChanges","Unsaved changes")})]}),e.jsx(x.Suspense,{fallback:e.jsx("div",{className:"flex items-center justify-center h-96 bg-gray-50",children:e.jsx(N,{name:"arrow-path",className:"animate-spin h-6 w-6 text-gray-400"})}),children:e.jsx(Q,{height:"400px",language:d(r.name),value:b,onChange:a=>{l(a||""),S(!0)},options:{minimap:{enabled:!1},fontSize:14,wordWrap:"on",scrollBeyondLastLine:!1,automaticLayout:!0,readOnly:!1},theme:"vs-light"})})]}),!U&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"relative",onDragEnter:m,onDragLeave:h,onDragOver:L,onDrop:O,children:[e.jsx("input",{type:"file",onChange:T,disabled:g,className:"sr-only",id:"file-upload",accept:".txt,.md,.json,.xml,.csv,.log,.conf,.yaml,.yml"}),e.jsx("label",{htmlFor:"file-upload",className:`flex items-center justify-center px-4 py-2 border-2 border-dashed rounded-lg transition-all ${g?"border-gray-300 bg-gray-50 cursor-not-allowed":F?"border-blue-400 bg-blue-50 cursor-copy":"border-gray-300 hover:border-gray-400 bg-white cursor-pointer"}`,children:e.jsxs("div",{className:"space-y-1 text-center pointer-events-none",children:[e.jsx(N,{name:g?"arrow-path":F?"document-arrow-down":"cloud-arrow-up",className:`mx-auto h-8 w-8 ${g?"animate-spin text-gray-400":F?"text-blue-500":"text-gray-400"}`}),e.jsx("div",{className:"flex text-sm text-gray-600",children:F?e.jsx("span",{className:"font-medium text-blue-600",children:o("admin.sources.dropFileHere","Drop file here")}):e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"font-medium text-blue-600 hover:text-blue-500",children:r?o("admin.sources.uploadNewFile","Upload new file"):o("admin.sources.uploadFile","Upload file")}),e.jsx("p",{className:"pl-1",children:o("admin.sources.orDragDrop","or drag and drop")})]})}),!F&&e.jsx("p",{className:"text-xs text-gray-500",children:o("admin.sources.supportedFormats","TXT, MD, JSON, XML, CSV, LOG, CONF, YAML up to 10MB")})]})})]}),!r&&e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-0 flex items-center",children:e.jsx("div",{className:"w-full border-t border-gray-300"})}),e.jsx("div",{className:"relative flex justify-center text-sm",children:e.jsx("span",{className:"px-2 bg-white text-gray-500",children:o("admin.sources.or","or")})})]}),e.jsxs("button",{type:"button",onClick:v,disabled:g,className:"mt-4 inline-flex items-center px-4 py-2 border border-gray-300 rounded-lg shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(N,{name:"document-plus",className:"h-4 w-4 mr-2"}),o("admin.sources.createNewContent","Create new content")]}),e.jsx("p",{className:"mt-2 text-xs text-gray-500",children:o("admin.sources.createNewContentHelp","Start writing content directly in the editor")})]})]}),i&&e.jsx("div",{className:"mt-2 bg-red-50 border border-red-200 rounded-lg p-3",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(N,{name:"x-circle",className:"h-4 w-4 text-red-400 mr-2"}),e.jsx("p",{className:"text-sm text-red-800",children:i}),e.jsx("button",{onClick:()=>p(null),className:"ml-auto text-red-600 hover:text-red-800",children:e.jsx(N,{name:"x-mark",className:"h-3 w-3"})})]})}),!r&&!i&&e.jsx("p",{className:"mt-2 text-xs text-gray-500",children:o("admin.sources.fileUploadHelp","Upload a file or create new content to use as the content source. The file will be stored securely and referenced by this source.")})]})})},se=({source:s,onChange:C,onSave:$,saving:o,isEditing:g})=>{const{t}=K(),[i,p]=x.useState(s||{}),[r,I]=x.useState({});x.useEffect(()=>{s&&p(s)},[s]);const b=(n,f)=>{const j={...i,[n]:f};p(j),C(j),r[n]&&I(T=>{const{[n]:P,...m}=T;return m})},l=(n,f)=>{const j={...i.config,[n]:f};b("config",j)},U=()=>{var f,j,T,P,m,h,L,O,k,v,D;const n={};if((f=i.id)!=null&&f.trim()?/^[a-zA-Z0-9_-]+$/.test(i.id)||(n.id=t("admin.sources.validation.idInvalid","ID must contain only letters, numbers, underscores, and hyphens")):n.id=t("admin.sources.validation.idRequired","Source ID is required"),(T=(j=i.name)==null?void 0:j.en)!=null&&T.trim()||(n.name=t("admin.sources.validation.nameRequired","Source name is required")),i.type||(n.type=t("admin.sources.validation.typeRequired","Source type is required")),i.type!=="filesystem")if(i.type==="url")if(!((m=(P=i.config)==null?void 0:P.url)!=null&&m.trim()))n.url=t("admin.sources.validation.urlRequired","URL is required");else try{new URL(i.config.url)}catch{n.url=t("admin.sources.validation.urlInvalid","Please enter a valid URL")}else i.type==="ifinder"?((L=(h=i.config)==null?void 0:h.baseUrl)!=null&&L.trim()||(n.baseUrl=t("admin.sources.validation.baseUrlRequired","Base URL is required")),(k=(O=i.config)==null?void 0:O.apiKey)!=null&&k.trim()||(n.apiKey=t("admin.sources.validation.apiKeyRequired","API key is required"))):i.type==="page"&&((D=(v=i.config)==null?void 0:v.pageId)!=null&&D.trim()?/^[a-zA-Z0-9_-]+$/.test(i.config.pageId)||(n.pageId=t("admin.sources.validation.pageIdInvalid","Page ID must contain only letters, numbers, underscores, and hyphens")):n.pageId=t("admin.sources.validation.pageIdRequired","Page ID is required"));return I(n),Object.keys(n).length===0},E=n=>{n.preventDefault(),U()&&$(i)},y=n=>{switch(n){case"filesystem":return{path:"",encoding:"utf-8"};case"url":return{url:"",method:"GET",headers:{},timeout:1e4,followRedirects:!0,maxRedirects:5,retries:3,maxContentLength:1048576,cleanContent:!0};case"ifinder":return{baseUrl:"",apiKey:"",searchProfile:"default",maxResults:10,queryTemplate:"",filters:{},maxLength:1e4};case"page":return{pageId:"",language:"en"};default:return{}}},S=n=>{const f=y(n);p(j=>({...j,type:n,config:f})),C({...i,type:n,config:f})},F=()=>{var n,f,j,T,P,m,h,L,O,k,v,D;switch(i.type){case"filesystem":return e.jsxs("div",{className:"space-y-6",children:[e.jsx(ee,{source:i,onChange:p,isEditing:g}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:t("admin.sources.encoding","File Encoding")}),e.jsxs("select",{value:((n=i.config)==null?void 0:n.encoding)||"utf-8",onChange:d=>l("encoding",d.target.value),className:"w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500",children:[e.jsx("option",{value:"utf-8",children:"UTF-8"}),e.jsx("option",{value:"ascii",children:"ASCII"}),e.jsx("option",{value:"latin1",children:"Latin-1"}),e.jsx("option",{value:"base64",children:"Base64"})]}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:t("admin.sources.encodingHelp","Character encoding of the source file")})]})]});case"url":return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[t("admin.sources.url","URL")," *"]}),e.jsx("input",{type:"url",value:((f=i.config)==null?void 0:f.url)||"",onChange:d=>l("url",d.target.value),className:`w-full border rounded-lg px-3 py-2 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 ${r.url?"border-red-300":"border-gray-300"}`,placeholder:"https://example.com/content"}),r.url&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:r.url})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:t("admin.sources.method","HTTP Method")}),e.jsxs("select",{value:((j=i.config)==null?void 0:j.method)||"GET",onChange:d=>l("method",d.target.value),className:"w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500",children:[e.jsx("option",{value:"GET",children:"GET"}),e.jsx("option",{value:"POST",children:"POST"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:t("admin.sources.timeout","Timeout (ms)")}),e.jsx("input",{type:"number",value:((T=i.config)==null?void 0:T.timeout)||1e4,onChange:d=>l("timeout",parseInt(d.target.value)),className:"w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500",min:"1000",max:"60000"})]})]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:((P=i.config)==null?void 0:P.followRedirects)!==!1,onChange:d=>l("followRedirects",d.target.checked),className:"h-4 w-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500"}),e.jsx("span",{className:"ml-2 text-sm text-gray-700",children:t("admin.sources.followRedirects","Follow redirects")})]}),e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:((m=i.config)==null?void 0:m.cleanContent)!==!1,onChange:d=>l("cleanContent",d.target.checked),className:"h-4 w-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500"}),e.jsx("span",{className:"ml-2 text-sm text-gray-700",children:t("admin.sources.cleanContent","Clean HTML content")})]})]})]});case"ifinder":return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[t("admin.sources.baseUrl","iFinder Base URL")," *"]}),e.jsx("input",{type:"url",value:((h=i.config)==null?void 0:h.baseUrl)||"",onChange:d=>l("baseUrl",d.target.value),className:`w-full border rounded-lg px-3 py-2 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 ${r.baseUrl?"border-red-300":"border-gray-300"}`,placeholder:"https://ifinder.example.com"}),r.baseUrl&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:r.baseUrl})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[t("admin.sources.apiKey","API Key")," *"]}),e.jsx("input",{type:"password",value:((L=i.config)==null?void 0:L.apiKey)||"",onChange:d=>l("apiKey",d.target.value),className:`w-full border rounded-lg px-3 py-2 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 ${r.apiKey?"border-red-300":"border-gray-300"}`,placeholder:"Enter API key"}),r.apiKey&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:r.apiKey})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:t("admin.sources.searchProfile","Search Profile")}),e.jsx("input",{type:"text",value:((O=i.config)==null?void 0:O.searchProfile)||"default",onChange:d=>l("searchProfile",d.target.value),className:"w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500",placeholder:"default"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:t("admin.sources.maxResults","Max Results")}),e.jsx("input",{type:"number",value:((k=i.config)==null?void 0:k.maxResults)||10,onChange:d=>l("maxResults",parseInt(d.target.value)),className:"w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500",min:"1",max:"100"})]})]})]});case"page":return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[t("admin.sources.pageId","Page ID")," *"]}),e.jsx("input",{type:"text",value:((v=i.config)==null?void 0:v.pageId)||"",onChange:d=>l("pageId",d.target.value),className:`w-full border rounded-lg px-3 py-2 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 ${r.pageId?"border-red-300":"border-gray-300"}`,placeholder:"dashboard"}),r.pageId&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:r.pageId}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:t("admin.sources.pageIdHelp","Page identifier (e.g., dashboard, about, contact). Only letters, numbers, hyphens, and underscores allowed.")})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:t("admin.sources.language","Language")}),e.jsxs("select",{value:((D=i.config)==null?void 0:D.language)||"en",onChange:d=>l("language",d.target.value),className:"w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500",children:[e.jsx("option",{value:"en",children:"English (en)"}),e.jsx("option",{value:"de",children:"German (de)"}),e.jsx("option",{value:"es",children:"Spanish (es)"}),e.jsx("option",{value:"fr",children:"French (fr)"}),e.jsx("option",{value:"it",children:"Italian (it)"}),e.jsx("option",{value:"pt",children:"Portuguese (pt)"}),e.jsx("option",{value:"nl",children:"Dutch (nl)"})]}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:t("admin.sources.languageHelp","Language code for the page content")})]})]});default:return null}};return e.jsxs("form",{onSubmit:E,className:"space-y-8",children:[e.jsxs("div",{className:"border-b border-gray-200 pb-8",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-6",children:t("admin.sources.basicInfo","Basic Information")}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[t("admin.sources.id","Source ID")," *"]}),e.jsx("input",{type:"text",value:i.id||"",onChange:n=>b("id",n.target.value),disabled:g,className:`w-full border rounded-lg px-3 py-2 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 ${g?"bg-gray-100 cursor-not-allowed":""} ${r.id?"border-red-300":"border-gray-300"}`,placeholder:"unique-source-id"}),r.id&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:r.id}),g&&e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:t("admin.sources.idCannotBeChanged","Source ID cannot be changed after creation")})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[t("admin.sources.type","Source Type")," *"]}),e.jsxs("select",{value:i.type||"filesystem",onChange:n=>S(n.target.value),disabled:g,className:`w-full border rounded-lg px-3 py-2 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 ${g?"bg-gray-100 cursor-not-allowed":"border-gray-300"}`,children:[e.jsx("option",{value:"filesystem",children:t("admin.sources.filesystem","Filesystem")}),e.jsx("option",{value:"url",children:t("admin.sources.url","URL")}),e.jsx("option",{value:"ifinder",children:t("admin.sources.ifinder","iFinder")}),e.jsx("option",{value:"page",children:t("admin.sources.page","Page")})]}),g&&e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:t("admin.sources.typeCannotBeChanged","Source type cannot be changed after creation")})]})]}),e.jsxs("div",{className:"mt-6",children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[t("admin.sources.name","Name")," *"]}),e.jsx(G,{value:i.name||{},onChange:n=>b("name",n),placeholder:t("admin.sources.namePlaceholder","Enter source name"),error:r.name})]}),e.jsxs("div",{className:"mt-6",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:t("admin.sources.description","Description")}),e.jsx(G,{value:i.description||{},onChange:n=>b("description",n),placeholder:t("admin.sources.descriptionPlaceholder","Enter source description"),type:"textarea"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mt-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:t("admin.sources.exposeAs","Expose As")}),e.jsxs("select",{value:i.exposeAs||"prompt",onChange:n=>b("exposeAs",n.target.value),className:"w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500",children:[e.jsx("option",{value:"prompt",children:t("admin.sources.exposeAsPrompt","Prompt Context")}),e.jsx("option",{value:"tool",children:t("admin.sources.exposeAsTool","Tool Function")})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:t("admin.sources.category","Category")}),e.jsx("input",{type:"text",value:i.category||"",onChange:n=>b("category",n.target.value),className:"w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500",placeholder:t("admin.sources.categoryPlaceholder","Optional category")})]}),e.jsx("div",{className:"flex items-center",children:e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:i.enabled!==!1,onChange:n=>b("enabled",n.target.checked),className:"h-4 w-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500"}),e.jsx("span",{className:"ml-2 text-sm text-gray-700",children:t("admin.sources.enabled","Enabled")})]})})]})]}),e.jsxs("div",{className:"border-b border-gray-200 pb-8",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-6",children:t("admin.sources.configuration","Configuration")}),F()]}),e.jsxs("div",{className:"flex items-center justify-between pt-6",children:[e.jsx("button",{type:"button",onClick:()=>window.history.back(),className:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500",children:t("common.cancel","Cancel")}),e.jsxs("button",{type:"submit",disabled:o,className:"px-6 py-2 text-sm font-medium text-white bg-indigo-600 border border-transparent rounded-lg hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 disabled:opacity-50 disabled:cursor-not-allowed flex items-center",children:[o&&e.jsx(N,{name:"arrow-path",className:"animate-spin h-4 w-4 mr-2"}),o?t("common.saving","Saving..."):t("common.save","Save")]})]})]})},xe=()=>{var P;const{t:s}=K(),{id:C}=Z(),$=W(),o=C!=="new",[g,t]=x.useState(null),[i,p]=x.useState(!0),[r,I]=x.useState(!1),[b,l]=x.useState(null),[U,E]=x.useState(!1),[y,S]=x.useState(null),[F,n]=x.useState(!1);x.useEffect(()=>{(async()=>{if(o)try{p(!0),l(null);const h=await R(`/admin/sources/${C}`);t(h.data)}catch(h){console.error("Failed to load source:",h),l(h.message||"Failed to load source"),t({id:C,name:{en:""},description:{en:""},type:"filesystem",enabled:!0,exposeAs:"prompt",category:"",tags:[],config:{}})}finally{p(!1)}else t({id:"",name:{en:""},description:{en:""},type:"filesystem",enabled:!0,exposeAs:"prompt",category:"",tags:[],config:{}}),p(!1)})()},[C,o]),x.useEffect(()=>{const m=h=>{U&&(h.preventDefault(),h.returnValue="")};return window.addEventListener("beforeunload",m),()=>window.removeEventListener("beforeunload",m)},[U]);const f=async m=>{var h,L,O;try{I(!0),l(null);const k=(h=m.config)==null?void 0:h.tempContent,v={...m,config:{...m.config}};v.config&&(delete v.config.tempContent,delete v.config.originalFileName,delete v.config.uploadedAt);let D;if(o)D=((L=(await R(`/admin/sources/${C}`,{method:"PUT",body:JSON.stringify(v)})).data)==null?void 0:L.source)||v;else if(D=((O=(await R("/admin/sources",{method:"POST",body:JSON.stringify(v)})).data)==null?void 0:O.source)||v,k&&(D!=null&&D.id))try{await R(`/admin/sources/${D.id}/files`,{method:"POST",body:JSON.stringify({path:m.config.path,content:k,encoding:"utf8"})})}catch(A){console.error("Failed to upload temporary content:",A),l(A.message||"Source created but failed to upload content");return}E(!1),$("/admin/sources")}catch(k){console.error("Failed to save source:",k),l(k.message||"Failed to save source")}finally{I(!1)}},j=async()=>{if(!g||!g.id||!o){l("Please save the source first before testing");return}try{n(!0),S(null),l(null);const m=await R(`/admin/sources/${g.id}/test`,{method:"POST"});S(m.data)}catch(m){console.error("Source test failed:",m),S({success:!1,error:m.message,duration:0})}finally{n(!1)}},T=m=>{t(m),E(!0),S(null)};return i?e.jsx(_,{children:e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx(B,{}),e.jsx("div",{className:"max-w-7xl mx-auto py-6 px-4",children:e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsxs("div",{className:"text-center",children:[e.jsx(N,{name:"arrow-path",className:"animate-spin h-8 w-8 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500",children:s("common.loading","Loading...")})]})})})]})}):g?e.jsx(_,{children:e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx(B,{}),e.jsxs("div",{className:"max-w-7xl mx-auto py-6 px-4",children:[e.jsx("div",{className:"mb-8",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("nav",{className:"flex items-center space-x-2 text-sm text-gray-500 mb-2",children:[e.jsx("button",{onClick:()=>$("/admin/sources"),className:"hover:text-gray-700",children:s("admin.navigation.sources","Sources")}),e.jsx(N,{name:"chevron-right",className:"h-4 w-4"}),e.jsx("span",{className:"font-medium text-gray-900",children:o?s("admin.sources.editSource","Edit Source"):s("admin.sources.createNew","Create Source")})]}),e.jsxs("h1",{className:"text-2xl font-semibold text-gray-900 flex items-center",children:[e.jsx(N,{name:"database",className:"h-6 w-6 mr-2"}),o?((P=g.name)==null?void 0:P.en)||g.id:s("admin.sources.createNew","Create Source")]})]}),e.jsx("div",{className:"flex items-center space-x-3",children:o&&e.jsxs("button",{onClick:j,disabled:F,className:"bg-blue-600 hover:bg-blue-700 disabled:opacity-50 text-white px-4 py-2 rounded-lg font-medium flex items-center",children:[e.jsx(N,{name:F?"arrow-path":"beaker",className:`h-4 w-4 mr-2 ${F?"animate-spin":""}`}),F?s("admin.sources.testing","Testing..."):s("admin.sources.testConnection","Test")]})})]})}),b&&e.jsx("div",{className:"mb-6 bg-red-50 border border-red-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(N,{name:"x-circle",className:"h-5 w-5 text-red-400 mr-2"}),e.jsx("p",{className:"text-red-800",children:b}),e.jsx("button",{onClick:()=>l(null),className:"ml-auto text-red-600 hover:text-red-800",children:e.jsx(N,{name:"x-mark",className:"h-4 w-4"})})]})}),e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"bg-white rounded-lg shadow-sm",children:e.jsx("div",{className:"p-6",children:e.jsx(se,{source:g,onChange:T,onSave:f,saving:r,isEditing:o})})}),y&&e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-6",children:[e.jsxs("h3",{className:"text-lg font-medium text-gray-900 mb-4 flex items-center",children:[e.jsx(N,{name:"beaker",className:"h-5 w-5 mr-2"}),s("admin.sources.testResults","Test Results")]}),e.jsxs("div",{className:`p-4 rounded-lg ${y.success?"bg-green-50 border border-green-200":"bg-red-50 border border-red-200"}`,children:[e.jsxs("div",{className:"flex items-center mb-2",children:[e.jsx(N,{name:y.success?"check-circle":"x-circle",className:`h-5 w-5 mr-2 ${y.success?"text-green-600":"text-red-600"}`}),e.jsx("span",{className:`font-medium ${y.success?"text-green-800":"text-red-800"}`,children:y.success?s("admin.sources.testSuccess","Connection successful"):s("admin.sources.testFailed","Connection failed")})]}),y.error&&e.jsx("p",{className:"text-red-700 text-sm mb-2",children:y.error}),y.duration&&e.jsx("p",{className:"text-sm text-gray-600",children:s("admin.sources.testDuration","Duration: {{duration}}ms",{duration:y.duration})}),y.result&&e.jsx("pre",{className:"mt-2 text-xs text-gray-600 bg-white p-2 rounded border overflow-auto max-h-32",children:JSON.stringify(y.result,null,2)})]})]})]})]})]})}):e.jsx(_,{children:e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx(B,{}),e.jsx("div",{className:"max-w-7xl mx-auto py-6 px-4",children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx(N,{name:"x-circle",className:"h-12 w-12 text-red-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:s("admin.sources.notFound","Source not found")}),e.jsx("p",{className:"text-gray-500 mb-4",children:s("admin.sources.notFoundDescription","The requested source could not be found.")}),e.jsx("button",{onClick:()=>$("/admin/sources"),className:"bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 rounded-lg font-medium",children:s("common.backToList","Back to Sources")})]})})]})})};export{xe as default};
