import{u as C,j as e,I as c}from"./index-BImwYGvy.js";import{u as A,e as O,f as q,r as m}from"./vendor-react-9AdXaApd.js";import{A as v}from"./AdminNavigation-BmtWl3vA.js";import{A as w}from"./AdminAuth-DlQsuewr.js";import{D as J}from"./DualModeEditor-DudKIsvj.js";import{D as S}from"./DynamicLanguageEditor-DRjlu0Xb.js";import{a as H,n as P,o as L,p as U,q as T}from"./adminApi-ChCbw-zB.js";import{clearApiCache as B}from"./cache-QtLqQens.js";import"./mermaid-DechTdnA.js";import"./vendor-utils-CF1RCcgi.js";import"./teams-CwMtNG0x.js";import"./vendor-ui-lZiltAcz.js";import"./vendor-forms-DyVXvDXu.js";import"./monaco-CCrBizaJ.js";const G=({value:o,onChange:l,isNewTool:p})=>{const{t:n}=C(),r=(s,a)=>{l({...o,[s]:a})};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[n("admin.tools.id","Tool ID")," ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",value:o.id||"",onChange:s=>r("id",s.target.value),disabled:!p,className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 disabled:bg-gray-100",placeholder:"braveSearch"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:n("admin.tools.idHelp","Unique identifier for the tool")})]}),e.jsxs("div",{children:[e.jsx(S,{label:e.jsxs(e.Fragment,{children:[n("admin.tools.name","Name")," ",e.jsx("span",{className:"text-red-500",children:"*"})]}),value:o.name||{en:""},onChange:s=>r("name",s),required:!0,placeholder:{en:"Brave Search",de:"Brave-Suche"}}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:n("admin.tools.nameHelp","Display name for the tool in different languages")})]}),e.jsxs("div",{children:[e.jsx(S,{label:e.jsxs(e.Fragment,{children:[n("admin.tools.description","Description")," ",e.jsx("span",{className:"text-red-500",children:"*"})]}),value:o.description||{en:""},onChange:s=>r("description",s),required:!0,type:"textarea",placeholder:{en:"Search the web using Brave for up-to-date information",de:"Durchsuchen Sie das Web mit Brave"}}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:n("admin.tools.descriptionHelp","Description shown to the LLM for tool selection")})]}),e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"flex items-center h-5",children:e.jsx("input",{type:"checkbox",id:"isSpecialTool",checked:o.isSpecialTool||!1,onChange:s=>r("isSpecialTool",s.target.checked),className:"h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded"})}),e.jsxs("div",{className:"ml-3 text-sm",children:[e.jsx("label",{htmlFor:"isSpecialTool",className:"font-medium text-gray-700",children:n("admin.tools.isSpecialTool","Special Tool")}),e.jsx("p",{className:"text-gray-500",children:n("admin.tools.isSpecialToolHelp","Provider-specific tools that are handled directly by the model provider (e.g., Google Search Grounding, OpenAI Web Search)")})]})]}),o.isSpecialTool&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:n("admin.tools.provider","Provider")}),e.jsx("input",{type:"text",value:o.provider||"",onChange:s=>r("provider",s.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500",placeholder:"google, openai, openai-responses"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:n("admin.tools.providerHelp",'Provider identifier (e.g., "google" for Google Search, "openai" for OpenAI, "openai-responses" for response-based tools)')})]}),!o.isSpecialTool&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:n("admin.tools.scriptFile","Script File")}),e.jsx("input",{type:"text",value:o.script||"",onChange:s=>r("script",s.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500",placeholder:"braveSearch.js"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:n("admin.tools.scriptFileHelp","JavaScript file in server/tools/ directory")})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:n("admin.tools.concurrency","Concurrency Limit")}),e.jsx("input",{type:"number",min:"1",max:"100",value:o.concurrency||5,onChange:s=>r("concurrency",parseInt(s.target.value,10)),className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:n("admin.tools.concurrencyHelp","Maximum number of concurrent executions")})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",id:"enabled",checked:o.enabled!==!1,onChange:s=>r("enabled",s.target.checked),className:"h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded"}),e.jsx("label",{htmlFor:"enabled",className:"ml-2 block text-sm text-gray-900",children:n("admin.tools.enabled","Enabled")})]}),(!o.functions||Object.keys(o.functions).length===0)&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:n("admin.tools.parameters","Parameters (JSON Schema)")}),e.jsx("textarea",{value:JSON.stringify(o.parameters||{type:"object",properties:{},required:[]},null,2),onChange:s=>{try{const a=JSON.parse(s.target.value);r("parameters",a)}catch{}},rows:12,className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 font-mono text-sm",placeholder:'{"type": "object", "properties": {}, "required": []}'}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:n("admin.tools.parametersHelp","JSON Schema definition for tool parameters")})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:n("admin.tools.functions","Functions (Multi-Function Tool)")}),e.jsx("textarea",{value:JSON.stringify(o.functions||{},null,2),onChange:s=>{try{const a=JSON.parse(s.target.value);r("functions",a)}catch{}},rows:15,className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 font-mono text-sm",placeholder:"{}"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:n("admin.tools.functionsHelp","Define multiple functions for this tool (e.g., findUser, getAllUserDetails). Each function should have description and parameters. Leave empty {} for regular single-function tools.")}),e.jsxs("details",{className:"mt-2",children:[e.jsx("summary",{className:"text-sm text-indigo-600 cursor-pointer hover:text-indigo-800",children:n("admin.tools.functionsExample","Show example multi-function configuration")}),e.jsx("pre",{className:"mt-2 p-3 bg-gray-50 rounded text-xs overflow-auto",children:`{
  "findUser": {
    "description": {
      "en": "Find a user by name",
      "de": "Benutzer nach Name finden"
    },
    "parameters": {
      "type": "object",
      "properties": {
        "name": {
          "type": "string",
          "description": {
            "en": "User name or email"
          }
        }
      },
      "required": ["name"]
    }
  },
  "getUserDetails": {
    "description": {
      "en": "Get user details by ID"
    },
    "parameters": {
      "type": "object",
      "properties": {
        "userId": {
          "type": "string",
          "description": {
            "en": "User ID"
          }
        }
      },
      "required": ["userId"]
    }
  }
}`})]})]})]})},se=()=>{const{t:o}=C(),{toolId:l}=A(),p=O(),n=q(),r=l==="new",[s,a]=m.useState({id:"",name:{en:""},description:{en:""},script:"",enabled:!0,concurrency:5,isSpecialTool:!1,provider:"",parameters:{type:"object",properties:{},required:[]},functions:{}}),[f,g]=m.useState(""),[k,j]=m.useState(!r),[h,b]=m.useState(!1),[N,d]=m.useState(null),[u,y]=m.useState("config");m.useEffect(()=>{var t;if(r&&((t=n.state)!=null&&t.templateTool)){const i=n.state.templateTool;a({...i,id:"",enabled:i.enabled!==!1}),i.script&&g(`// Script template
export default async function toolName(params) {
  // Your code here
}
`)}else r||E()},[l,r]);const E=async()=>{try{j(!0),d(null);const i=(await H()).find(x=>x.id===l);if(!i)throw new Error("Tool not found");if(a({...i,name:i.name||{en:""},description:i.description||{en:""},enabled:i.enabled!==!1,concurrency:i.concurrency||5,isSpecialTool:i.isSpecialTool||!1,provider:i.provider||"",parameters:i.parameters||{type:"object",properties:{},required:[]},functions:i.functions||{}}),i.script)try{const x=await P(l);g(x.content||"")}catch(x){console.error("Error loading script:",x),g("")}}catch(t){console.error("Error loading tool:",t),d(t.message)}finally{j(!1)}},D=async()=>{try{if(b(!0),d(null),!s.id||!s.name.en||!s.description.en)throw new Error("Please fill in all required fields (ID, Name, Description)");const t={...s};t.functions&&Object.keys(t.functions).length>0?delete t.parameters:delete t.functions,r?await L(t):await U(l,t),B("admin_tools"),r&&f&&t.script&&await T(t.id,f),p("/admin/tools")}catch(t){console.error("Error saving tool config:",t),d(t.message||"Failed to save tool configuration")}finally{b(!1)}},F=async()=>{if(!s.script){d("No script file specified in configuration");return}try{b(!0),d(null),await T(l,f),alert(o("admin.tools.scriptSaved","Script saved successfully"))}catch(t){console.error("Error saving script:",t),d(t.message||"Failed to save script")}finally{b(!1)}},I=t=>{a(t)};return k?e.jsxs(w,{children:[e.jsx(v,{}),e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-600"})})]}):e.jsx(w,{children:e.jsxs("div",{children:[e.jsx(v,{}),e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[e.jsxs("div",{className:"md:flex md:items-center md:justify-between mb-6",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h1",{className:"text-2xl font-semibold text-gray-900",children:r?o("admin.tools.createNew","Create New Tool"):o("admin.tools.editTool","Edit Tool")}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:r?o("admin.tools.createDescription","Create a new AI tool / function"):o("admin.tools.editDescription","Edit tool configuration and script")})]}),e.jsx("div",{className:"mt-4 flex md:mt-0 md:ml-4",children:e.jsxs("button",{onClick:()=>p("/admin/tools"),className:"inline-flex items-center px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500",children:[e.jsx(c,{name:"arrow-left",className:"h-4 w-4 mr-2"}),o("common.back","Back")]})})]}),N&&e.jsx("div",{className:"mb-6 bg-red-50 border border-red-200 rounded-md p-4",children:e.jsxs("div",{className:"flex",children:[e.jsx(c,{name:"exclamation-triangle",className:"h-5 w-5 text-red-400"}),e.jsxs("div",{className:"ml-3",children:[e.jsx("h3",{className:"text-sm font-medium text-red-800",children:o("common.error","Error")}),e.jsx("p",{className:"mt-1 text-sm text-red-700",children:N})]})]})}),e.jsx("div",{className:"border-b border-gray-200 mb-6",children:e.jsxs("nav",{className:"-mb-px flex space-x-8",children:[e.jsxs("button",{onClick:()=>y("config"),className:`${u==="config"?"border-indigo-500 text-indigo-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"} whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm`,children:[e.jsx(c,{name:"cog",className:"h-4 w-4 inline mr-2"}),o("admin.tools.configTab","Configuration")]}),!r&&s.script&&e.jsxs("button",{onClick:()=>y("script"),className:`${u==="script"?"border-indigo-500 text-indigo-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"} whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm`,children:[e.jsx(c,{name:"code",className:"h-4 w-4 inline mr-2"}),o("admin.tools.scriptTab","Script Editor")]})]})}),u==="config"&&e.jsx(J,{value:s,onChange:I,formComponent:G,formProps:{isNewTool:r},title:r?o("admin.tools.createNew","Create New Tool"):o("admin.tools.editTool","Edit Tool"),description:r?o("admin.tools.createDescription","Create a new AI tool / function using the form interface or JSON editor"):o("admin.tools.editDescription","Edit tool configuration using the form interface or raw JSON editor")}),u==="config"&&e.jsxs("div",{className:"mt-6 flex justify-end space-x-3",children:[e.jsx("button",{onClick:()=>p("/admin/tools"),className:"px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500",children:o("common.cancel","Cancel")}),e.jsx("button",{onClick:D,disabled:h,className:"inline-flex items-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 disabled:opacity-50",children:h?e.jsxs(e.Fragment,{children:[e.jsx(c,{name:"refresh",className:"animate-spin h-4 w-4 mr-2"}),o("common.saving","Saving...")]}):e.jsxs(e.Fragment,{children:[e.jsx(c,{name:"check",className:"h-4 w-4 mr-2"}),o("common.save","Save")]})})]}),u==="script"&&!r&&s.script&&e.jsxs("div",{className:"bg-white shadow rounded-lg p-6",children:[e.jsx("div",{className:"mb-4",children:e.jsxs("p",{className:"text-sm text-gray-600",children:[o("admin.tools.scriptEditorInfo","Edit the JavaScript code for this tool. Changes will be saved to server/tools/")," ",e.jsx("code",{className:"bg-gray-100 px-2 py-1 rounded text-xs",children:s.script})]})}),e.jsx("div",{className:"mb-4",children:e.jsx("textarea",{value:f,onChange:t=>g(t.target.value),rows:25,className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 font-mono text-sm",style:{fontFamily:"monospace"}})}),e.jsxs("div",{className:"flex justify-end space-x-3",children:[e.jsx("button",{onClick:()=>y("config"),className:"px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500",children:o("common.cancel","Cancel")}),e.jsx("button",{onClick:F,disabled:h,className:"inline-flex items-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 disabled:opacity-50",children:h?e.jsxs(e.Fragment,{children:[e.jsx(c,{name:"refresh",className:"animate-spin h-4 w-4 mr-2"}),o("common.saving","Saving...")]}):e.jsxs(e.Fragment,{children:[e.jsx(c,{name:"check",className:"h-4 w-4 mr-2"}),o("admin.tools.saveScript","Save Script")]})})]})]})]})]})})};export{se as default};
