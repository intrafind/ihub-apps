import{u as F,j as e,I as i}from"./index-BImwYGvy.js";import{r as n}from"./vendor-react-9AdXaApd.js";import z from"./monaco-CCrBizaJ.js";const I=({value:c={},onChange:y,onValidationChange:x,schema:S,readOnly:w=!1,height:V="400px",theme:k="vs",showMinimap:E=!1,wordWrap:C=!0,onMount:O,className:R=""})=>{const{t:o}=F(),u=n.useRef(),t=n.useRef(),[g,b]=n.useState(""),[h,j]=n.useState([]),[d,N]=n.useState(!0);n.useEffect(()=>{try{const r=JSON.stringify(c,null,2);b(r)}catch(r){console.error("Error formatting JSON:",r),b("{}")}},[c]);const D=(r,a)=>{u.current=r,t.current=a,a.languages.json.jsonDefaults.setDiagnosticsOptions({validate:!0,allowComments:!1,schemas:S?[{uri:"http://myschema.json",fileMatch:["*"],schema:S}]:[],enableSchemaRequest:!1});const m=()=>{const f=r.getModel();if(f){const l=a.editor.getModelMarkers({resource:f.uri}).map(p=>({line:p.startLineNumber,column:p.startColumn,message:p.message,severity:p.severity}));j(l);const L=l.some(p=>p.severity===a.MarkerSeverity.Error);N(!L),x&&x({isValid:!L,errors:l})}};a.editor.onDidChangeMarkers(m),setTimeout(m,100),O&&O(r,a)},J=r=>{b(r||"");try{const a=JSON.parse(r||"{}");N(!0),y&&y(a)}catch{N(!1)}},v=()=>{u.current&&t.current&&u.current.getAction("editor.action.formatDocument").run()},M=()=>{if(u.current&&t.current){const r=u.current.getModel();r&&(t.current.editor.setModelMarkers(r,"json",[]),setTimeout(()=>{const m=t.current.editor.getModelMarkers({resource:r.uri}).map(s=>({line:s.startLineNumber,column:s.startColumn,message:s.message,severity:s.severity}));j(m);const f=m.some(s=>s.severity===t.current.MarkerSeverity.Error);N(!f),x&&x({isValid:!f,errors:m})},100))}};return e.jsxs("div",{className:`monaco-json-editor ${R}`,children:[e.jsxs("div",{className:"flex items-center justify-between p-2 bg-gray-50 border-b border-gray-200 rounded-t-md",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(i,{name:"document-text",className:"h-4 w-4 text-gray-500"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:o("admin.editor.jsonEditor","JSON Editor")}),!d&&e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(i,{name:"exclamation-triangle",className:"h-4 w-4 text-red-500"}),e.jsx("span",{className:"text-sm text-red-600",children:o("admin.editor.invalidJson","Invalid JSON")})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("button",{type:"button",onClick:v,disabled:w,className:"inline-flex items-center px-2 py-1 text-xs font-medium rounded border border-gray-300 bg-white text-gray-700 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",title:o("admin.editor.formatJson","Format JSON"),children:[e.jsx(i,{name:"sparkles",className:"h-3 w-3 mr-1"}),o("admin.editor.format","Format")]}),e.jsxs("button",{type:"button",onClick:M,className:"inline-flex items-center px-2 py-1 text-xs font-medium rounded border border-gray-300 bg-white text-gray-700 hover:bg-gray-50",title:o("admin.editor.validateJson","Validate JSON"),children:[e.jsx(i,{name:"check-circle",className:"h-3 w-3 mr-1"}),o("admin.editor.validate","Validate")]})]})]}),e.jsx("div",{className:"border border-gray-300 rounded-b-md overflow-hidden",children:e.jsx(z,{height:V,language:"json",theme:k,value:g,onChange:J,onMount:D,options:{readOnly:w,minimap:{enabled:E},wordWrap:C?"on":"off",scrollBeyondLastLine:!1,fontSize:14,lineNumbers:"on",folding:!0,bracketMatching:"always",autoClosingBrackets:"always",autoClosingQuotes:"always",formatOnPaste:!0,formatOnType:!0,tabSize:2,insertSpaces:!0,detectIndentation:!1,renderWhitespace:"selection",scrollbar:{verticalScrollbarSize:8,horizontalScrollbarSize:8}},loading:e.jsxs("div",{className:"flex items-center justify-center h-full",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-600"}),e.jsx("span",{className:"ml-2 text-gray-600",children:o("admin.editor.loadingEditor","Loading editor...")})]})})}),h.length>0&&e.jsx("div",{className:"mt-2 p-3 bg-red-50 border border-red-200 rounded-md",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx(i,{name:"exclamation-triangle",className:"h-5 w-5 text-red-400 mt-0.5"}),e.jsxs("div",{className:"ml-2",children:[e.jsx("h4",{className:"text-sm font-medium text-red-800",children:o("admin.editor.validationErrors","Validation Errors")}),e.jsx("div",{className:"mt-1 text-sm text-red-700",children:e.jsx("ul",{className:"list-disc list-inside space-y-1",children:h.map((r,a)=>e.jsx("li",{children:o("admin.editor.errorAtLine","Line {{line}}: {{message}}",{line:r.line,message:r.message})},a))})})]})]})})]})},$=({value:c={},onChange:y,formComponent:x,formProps:S={},jsonSchema:w,defaultMode:V="form",allowModeSwitch:k=!0,onModeChange:E,onValidationChange:C,title:O,description:R,showValidationSummary:o=!0,className:u=""})=>{const{t}=F(),[g,b]=n.useState(V),[h,j]=n.useState(!1),[d,N]=n.useState({isValid:!0,errors:[]}),[D,J]=n.useState(null),v=n.useRef(JSON.stringify(c));n.useEffect(()=>{const s=JSON.stringify(c);j(s!==v.current)},[c]);const M=s=>{s!==g&&(h?(J(s),window.confirm(t("admin.editor.unsavedChangesWarning","You have unsaved changes. Switching modes may cause data loss. Continue?"))&&r(s),J(null)):r(s))},r=s=>{b(s),v.current=JSON.stringify(c),j(!1),E&&E(s)},a=s=>{y&&y(s)},m=s=>{N(s),C&&C(s)},f=()=>{if(window.confirm(t("admin.editor.resetConfirmation","Are you sure you want to reset all changes?")))try{const l=JSON.parse(v.current);a(l),j(!1)}catch(l){console.error("Error resetting to initial value:",l)}};return e.jsxs("div",{className:`dual-mode-editor ${u}`,children:[e.jsx("div",{className:"mb-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[k&&e.jsxs("div",{className:"flex items-center bg-gray-100 rounded-lg p-1",children:[e.jsxs("button",{type:"button",onClick:()=>M("form"),className:`flex items-center px-3 py-2 text-sm font-medium rounded-md transition-colors ${g==="form"?"bg-white text-gray-900 shadow-sm":"text-gray-500 hover:text-gray-700"}`,children:[e.jsx(i,{name:"document-text",className:"h-4 w-4 mr-2"}),t("admin.editor.formMode","Form")]}),e.jsxs("button",{type:"button",onClick:()=>M("json"),className:`flex items-center px-3 py-2 text-sm font-medium rounded-md transition-colors ${g==="json"?"bg-white text-gray-900 shadow-sm":"text-gray-500 hover:text-gray-700"}`,children:[e.jsx(i,{name:"code-bracket",className:"h-4 w-4 mr-2"}),t("admin.editor.jsonMode","JSON")]})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[h&&e.jsxs("div",{className:"flex items-center text-amber-600",children:[e.jsx(i,{name:"exclamation-triangle",className:"h-4 w-4 mr-1"}),e.jsx("span",{className:"text-sm",children:t("admin.editor.unsavedChanges","Unsaved changes")})]}),!d.isValid&&e.jsxs("div",{className:"flex items-center text-red-600",children:[e.jsx(i,{name:"x-circle",className:"h-4 w-4 mr-1"}),e.jsx("span",{className:"text-sm",children:t("admin.editor.validationErrors","Validation errors")})]}),d.isValid&&!h&&e.jsxs("div",{className:"flex items-center text-green-600",children:[e.jsx(i,{name:"check-circle",className:"h-4 w-4 mr-1"}),e.jsx("span",{className:"text-sm",children:t("admin.editor.allValid","All valid")})]})]})]}),e.jsx("div",{className:"flex items-center space-x-2",children:h&&e.jsxs("button",{type:"button",onClick:f,className:"inline-flex items-center px-3 py-1.5 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500",children:[e.jsx(i,{name:"arrow-path",className:"h-4 w-4 mr-1"}),t("admin.editor.reset","Reset")]})})]})}),e.jsx("div",{className:"editor-content",children:g==="form"?e.jsx("div",{className:"form-editor",children:x?e.jsx(x,{value:c,onChange:a,onValidationChange:m,...S}):e.jsxs("div",{className:"p-8 text-center text-gray-500 bg-gray-50 rounded-lg border-2 border-dashed border-gray-200",children:[e.jsx(i,{name:"document-text",className:"h-12 w-12 mx-auto mb-4 text-gray-400"}),e.jsx("p",{className:"text-lg font-medium mb-2",children:t("admin.editor.noFormComponent","No Form Component")}),e.jsx("p",{className:"text-sm",children:t("admin.editor.noFormComponentDesc","No form component provided for this editor.")})]})}):e.jsx("div",{className:"json-editor",children:e.jsx(I,{value:c,onChange:a,onValidationChange:m,schema:w,height:"600px",theme:"vs",showMinimap:!1,wordWrap:!0})})}),o&&!d.isValid&&d.errors.length>0&&e.jsx("div",{className:"mt-4 p-4 bg-red-50 border border-red-200 rounded-md",children:e.jsxs("div",{className:"flex",children:[e.jsx(i,{name:"exclamation-triangle",className:"h-5 w-5 text-red-400"}),e.jsxs("div",{className:"ml-3",children:[e.jsx("h4",{className:"text-sm font-medium text-red-800",children:t("admin.editor.validationSummary","Validation Summary")}),e.jsxs("div",{className:"mt-2 text-sm text-red-700",children:[e.jsx("p",{children:t("admin.editor.errorCount","{{count}} error(s) found:",{count:d.errors.length})}),e.jsxs("ul",{className:"list-disc list-inside mt-1 space-y-1",children:[d.errors.slice(0,5).map((s,l)=>e.jsx("li",{children:s.message},l)),d.errors.length>5&&e.jsx("li",{className:"text-gray-600",children:t("admin.editor.moreErrors","... and {{count}} more",{count:d.errors.length-5})})]})]})]})]})})]})};export{$ as D};
