import{u as K,a as Q,j as e,I as t}from"./index-BImwYGvy.js";import{r as n}from"./vendor-react-9AdXaApd.js";import{A as X}from"./AdminAuth-DlQsuewr.js";import{A as Y}from"./AdminNavigation-BmtWl3vA.js";import{m as g}from"./adminApi-ChCbw-zB.js";import"./mermaid-DechTdnA.js";import"./vendor-utils-CF1RCcgi.js";import"./teams-CwMtNG0x.js";import"./vendor-ui-lZiltAcz.js";import"./vendor-forms-DyVXvDXu.js";const ce=()=>{var E,L,V,R,M;const{t:s}=K(),{platformConfig:i}=Q(),j=n.useRef(null),[N,P]=n.useState(!1),[l,v]=n.useState(""),[u,S]=n.useState(!1),[c,m]=n.useState(""),[o,k]=n.useState({newPassword:"",confirmPassword:""}),[C,A]=n.useState(!1),[w,z]=n.useState(!1),[x,f]=n.useState(""),[b,U]=n.useState(null),[D,B]=n.useState(!0),[F,I]=n.useState(""),[p,T]=n.useState(null),[H,W]=n.useState(!0);n.useEffect(()=>{(async()=>{try{const r=await g("/admin/version",{method:"GET"});U(r.data),I("")}catch(r){console.error("Error fetching version info:",r),I(r.message||"Failed to load version information")}finally{B(!1)}})()},[]),n.useEffect(()=>{(async()=>{try{const r=await g("/admin/version/check-update",{method:"GET"});T(r.data)}catch(r){console.error("Error checking for updates:",r),T({updateAvailable:!1,error:r.message})}finally{W(!1)}})()},[]);const O=async()=>{P(!0),v("");try{const r=(await g("/admin/client/_refresh",{method:"POST"})).data;v({type:"success",text:s("admin.system.triggerSuccess","Force refresh triggered successfully! New salt: {{salt}}. All clients will refresh on their next page load.",{salt:r.newAdminSalt})})}catch(a){v({type:"error",text:s("admin.system.triggerError","Failed to trigger force refresh")+(a.message?`: ${a.message}`:"")})}finally{P(!1)}},G=((E=i==null?void 0:i.anonymousAuth)==null?void 0:E.enabled)&&!((L=i==null?void 0:i.admin)!=null&&L.encrypted)&&!((V=i==null?void 0:i.localAuth)!=null&&V.enabled)&&!((R=i==null?void 0:i.proxyAuth)!=null&&R.enabled)&&((M=i==null?void 0:i.auth)==null?void 0:M.mode)!=="oidc",J=async a=>{if(a.preventDefault(),!o.newPassword||!o.confirmPassword){m({type:"error",text:s("admin.system.passwordError","Both password fields are required")});return}if(o.newPassword!==o.confirmPassword){m({type:"error",text:s("admin.system.passwordMismatch","Passwords do not match")});return}if(o.newPassword.length<3){m({type:"error",text:s("admin.system.passwordTooShort","Password must be at least 3 characters long")});return}S(!0),m("");try{await g("/admin/auth/change-password",{method:"POST",body:JSON.stringify({newPassword:o.newPassword}),headers:{"Content-Type":"application/json"}}),m({type:"success",text:s("admin.system.passwordChanged","Admin password changed successfully and encrypted")}),k({newPassword:"",confirmPassword:""})}catch(r){m({type:"error",text:s("admin.system.passwordChangeError","Failed to change password")+(r.message?`: ${r.message}`:"")})}finally{S(!1)}},Z=async()=>{A(!0);try{const a=await g("/admin/backup/export",{method:"GET",responseType:"blob"}),r=a.data,d=window.URL.createObjectURL(r),h=document.createElement("a"),y=a.headers["content-disposition"],$=y&&y.match(/filename="(.+)"/),q=$?$[1]:`ihub-config-backup-${new Date().toISOString().slice(0,19).replace(/[:.]/g,"-")}.zip`;h.href=d,h.download=q,document.body.appendChild(h),h.click(),window.URL.revokeObjectURL(d),document.body.removeChild(h)}catch(a){console.error("Export error:",a),f({type:"error",text:s("admin.system.exportError","Failed to export configuration: {{error}}",{error:a.message})})}finally{A(!1)}},_=async a=>{const r=a.target.files[0];if(r){if(!r.name.endsWith(".zip")){f({type:"error",text:s("admin.system.importInvalidFile","Please select a ZIP file")});return}if(window.confirm(s("admin.system.importConfirm","Are you sure you want to import this configuration? This will replace ALL existing configurations, apps, models, and custom pages. A backup of the current configuration will be created automatically."))){z(!0),f("");try{const d=new FormData;d.append("backup",r);const y=(await g("/admin/backup/import",{method:"POST",body:d})).data;f({type:"success",text:s("admin.system.importSuccess","Configuration imported successfully! {{fileCount}} files imported. Current configuration backed up as: {{backup}}",{fileCount:y.importedFiles,backup:y.backupPath})}),j.current&&(j.current.value="")}catch(d){console.error("Import error:",d),f({type:"error",text:s("admin.system.importError","Failed to import configuration: {{error}}",{error:d.message})})}finally{z(!1)}}}};return e.jsxs(X,{children:[e.jsx(Y,{}),e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx("div",{className:"bg-white shadow-sm border-b border-gray-200",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6",children:e.jsx("div",{className:"flex justify-between items-center",children:e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:s("admin.system.title","System Administration")}),e.jsx("p",{className:"text-gray-600 mt-1",children:s("admin.system.description","Manage system-wide settings and maintenance")})]})})})}),e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:e.jsxs("div",{className:"space-y-8",children:[e.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:e.jsxs("div",{className:"flex items-start space-x-4",children:[e.jsx("div",{className:"flex-shrink-0 mt-1",children:e.jsx("div",{className:"p-3 rounded-full bg-orange-100",children:e.jsx(t,{name:"refresh",size:"lg",className:"text-orange-600"})})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:s("admin.system.forceTitle","Force Client Refresh")}),e.jsx("p",{className:"text-gray-600 mb-4",children:s("admin.system.forceDesc","Trigger a force refresh for all clients. This will clear all browser caches, localStorage, and force clients to reload all assets (JS, CSS, fonts, configurations) without using browser cache. The disclaimer acceptance will be preserved.")}),e.jsx("div",{className:"bg-amber-50 border border-amber-200 rounded-md p-4 mb-4",children:e.jsxs("div",{className:"flex",children:[e.jsx(t,{name:"warning",size:"md",className:"text-amber-500 mt-0.5 mr-3"}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-amber-800",children:s("admin.system.warningTitle","Warning")}),e.jsx("p",{className:"text-sm text-amber-700 mt-1",children:s("admin.system.warningDesc","This action will force all connected clients to reload their browsers on their next page interaction. Use this when deploying critical updates or when clients need to clear cached data.")})]})]})}),l&&e.jsx("div",{className:`p-4 rounded-md mb-4 ${l.type==="success"?"bg-green-50 border border-green-200":"bg-red-50 border border-red-200"}`,children:e.jsxs("div",{className:"flex",children:[e.jsx(t,{name:l.type==="success"?"check":"warning",size:"md",className:`mt-0.5 mr-3 ${l.type==="success"?"text-green-500":"text-red-500"}`}),e.jsx("p",{className:`text-sm ${l.type==="success"?"text-green-700":"text-red-700"}`,children:l.text})]})}),e.jsx("button",{onClick:O,disabled:N,className:`
                    inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium 
                    rounded-md shadow-sm text-white 
                    ${N?"bg-gray-400 cursor-not-allowed":"bg-orange-600 hover:bg-orange-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-orange-500"}
                  `,children:N?e.jsxs(e.Fragment,{children:[e.jsxs("svg",{className:"animate-spin -ml-1 mr-3 h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),s("admin.system.triggering","Triggering Force Refresh...")]}):e.jsxs(e.Fragment,{children:[e.jsx(t,{name:"refresh",size:"md",className:"mr-2"}),s("admin.system.trigger","Trigger Force Refresh")]})})]})]})}),G&&e.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:e.jsxs("div",{className:"flex items-start space-x-4",children:[e.jsx("div",{className:"flex-shrink-0 mt-1",children:e.jsx("div",{className:"p-3 rounded-full bg-purple-100",children:e.jsx(t,{name:"lock",size:"lg",className:"text-purple-600"})})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:s("admin.system.passwordTitle","Change Admin Password")}),e.jsx("p",{className:"text-gray-600 mb-4",children:s("admin.system.passwordDesc","Update the admin password. The new password will be encrypted using bcrypt and stored securely.")}),c&&e.jsx("div",{className:`p-4 rounded-md mb-4 ${c.type==="success"?"bg-green-50 border border-green-200":"bg-red-50 border border-red-200"}`,children:e.jsxs("div",{className:"flex",children:[e.jsx(t,{name:c.type==="success"?"check":"warning",size:"md",className:`mt-0.5 mr-3 ${c.type==="success"?"text-green-500":"text-red-500"}`}),e.jsx("p",{className:`text-sm ${c.type==="success"?"text-green-700":"text-red-700"}`,children:c.text})]})}),e.jsxs("form",{onSubmit:J,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"newPassword",className:"block text-sm font-medium text-gray-700 mb-2",children:s("admin.system.newPassword","New Password")}),e.jsx("input",{type:"password",id:"newPassword",value:o.newPassword,onChange:a=>k(r=>({...r,newPassword:a.target.value})),className:"block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-purple-500 focus:border-purple-500 sm:text-sm",placeholder:s("admin.system.newPasswordPlaceholder","Enter new password"),disabled:u})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"confirmPassword",className:"block text-sm font-medium text-gray-700 mb-2",children:s("admin.system.confirmPassword","Confirm New Password")}),e.jsx("input",{type:"password",id:"confirmPassword",value:o.confirmPassword,onChange:a=>k(r=>({...r,confirmPassword:a.target.value})),className:"block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-purple-500 focus:border-purple-500 sm:text-sm",placeholder:s("admin.system.confirmPasswordPlaceholder","Confirm new password"),disabled:u})]}),e.jsx("button",{type:"submit",disabled:u,className:`
                          inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium 
                          rounded-md shadow-sm text-white 
                          ${u?"bg-gray-400 cursor-not-allowed":"bg-purple-600 hover:bg-purple-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-purple-500"}
                        `,children:u?e.jsxs(e.Fragment,{children:[e.jsxs("svg",{className:"animate-spin -ml-1 mr-3 h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),s("admin.system.changingPassword","Changing Password...")]}):e.jsxs(e.Fragment,{children:[e.jsx(t,{name:"lock",size:"md",className:"mr-2"}),s("admin.system.changePassword","Change Password")]})})]})]})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:e.jsxs("div",{className:"flex items-start space-x-4",children:[e.jsx("div",{className:"flex-shrink-0 mt-1",children:e.jsx("div",{className:"p-3 rounded-full bg-green-100",children:e.jsx(t,{name:"archive-box",size:"lg",className:"text-green-600"})})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:s("admin.system.backupTitle","Configuration Backup & Import")}),e.jsx("p",{className:"text-gray-600 mb-4",children:s("admin.system.backupDesc","Export your complete configuration as a ZIP file for disaster recovery, or import a configuration backup to restore your system. This includes all apps, models, groups, custom pages, and frontend customizations (CSS, HTML, etc.).")}),e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-md p-4 mb-4",children:e.jsxs("div",{className:"flex",children:[e.jsx(t,{name:"information-circle",size:"md",className:"text-blue-500 mt-0.5 mr-3"}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-blue-800",children:s("admin.system.backupInfoTitle","What's included in backups")}),e.jsxs("ul",{className:"text-sm text-blue-700 mt-1 list-disc list-inside space-y-1",children:[e.jsx("li",{children:s("admin.system.backupInfo1","All configuration files (platform, apps, models, groups, UI)")}),e.jsx("li",{children:s("admin.system.backupInfo2","Custom pages and React components")}),e.jsx("li",{children:s("admin.system.backupInfo3","Prompt templates and localization files")}),e.jsx("li",{children:s("admin.system.backupInfo4","Frontend customizations (CSS, HTML, images)")}),e.jsx("li",{children:s("admin.system.backupInfo5","All data and source files")})]})]})]})}),x&&e.jsx("div",{className:`p-4 rounded-md mb-4 ${x.type==="success"?"bg-green-50 border border-green-200":"bg-red-50 border border-red-200"}`,children:e.jsxs("div",{className:"flex",children:[e.jsx(t,{name:x.type==="success"?"check":"warning",size:"md",className:`mt-0.5 mr-3 ${x.type==="success"?"text-green-500":"text-red-500"}`}),e.jsx("p",{className:`text-sm ${x.type==="success"?"text-green-700":"text-red-700"}`,children:x.text})]})}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsx("button",{onClick:Z,disabled:C,className:`
                        inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium 
                        rounded-md shadow-sm text-white 
                        ${C?"bg-gray-400 cursor-not-allowed":"bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500"}
                      `,children:C?e.jsxs(e.Fragment,{children:[e.jsxs("svg",{className:"animate-spin -ml-1 mr-3 h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),s("admin.system.exporting","Creating Backup...")]}):e.jsxs(e.Fragment,{children:[e.jsx(t,{name:"download",size:"md",className:"mr-2"}),s("admin.system.exportConfig","Export Configuration")]})}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"file",ref:j,onChange:_,accept:".zip",className:"absolute inset-0 w-full h-full opacity-0 cursor-pointer",disabled:w}),e.jsx("button",{disabled:w,className:`
                          inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium 
                          rounded-md shadow-sm text-gray-700 bg-white 
                          ${w?"cursor-not-allowed opacity-50":"hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500"}
                        `,children:w?e.jsxs(e.Fragment,{children:[e.jsxs("svg",{className:"animate-spin -ml-1 mr-3 h-4 w-4 text-gray-700",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),s("admin.system.importing","Importing Configuration...")]}):e.jsxs(e.Fragment,{children:[e.jsx(t,{name:"upload",size:"md",className:"mr-2"}),s("admin.system.importConfig","Import Configuration")]})})]})]}),e.jsx("div",{className:"mt-4 text-sm text-gray-500",children:e.jsx("p",{children:s("admin.system.backupNote","Note: Imports will automatically create a backup of your current configuration before replacing it.")})})]})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:e.jsxs("div",{className:"flex items-start space-x-4",children:[e.jsx("div",{className:"flex-shrink-0 mt-1",children:e.jsx("div",{className:"p-3 rounded-full bg-blue-100",children:e.jsx(t,{name:"information-circle",size:"lg",className:"text-blue-600"})})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:s("admin.system.versionTitle","Version Information")}),e.jsx("p",{className:"text-gray-600 mb-4",children:s("admin.system.versionDesc","Current version information for the application, frontend, and backend components.")}),!H&&p&&p.updateAvailable&&!p.error&&e.jsx("div",{className:"mb-4 bg-green-50 border border-green-200 rounded-md p-4",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx(t,{name:"check-circle",size:"md",className:"text-green-500 mt-0.5"})}),e.jsxs("div",{className:"ml-3 flex-1",children:[e.jsx("h4",{className:"text-sm font-medium text-green-800",children:s("admin.system.updateCheckTitle","Update Available")}),e.jsxs("div",{className:"mt-2 text-sm text-green-700",children:[e.jsx("p",{children:s("admin.system.updateAvailable","A new version of iHub Apps is available!")}),e.jsxs("div",{className:"mt-2 flex items-center space-x-4",children:[e.jsxs("span",{children:[e.jsxs("strong",{children:[s("admin.system.currentVersion","Current Version"),":"]})," ",p.currentVersion]}),e.jsxs("span",{children:[e.jsxs("strong",{children:[s("admin.system.latestVersion","Latest Version"),":"]})," ",p.latestVersion]})]})]}),e.jsx("div",{className:"mt-3",children:e.jsxs("a",{href:p.releaseUrl,target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center px-3 py-1.5 border border-transparent text-xs font-medium rounded-md text-green-700 bg-green-100 hover:bg-green-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500",children:[e.jsx(t,{name:"external-link",size:"sm",className:"mr-1.5"}),s("admin.system.viewRelease","View Release on GitHub")]})})]})]})}),D?e.jsxs("div",{className:"flex items-center text-gray-600",children:[e.jsxs("svg",{className:"animate-spin -ml-1 mr-3 h-5 w-5 text-blue-600",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),s("admin.system.versionLoading","Loading version information...")]}):F?e.jsx("div",{className:"p-4 rounded-md bg-red-50 border border-red-200",children:e.jsxs("div",{className:"flex",children:[e.jsx(t,{name:"warning",size:"md",className:"text-red-500 mt-0.5 mr-3"}),e.jsxs("p",{className:"text-sm text-red-700",children:[s("admin.system.versionError","Failed to load version information"),":"," ",F]})]})}):b?e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx("div",{className:"bg-gray-50 rounded-md p-4 border border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:s("admin.system.versionApp","Application Version")}),e.jsx("span",{className:"text-sm font-semibold text-gray-900",children:b.app})]})}),e.jsx("div",{className:"bg-gray-50 rounded-md p-4 border border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:s("admin.system.versionClient","Frontend Version")}),e.jsx("span",{className:"text-sm font-semibold text-gray-900",children:b.client})]})}),e.jsx("div",{className:"bg-gray-50 rounded-md p-4 border border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:s("admin.system.versionServer","Backend Version")}),e.jsx("span",{className:"text-sm font-semibold text-gray-900",children:b.server})]})}),e.jsx("div",{className:"bg-gray-50 rounded-md p-4 border border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:s("admin.system.versionNode","Node.js Version")}),e.jsx("span",{className:"text-sm font-semibold text-gray-900",children:b.node})]})})]}):null]})]})})]})})]})]})};export{ce as default};
