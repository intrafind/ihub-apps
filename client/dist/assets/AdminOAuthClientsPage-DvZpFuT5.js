import{u as q,a as B,j as e,L as O,I as r}from"./index-CdJiYb_a.js";import{e as H,r as o}from"./vendor-react-9AdXaApd.js";import{A as $}from"./AdminAuth-w86Ms2_j.js";import{A as E}from"./AdminNavigation-CghX6zwW.js";import{m as c}from"./adminApi-DCK2UDnY.js";import"./mermaid-DechTdnA.js";import"./vendor-utils-CF1RCcgi.js";import"./teams-CwMtNG0x.js";import"./vendor-ui-lZiltAcz.js";import"./vendor-forms-DyVXvDXu.js";const ae=()=>{const{t:s}=q(),f=H(),{refreshConfig:I}=B(),[F,G]=o.useState(!0),[v,z]=o.useState([]),[l,i]=o.useState(""),[m,k]=o.useState(!1),[D,C]=o.useState(!1),[x,b]=o.useState(null),[A,p]=o.useState(365),[y,S]=o.useState(null),[j,w]=o.useState(!1);o.useEffect(()=>{L(),u()},[]);const L=async()=>{var t;try{const a=(await c("/admin/configs/platform")).data;k(((t=a==null?void 0:a.oauth)==null?void 0:t.enabled)||!1)}catch(n){console.error("Failed to check OAuth status:",n)}},u=async()=>{var t,n,a;try{const g=(await c("/admin/oauth/clients")).data;z(g.clients||[])}catch(d){(a=(n=(t=d.response)==null?void 0:t.data)==null?void 0:n.error)!=null&&a.includes("OAuth is not enabled")?i({type:"warning",text:s("admin.auth.oauth.disabled","OAuth is not enabled. Enable it in Authentication settings.")}):i({type:"error",text:`${s("admin.auth.oauth.loadError","Failed to load OAuth clients")}: ${d.message}`})}finally{G(!1)}},M=async t=>{if(window.confirm(s("admin.auth.oauth.deleteConfirm","Are you sure you want to delete this OAuth client? All issued tokens will stop working.")))try{await c(`/admin/oauth/clients/${t}`,{method:"DELETE"}),i({type:"success",text:s("admin.auth.oauth.deleteSuccess","OAuth client deleted successfully")}),u()}catch(n){i({type:"error",text:`${s("admin.auth.oauth.deleteError","Failed to delete OAuth client")}: ${n.message}`})}},P=async t=>{const n=!t.active;try{await c(`/admin/oauth/clients/${t.clientId}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({active:n})}),i({type:"success",text:s(n?"admin.auth.oauth.enabledSuccess":"admin.auth.oauth.disabledSuccess",`Client ${n?"enabled":"disabled"} successfully`)}),u()}catch(a){i({type:"error",text:`${s("admin.auth.oauth.updateError","Failed to update client")}: ${a.message}`})}},R=async()=>{var n,a,d;const t=!m;try{const h=(await c("/admin/configs/platform")).data,_={...h,oauth:{...h.oauth||{},enabled:t,clientsFile:((n=h.oauth)==null?void 0:n.clientsFile)||"contents/config/oauth-clients.json",defaultTokenExpirationMinutes:((a=h.oauth)==null?void 0:a.defaultTokenExpirationMinutes)||60,maxTokenExpirationMinutes:((d=h.oauth)==null?void 0:d.maxTokenExpirationMinutes)||1440}};await c("/admin/configs/platform",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(_)}),k(t),i({type:"success",text:`OAuth ${t?"enabled":"disabled"} successfully`}),await I(),t&&u()}catch(g){i({type:"error",text:`Failed to ${t?"enable":"disable"} OAuth: ${g.message}`})}},U=async t=>{if(window.confirm(s("admin.auth.oauth.rotateSecretConfirm","Are you sure you want to rotate the secret? The old secret will stop working immediately.")))try{const d=(await c(`/admin/oauth/clients/${t}/rotate-secret`,{method:"POST"})).data.clientSecret;alert(`${s("admin.auth.oauth.rotateSecretSuccess","Secret rotated successfully. Save the new secret now.")}

${s("admin.auth.oauth.clientSecret","Client Secret")}: ${d}

${s("admin.auth.oauth.clientSecretWarning","Save this secret now. It will not be shown again.")}`),u()}catch(n){i({type:"error",text:`Failed to rotate secret: ${n.message}`})}},J=t=>{S(t),p(365),b(null),C(!0)},W=async()=>{if(y){w(!0);try{const n=(await c(`/admin/oauth/clients/${y}/generate-token`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({expirationDays:A})})).data;b({token:n.api_key,expiresAt:n.expires_at,clientId:y})}catch(t){i({type:"error",text:`Failed to generate token: ${t.message}`}),N()}finally{w(!1)}}},N=()=>{C(!1),b(null),p(365),S(null),w(!1)},T=t=>t?new Date(t).toLocaleString():s("common.notAvailable","N/A");return F?e.jsxs($,{children:[e.jsx(E,{}),e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsx(O,{size:"lg"})})]}):e.jsxs($,{children:[e.jsx(E,{}),e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx("div",{className:"bg-white shadow-sm border-b border-gray-200",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:s("admin.auth.oauth.title","OAuth Clients")}),e.jsx("p",{className:"text-gray-600 mt-1",children:s("admin.auth.oauth.subtitle","Manage OAuth 2.0 clients for external API access")})]}),m&&e.jsxs("button",{onClick:()=>f("/admin/oauth/clients/new"),className:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:[e.jsx(r,{name:"plus",size:"md",className:"mr-2"}),s("admin.auth.oauth.createClient","Create OAuth Client")]})]})})}),e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[e.jsx("div",{className:"bg-white shadow rounded-lg p-6 mb-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"OAuth 2.0 Authentication"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:m?"OAuth is currently enabled. External applications can authenticate using client credentials.":"Enable OAuth to allow external applications to authenticate and access your APIs programmatically."})]}),e.jsxs("button",{onClick:R,className:`relative inline-flex h-6 w-11 flex-shrink-0 cursor-pointer rounded-full border-2 border-transparent transition-colors duration-200 ease-in-out focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 ${m?"bg-blue-600":"bg-gray-200"}`,children:[e.jsx("span",{className:"sr-only",children:"Enable OAuth"}),e.jsx("span",{className:`pointer-events-none inline-block h-5 w-5 transform rounded-full bg-white shadow ring-0 transition duration-200 ease-in-out ${m?"translate-x-5":"translate-x-0"}`})]})]})}),l&&e.jsx("div",{className:`mb-6 p-4 rounded-md ${l.type==="success"?"bg-green-50 border border-green-200":l.type==="warning"?"bg-yellow-50 border border-yellow-200":"bg-red-50 border border-red-200"}`,children:e.jsxs("div",{className:"flex",children:[e.jsx(r,{name:l.type==="success"?"check":"warning",size:"md",className:`mt-0.5 mr-3 ${l.type==="success"?"text-green-500":l.type==="warning"?"text-yellow-500":"text-red-500"}`}),e.jsx("p",{className:`text-sm ${l.type==="success"?"text-green-700":l.type==="warning"?"text-yellow-700":"text-red-700"}`,children:l.text})]})}),v.length===0?e.jsxs("div",{className:"text-center py-12 bg-white rounded-lg shadow",children:[e.jsx(r,{name:"key",className:"mx-auto h-12 w-12 text-gray-400"}),e.jsx("h3",{className:"mt-2 text-sm font-medium text-gray-900",children:s("admin.auth.oauth.noClients","No OAuth clients configured")}),m&&e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"Get started by creating a new OAuth client."}),e.jsx("div",{className:"mt-6",children:e.jsxs("button",{onClick:()=>f("/admin/oauth/clients/new"),className:"inline-flex items-center px-4 py-2 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:[e.jsx(r,{name:"plus",size:"md",className:"mr-2"}),s("admin.auth.oauth.createClient","Create OAuth Client")]})})]})]}):e.jsx("div",{className:"bg-white shadow overflow-hidden sm:rounded-md",children:e.jsx("ul",{className:"divide-y divide-gray-200",children:v.map(t=>e.jsx("li",{children:e.jsx("div",{className:"px-4 py-4 sm:px-6 hover:bg-gray-50",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 truncate",children:t.name}),e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${t.active?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:t.active?s("admin.auth.oauth.active","Active"):s("admin.auth.oauth.suspended","Suspended")})]}),e.jsxs("div",{className:"mt-2 flex items-center text-sm text-gray-500",children:[e.jsx("code",{className:"bg-gray-100 px-2 py-1 rounded text-xs mr-4",children:t.clientId}),t.description&&e.jsx("p",{className:"truncate",children:t.description})]}),e.jsxs("div",{className:"mt-2 grid grid-cols-1 sm:grid-cols-2 gap-4 text-sm text-gray-500",children:[e.jsxs("div",{children:[e.jsxs("span",{className:"font-medium",children:[s("admin.auth.oauth.createdAt","Created"),":"]})," ",T(t.createdAt)]}),e.jsxs("div",{children:[e.jsxs("span",{className:"font-medium",children:[s("admin.auth.oauth.lastUsed","Last Used"),":"]})," ",T(t.lastUsed)]})]})]}),e.jsxs("div",{className:"flex space-x-2 ml-4",children:[e.jsx("button",{onClick:()=>f(`/admin/oauth/clients/${t.clientId}`),className:"inline-flex items-center px-3 py-2 border border-gray-300 shadow-sm text-sm leading-4 font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",title:s("common.edit","Edit"),children:e.jsx(r,{name:"pencil",size:"sm"})}),e.jsx("button",{onClick:()=>J(t.clientId),className:"inline-flex items-center px-3 py-2 border border-gray-300 shadow-sm text-sm leading-4 font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",title:s("admin.auth.oauth.generateToken","Generate Long-Term Token"),children:e.jsx(r,{name:"key",size:"sm"})}),e.jsx("button",{onClick:()=>U(t.clientId),className:"inline-flex items-center px-3 py-2 border border-gray-300 shadow-sm text-sm leading-4 font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",title:s("admin.auth.oauth.rotateSecret","Rotate Secret"),children:e.jsx(r,{name:"refresh",size:"sm"})}),e.jsx("button",{onClick:()=>P(t),className:`inline-flex items-center px-3 py-2 border shadow-sm text-sm leading-4 font-medium rounded-md focus:outline-none focus:ring-2 focus:ring-offset-2 ${t.active?"border-red-300 text-red-700 bg-white hover:bg-red-50 focus:ring-red-500":"border-green-300 text-green-700 bg-white hover:bg-green-50 focus:ring-green-500"}`,title:t.active?s("common.disable","Disable"):s("common.enable","Enable"),children:e.jsx(r,{name:t.active?"eye-slash":"eye",size:"sm"})}),e.jsx("button",{onClick:()=>M(t.clientId),className:"inline-flex items-center px-3 py-2 border border-red-300 shadow-sm text-sm leading-4 font-medium rounded-md text-red-700 bg-white hover:bg-red-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500",title:s("common.delete","Delete"),children:e.jsx(r,{name:"trash",size:"sm"})})]})]})})},t.clientId))})})]}),D&&e.jsx("div",{className:"fixed z-10 inset-0 overflow-y-auto",children:e.jsxs("div",{className:"flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0",children:[e.jsx("div",{className:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity"}),e.jsx("span",{className:"hidden sm:inline-block sm:align-middle sm:h-screen",children:"â€‹"}),e.jsx("div",{className:"inline-block align-bottom bg-white rounded-lg px-4 pt-5 pb-4 text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full sm:p-6",children:x?e.jsxs("div",{children:[e.jsx("div",{className:"mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-green-100",children:e.jsx(r,{name:"check",className:"h-6 w-6 text-green-600"})}),e.jsxs("div",{className:"mt-3 text-center sm:mt-5",children:[e.jsx("h3",{className:"text-lg leading-6 font-medium text-gray-900",children:s("admin.auth.oauth.tokenGenerated","Long-Term Token Generated")}),e.jsxs("div",{className:"mt-4",children:[e.jsx("p",{className:"text-sm text-gray-500 mb-4",children:s("admin.auth.oauth.tokenWarning","Save this token now. It will not be shown again.")}),e.jsxs("div",{className:"bg-gray-50 border border-gray-200 rounded p-3 mb-2",children:[e.jsxs("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:[s("admin.auth.oauth.token","Token"),":"]}),e.jsx("code",{className:"block text-xs break-all bg-white p-2 rounded border",children:x.token})]}),e.jsxs("div",{className:"bg-gray-50 border border-gray-200 rounded p-3",children:[e.jsxs("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:[s("admin.auth.oauth.expiresAt","Expires At"),":"]}),e.jsx("p",{className:"text-sm",children:new Date(x.expiresAt).toLocaleString()})]}),e.jsxs("button",{onClick:()=>{navigator.clipboard.writeText(x.token),i({type:"success",text:s("common.copiedToClipboard","Copied to clipboard")})},className:"mt-4 w-full inline-flex justify-center items-center px-4 py-2 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:[e.jsx(r,{name:"clipboard",size:"sm",className:"mr-2"}),s("common.copyToClipboard","Copy to Clipboard")]})]})]}),e.jsx("div",{className:"mt-5 sm:mt-6",children:e.jsx("button",{type:"button",onClick:N,className:"w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-blue-600 text-base font-medium text-white hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 sm:text-sm",children:s("common.close","Close")})})]}):e.jsxs("div",{children:[e.jsx("div",{className:"mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-blue-100",children:e.jsx(r,{name:"key",className:"h-6 w-6 text-blue-600"})}),e.jsxs("div",{className:"mt-3 text-center sm:mt-5",children:[e.jsx("h3",{className:"text-lg leading-6 font-medium text-gray-900",children:s("admin.auth.oauth.generateToken","Generate Long-Term Token")}),e.jsxs("div",{className:"mt-4",children:[e.jsx("p",{className:"text-sm text-gray-500 mb-4",children:s("admin.auth.oauth.generateTokenDesc","Select the expiration period for this token and click Generate.")}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:s("admin.auth.oauth.expirationDays","Expiration (days)")}),e.jsx("input",{type:"number",min:"1",max:"3650",value:A,onChange:t=>p(Number(t.target.value)),className:"w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500"}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:s("admin.auth.oauth.expirationRange","Enter a value between 1 and 3650 days (10 years)")})]})]})]}),e.jsxs("div",{className:"mt-5 sm:mt-6 sm:grid sm:grid-cols-2 sm:gap-3 sm:grid-flow-row-dense",children:[e.jsx("button",{type:"button",disabled:j,onClick:W,className:"w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-blue-600 text-base font-medium text-white hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 sm:col-start-2 sm:text-sm disabled:opacity-50 disabled:cursor-not-allowed",children:j?e.jsxs(e.Fragment,{children:[e.jsx(O,{size:"sm",className:"mr-2"}),s("admin.auth.oauth.generating","Generating...")]}):s("admin.auth.oauth.generate","Generate")}),e.jsx("button",{type:"button",disabled:j,onClick:N,className:"mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 sm:mt-0 sm:col-start-1 sm:text-sm disabled:opacity-50 disabled:cursor-not-allowed",children:s("common.cancel","Cancel")})]})]})})]})})]})]})};export{ae as default};
