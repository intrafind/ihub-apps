import{u as I,g as c,j as e,I as o}from"./index-CdJiYb_a.js";import{e as M,r}from"./vendor-react-9AdXaApd.js";import{A as J}from"./AdminAuth-w86Ms2_j.js";import{A as q}from"./AdminNavigation-CghX6zwW.js";import{a as z,m as C,t as B,d as G}from"./adminApi-DCK2UDnY.js";import"./mermaid-DechTdnA.js";import"./vendor-utils-CF1RCcgi.js";import"./teams-CwMtNG0x.js";import"./vendor-ui-lZiltAcz.js";import"./vendor-forms-DyVXvDXu.js";const te=()=>{const{t,i18n:k}=I(),d=k.language,p=M(),[S,b]=r.useState([]),[A,j]=r.useState(!0),[N,i]=r.useState(null),[m,E]=r.useState(""),[g,L]=r.useState("all"),[h,D]=r.useState("all"),[x,w]=r.useState(!1);r.useEffect(()=>{f()},[]);const f=async()=>{try{j(!0),i(null);const s=await z(),a=Array.isArray(s)?s:[];b(a),a.length===0&&console.warn("No tools returned from API")}catch(s){console.error("Error loading tools:",s),i(s.message),b([])}finally{j(!1)}},F=async s=>{try{await B(s),await f()}catch(a){i(a.message)}},O=async s=>{if(confirm(t("admin.tools.deleteConfirm","Are you sure you want to delete this tool?")))try{await G(s),await f(),alert(t("admin.tools.deleteSuccess","Tool deleted successfully"))}catch(a){console.error("Error deleting tool:",a),alert(a.message||"Failed to delete tool")}},P=s=>{p("/admin/tools/new",{state:{templateTool:s}})},R=async s=>{try{const l=(await C(`/admin/tools/${s}`)).data,n=JSON.stringify(l,null,2),U=new Blob([n],{type:"application/json"}),T=URL.createObjectURL(U),u=document.createElement("a");u.href=T,u.download=`tool-${s}.json`,document.body.appendChild(u),u.click(),document.body.removeChild(u),URL.revokeObjectURL(T)}catch(a){i(`Failed to download tool config: ${a.message}`)}},$=async s=>{const a=s.target.files[0];if(!a)return;if(!a.name.endsWith(".json")){i("Please select a JSON file");return}w(!0);let l;try{const n=await a.text();if(l=JSON.parse(n),!l.id||!l.name||!l.description)throw new Error("Invalid tool config: missing required fields (id, name, description)");await C("/admin/tools",{method:"POST",body:l}),await f(),s.target.value=""}catch(n){n.message.includes("already exists")?i(`Tool with ID "${(l==null?void 0:l.id)||"unknown"}" already exists`):n instanceof SyntaxError?i("Invalid JSON file format"):i(`Failed to upload tool config: ${n.message}`)}finally{w(!1)}},y=s=>s.isSpecialTool||s.provider?"special":s.functions&&Object.keys(s.functions).length>0?"multi-function":"regular",v=[...S.filter(s=>{const a=m===""||c(s.name,d).toLowerCase().includes(m.toLowerCase())||c(s.description,d).toLowerCase().includes(m.toLowerCase())||s.id.toLowerCase().includes(m.toLowerCase()),l=g==="all"||g==="enabled"&&s.enabled!==!1||g==="disabled"&&s.enabled===!1,n=h==="all"||y(s)===h;return a&&l&&n})].sort((s,a)=>{const l=c(s.name,d),n=c(a.name,d);return l.localeCompare(n)});return A?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-600"})}):N?e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-md p-4",children:e.jsxs("div",{className:"flex",children:[e.jsx(o,{name:"exclamation-triangle",className:"h-5 w-5 text-red-400"}),e.jsxs("div",{className:"ml-3",children:[e.jsx("h3",{className:"text-sm font-medium text-red-800",children:t("admin.tools.loadError","Error loading tools")}),e.jsx("p",{className:"mt-1 text-sm text-red-700",children:N}),e.jsx("button",{onClick:()=>window.location.reload(),className:"mt-2 text-sm text-red-600 hover:text-red-500",children:t("common.retry","Retry")})]})]})}):e.jsx(J,{children:e.jsxs("div",{children:[e.jsx(q,{}),e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[e.jsxs("div",{className:"sm:flex sm:items-center",children:[e.jsxs("div",{className:"sm:flex-auto",children:[e.jsx("h1",{className:"text-2xl font-semibold text-gray-900",children:t("admin.tools.title","Tool Management")}),e.jsx("p",{className:"mt-2 text-sm text-gray-700",children:t("admin.tools.subtitle","Create, edit, and manage AI tools / function calling for your iHub Apps")})]}),e.jsx("div",{className:"mt-4 sm:mt-0 sm:ml-16 sm:flex-none",children:e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs("button",{onClick:()=>p("/admin/tools/new"),className:"inline-flex items-center justify-center rounded-md border border-transparent bg-indigo-600 px-4 py-2 text-sm font-medium text-white shadow-sm hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 sm:w-auto",children:[e.jsx(o,{name:"plus",className:"h-4 w-4 mr-2"}),t("admin.tools.createNew","Create New Tool")]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"file",accept:".json",onChange:$,className:"absolute inset-0 w-full h-full opacity-0 cursor-pointer",disabled:x}),e.jsxs("button",{type:"button",className:"inline-flex items-center justify-center rounded-md border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 shadow-sm hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed",disabled:x,title:t("admin.tools.uploadConfig","Upload Tool Config"),children:[e.jsx(o,{name:x?"refresh":"upload",className:`h-4 w-4 mr-2 ${x?"animate-spin":""}`}),x?t("admin.tools.uploading","Uploading..."):t("admin.tools.uploadConfig","Upload Config")]})]})]})})]}),e.jsxs("div",{className:"mt-8 flex flex-col sm:flex-row gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(o,{name:"search",className:"h-5 w-5 text-gray-400"})}),e.jsx("input",{type:"text",className:"block w-full pl-10 pr-3 py-2 border border-gray-300 rounded-md leading-5 bg-white placeholder-gray-500 focus:outline-none focus:placeholder-gray-400 focus:ring-1 focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm",placeholder:t("admin.tools.searchPlaceholder","Search tools..."),value:m,onChange:s=>E(s.target.value)})]})}),e.jsx("div",{className:"sm:w-48",children:e.jsxs("select",{value:g,onChange:s=>L(s.target.value),className:"block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm",children:[e.jsx("option",{value:"all",children:t("admin.tools.filterAll","All Tools")}),e.jsx("option",{value:"enabled",children:t("admin.tools.filterEnabled","Enabled Only")}),e.jsx("option",{value:"disabled",children:t("admin.tools.filterDisabled","Disabled Only")})]})}),e.jsx("div",{className:"sm:w-48",children:e.jsxs("select",{value:h,onChange:s=>D(s.target.value),className:"block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm",children:[e.jsx("option",{value:"all",children:t("admin.tools.filterAllTypes","All Types")}),e.jsx("option",{value:"regular",children:t("admin.tools.filterRegular","Regular Tools")}),e.jsx("option",{value:"multi-function",children:t("admin.tools.filterMultiFunction","Multi-Function")}),e.jsx("option",{value:"special",children:t("admin.tools.filterSpecial","Special Tools")})]})})]}),e.jsx("div",{className:"mt-8 flex flex-col",children:e.jsx("div",{className:"-my-2 -mx-4 overflow-x-auto sm:-mx-6 lg:-mx-8",children:e.jsx("div",{className:"inline-block min-w-full py-2 align-middle md:px-6 lg:px-8",children:e.jsxs("div",{className:"overflow-hidden shadow ring-1 ring-black ring-opacity-5 md:rounded-lg",children:[e.jsxs("table",{className:"min-w-full divide-y divide-gray-300",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:t("admin.tools.table.name","Name")}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:t("admin.tools.table.type","Type")}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:t("admin.tools.table.description","Description")}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:t("admin.tools.table.script","Script")}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:t("admin.tools.table.status","Status")}),e.jsx("th",{scope:"col",className:"relative px-6 py-3",children:e.jsx("span",{className:"sr-only",children:t("admin.tools.table.actions","Actions")})})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:v.map(s=>e.jsxs("tr",{className:"hover:bg-gray-50 cursor-pointer",onClick:()=>p(`/admin/tools/${s.id}`),children:[e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0 h-8 w-8",children:e.jsx("div",{className:"h-8 w-8 rounded-full bg-indigo-100 flex items-center justify-center",children:e.jsx(o,{name:s.functions?"layers":s.isSpecialTool?"star":"wrench",className:"h-4 w-4 text-indigo-600"})})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:c(s.name,d)}),e.jsx("div",{className:"text-sm text-gray-500",children:s.id})]})]})}),e.jsx("td",{className:"px-6 py-4",children:y(s)==="special"?e.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800",children:t("admin.tools.typeSpecial","Special")}):y(s)==="multi-function"?e.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-purple-100 text-purple-800",children:t("admin.tools.typeMultiFunction","Multi-Function")}):e.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800",children:t("admin.tools.typeRegular","Regular")})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("div",{className:"text-sm text-gray-900 max-w-xs truncate",children:s.description?c(s.description,d):"-"})}),e.jsx("td",{className:"px-6 py-4 text-sm text-gray-900",children:s.script?e.jsx("code",{className:"text-xs bg-gray-100 px-2 py-1 rounded",children:s.script}):s.provider?e.jsx("span",{className:"text-gray-400 text-xs",children:s.provider}):e.jsx("span",{className:"text-gray-400",children:"-"})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${s.enabled!==!1?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"}`,children:s.enabled!==!1?t("admin.tools.enabled","Enabled"):t("admin.tools.disabled","Disabled")})}),e.jsx("td",{className:"px-6 py-4 text-right text-sm font-medium",children:e.jsxs("div",{className:"flex items-center justify-end space-x-2",children:[e.jsx("button",{onClick:a=>{a.stopPropagation(),F(s.id)},className:`p-2 rounded-full ${s.enabled!==!1?"text-red-600 hover:bg-red-50":"text-green-600 hover:bg-green-50"}`,title:s.enabled!==!1?t("admin.tools.disable","Disable"):t("admin.tools.enable","Enable"),children:e.jsx(o,{name:s.enabled!==!1?"eye-slash":"eye",className:"h-4 w-4"})}),e.jsx("button",{onClick:a=>{a.stopPropagation(),P(s)},className:"p-2 text-blue-600 hover:bg-blue-50 rounded-full",title:t("admin.tools.clone","Clone"),children:e.jsx(o,{name:"copy",className:"h-4 w-4"})}),e.jsx("button",{onClick:a=>{a.stopPropagation(),R(s.id)},className:"p-2 text-green-600 hover:bg-green-50 rounded-full",title:t("admin.tools.download","Download Config"),children:e.jsx(o,{name:"download",className:"h-4 w-4"})}),e.jsx("button",{onClick:a=>{a.stopPropagation(),p(`/admin/tools/${s.id}`)},className:"p-2 text-indigo-600 hover:bg-indigo-50 rounded-full",title:t("admin.tools.edit","Edit"),children:e.jsx(o,{name:"pencil",className:"h-4 w-4"})}),e.jsx("button",{onClick:a=>{a.stopPropagation(),O(s.id)},className:"p-2 text-red-600 hover:bg-red-50 rounded-full",title:t("admin.tools.delete","Delete"),children:e.jsx(o,{name:"trash",className:"h-4 w-4"})})]})})]},s.id))})]}),v.length===0&&e.jsxs("div",{className:"text-center py-12 bg-gray-50",children:[e.jsx(o,{name:"wrench",className:"mx-auto h-12 w-12 text-gray-400"}),e.jsx("h3",{className:"mt-2 text-sm font-medium text-gray-900",children:t("admin.tools.noTools","No tools found")}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:t("admin.tools.noToolsDescription","Get started by creating a new tool.")})]})]})})})})]})]})})};export{te as default};
