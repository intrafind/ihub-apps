import{u as B,j as e,L as U,I as d}from"./index-CdJiYb_a.js";import{e as G,u as H,r as n}from"./vendor-react-9AdXaApd.js";import{A as C}from"./AdminAuth-w86Ms2_j.js";import{A as S}from"./AdminNavigation-CghX6zwW.js";import{R as k}from"./ResourceSelector-Ds8e5c_J.js";import{m}from"./adminApi-DCK2UDnY.js";import"./mermaid-DechTdnA.js";import"./vendor-utils-CF1RCcgi.js";import"./teams-CwMtNG0x.js";import"./vendor-ui-lZiltAcz.js";import"./vendor-forms-DyVXvDXu.js";const ne=()=>{const{t:s}=B(),b=G(),{clientId:u}=H(),o=u==="new",[M,E]=n.useState(!o),[f,y]=n.useState(!1),[i,h]=n.useState(""),[j,O]=n.useState(""),[w,I]=n.useState(""),[F,v]=n.useState(!1),[R,$]=n.useState([]),[D,T]=n.useState([]),[l,x]=n.useState({name:"",description:"",allowedApps:[],allowedModels:[],tokenExpirationMinutes:60,active:!0});n.useEffect(()=>{z(),o||L()},[u]);const z=async()=>{try{const t=(await m("/admin/apps")).data,r=Array.isArray(t)?t:Object.values(t.apps||{});$(r);const c=(await m("/admin/models")).data,g=Array.isArray(c)?c:Object.values(c.models||{});T(g)}catch(a){console.error("Failed to load apps/models:",a)}},L=async()=>{try{const t=(await m(`/admin/oauth/clients/${u}`)).data;x({name:t.client.name||"",description:t.client.description||"",allowedApps:t.client.allowedApps||[],allowedModels:t.client.allowedModels||[],tokenExpirationMinutes:t.client.tokenExpirationMinutes||60,active:t.client.active!==!1})}catch(a){h({type:"error",text:`${s("admin.auth.oauth.loadError","Failed to load OAuth client")}: ${a.message}`})}finally{E(!1)}},P=async a=>{a.preventDefault(),y(!0),h("");try{if(o){const r=(await m("/admin/oauth/clients",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(l)})).data;O(r.client.clientId),I(r.client.clientSecret),v(!0)}else await m(`/admin/oauth/clients/${u}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(l)}),h({type:"success",text:s("admin.auth.oauth.updateSuccess","OAuth client updated successfully")})}catch(t){h({type:"error",text:`${o?s("admin.auth.oauth.createError","Failed to create OAuth client"):s("admin.auth.oauth.updateError","Failed to update OAuth client")}: ${t.message}`})}finally{y(!1)}},p=a=>{const{name:t,value:r,type:A,checked:c}=a.target;x(g=>({...g,[t]:A==="checkbox"?c:r}))},W=a=>{x(t=>({...t,allowedApps:a}))},J=a=>{x(t=>({...t,allowedModels:a}))},N=a=>{navigator.clipboard.writeText(a)},q=()=>{v(!1),b("/admin/oauth/clients")};return M?e.jsxs(C,{children:[e.jsx(S,{}),e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsx(U,{size:"lg"})})]}):e.jsxs(C,{children:[e.jsx(S,{}),e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx("div",{className:"bg-white shadow-sm border-b border-gray-200",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("button",{onClick:()=>b("/admin/oauth/clients"),className:"mr-4 text-gray-400 hover:text-gray-600",children:e.jsx(d,{name:"arrow-left",size:"md"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:o?s("admin.auth.oauth.createClient","Create OAuth Client"):s("admin.auth.oauth.editClient","Edit OAuth Client")}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Configure client credentials and permissions for external API access"})]})]})})}),e.jsxs("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[i&&e.jsx("div",{className:`mb-6 p-4 rounded-md ${i.type==="success"?"bg-green-50 border border-green-200":"bg-red-50 border border-red-200"}`,children:e.jsxs("div",{className:"flex",children:[e.jsx(d,{name:i.type==="success"?"check":"warning",size:"md",className:`mt-0.5 mr-3 ${i.type==="success"?"text-green-500":"text-red-500"}`}),e.jsx("p",{className:`text-sm ${i.type==="success"?"text-green-700":"text-red-700"}`,children:i.text})]})}),e.jsxs("form",{onSubmit:P,className:"bg-white shadow rounded-lg p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:s("common.basicInfo","Basic Information")}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"name",className:"block text-sm font-medium text-gray-700",children:[s("admin.auth.oauth.name","Client Name")," *"]}),e.jsx("input",{type:"text",id:"name",name:"name",required:!0,value:l.name,onChange:p,className:"mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"description",className:"block text-sm font-medium text-gray-700",children:s("admin.auth.oauth.description","Description")}),e.jsx("textarea",{id:"description",name:"description",rows:3,value:l.description,onChange:p,className:"mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"tokenExpirationMinutes",className:"block text-sm font-medium text-gray-700",children:s("admin.auth.oauth.tokenExpiration","Token Expiration (minutes)")}),e.jsx("input",{type:"number",id:"tokenExpirationMinutes",name:"tokenExpirationMinutes",min:"1",max:"1440",value:l.tokenExpirationMinutes,onChange:p,className:"mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"Default: 60 minutes, Maximum: 1440 minutes (24 hours)"})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",id:"active",name:"active",checked:l.active,onChange:p,className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),e.jsx("label",{htmlFor:"active",className:"ml-2 block text-sm text-gray-900",children:s("admin.auth.oauth.active","Active")})]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:s("admin.auth.oauth.allowedApps","Allowed Apps")}),e.jsx(k,{label:s("admin.auth.oauth.allowedApps","Allowed Apps"),resources:R,selectedResources:l.allowedApps,onSelectionChange:W,placeholder:s("admin.auth.oauth.searchApps","Search apps to add..."),emptyMessage:s("admin.auth.oauth.noAppsSelected","No apps selected - client can access all apps"),allowWildcard:!0})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:s("admin.auth.oauth.allowedModels","Allowed Models")}),e.jsx(k,{label:s("admin.auth.oauth.allowedModels","Allowed Models"),resources:D,selectedResources:l.allowedModels,onSelectionChange:J,placeholder:s("admin.auth.oauth.searchModels","Search models to add..."),emptyMessage:s("admin.auth.oauth.noModelsSelected","No models selected - client can access all models"),allowWildcard:!0})]}),e.jsxs("div",{className:"flex justify-end space-x-4 pt-6 border-t border-gray-200",children:[e.jsx("button",{type:"button",onClick:()=>b("/admin/oauth/clients"),className:"px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:s("common.cancel","Cancel")}),e.jsx("button",{type:"submit",disabled:f,className:"px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50",children:f?s("common.saving","Saving..."):o?s("common.create","Create"):s("common.save","Save")})]})]})]})]}),F&&e.jsx("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50 flex items-center justify-center",children:e.jsx("div",{className:"relative bg-white rounded-lg shadow-xl max-w-2xl w-full mx-4",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx(d,{name:"check",className:"h-6 w-6 text-green-500 mr-3"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:s("admin.auth.oauth.createSuccess","OAuth client created successfully")})]}),e.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-md p-4 mb-4",children:e.jsxs("div",{className:"flex",children:[e.jsx(d,{name:"warning",className:"h-5 w-5 text-yellow-400 mr-3 mt-0.5"}),e.jsx("div",{children:e.jsx("h4",{className:"text-sm font-medium text-yellow-800",children:s("admin.auth.oauth.clientSecretWarning","Save this secret now. It will not be shown again.")})})]})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:s("admin.auth.oauth.clientId","Client ID")}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("code",{className:"flex-1 bg-gray-100 px-3 py-2 rounded text-sm break-all",children:j}),e.jsx("button",{type:"button",onClick:()=>N(j),className:"px-3 py-2 border border-gray-300 rounded-md text-sm hover:bg-gray-50",children:e.jsx(d,{name:"clipboard",size:"sm"})})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:s("admin.auth.oauth.clientSecret","Client Secret")}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("code",{className:"flex-1 bg-gray-100 px-3 py-2 rounded text-sm break-all",children:w}),e.jsx("button",{type:"button",onClick:()=>N(w),className:"px-3 py-2 border border-gray-300 rounded-md text-sm hover:bg-gray-50",children:e.jsx(d,{name:"clipboard",size:"sm"})})]})]})]}),e.jsx("div",{className:"mt-6 flex justify-end",children:e.jsx("button",{onClick:q,className:"px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:s("common.close","Close")})})]})})})]})};export{ne as default};
