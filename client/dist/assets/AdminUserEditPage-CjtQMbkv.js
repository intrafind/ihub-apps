import{u as q,j as e,I as w,L as A}from"./index-CdJiYb_a.js";import{r as x,u as T,e as I}from"./vendor-react-9AdXaApd.js";import{A as k}from"./AdminAuth-w86Ms2_j.js";import{A as P}from"./AdminNavigation-CghX6zwW.js";import{D as F}from"./DualModeEditor-u5gL3giJ.js";import{i as E,v as $,e as G,a as O}from"./schemaValidation-BmW9IFx4.js";import{m as U}from"./adminApi-DCK2UDnY.js";import{g as R}from"./schemaService-Ch_9A-Q2.js";import"./mermaid-DechTdnA.js";import"./vendor-utils-CF1RCcgi.js";import"./teams-CwMtNG0x.js";import"./vendor-ui-lZiltAcz.js";import"./vendor-forms-DyVXvDXu.js";import"./monaco-CCrBizaJ.js";const B=({value:r,onChange:p,onValidationChange:g,isNewUser:i=!1,jsonSchema:o})=>{const{t}=q(),[d,v]=x.useState({}),[h,N]=x.useState(""),f=s=>{let n={};if(o){const b=i?{...s,id:"temp-id"}:s,a=$(b,o);a.isValid||(n=G(a.errors),i&&n.id&&delete n.id)}else s.username?/^[a-zA-Z0-9_.-]+$/.test(s.username)||(n.username=t("admin.users.validation.usernameInvalid","Username can only contain letters, numbers, periods, hyphens, and underscores")):n.username=t("admin.users.validation.usernameRequired","Username is required"),s.email?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(s.email)||(n.email=t("admin.users.validation.emailInvalid","Please enter a valid email address")):n.email=t("admin.users.validation.emailRequired","Email is required"),i&&!s.password?n.password=t("admin.users.validation.passwordRequired","Password is required"):s.password&&s.password.length<6&&(n.password=t("admin.users.validation.passwordTooShort","Password must be at least 6 characters long"));const l=O(s.password,h);l&&(n.confirmPassword=t("admin.users.validation.passwordMismatch",l)),v(n);const y=Object.keys(n).length===0;return g&&g({isValid:y,errors:Object.entries(n).map(([b,a])=>({field:b,message:a,severity:"error"}))}),y};x.useEffect(()=>{r&&f(r)},[r,h,o]);const m=(s,n)=>{const l={...r,[s]:n};p(l)},C=s=>{const n=s.split(",").map(l=>l.trim()).filter(l=>l.length>0);m("groups",n)};return r?e.jsxs("div",{className:"user-form-editor space-y-6",children:[e.jsx("div",{className:"bg-white shadow px-4 py-5 sm:rounded-lg sm:p-6",children:e.jsxs("div",{className:"md:grid md:grid-cols-3 md:gap-6",children:[e.jsxs("div",{className:"md:col-span-1",children:[e.jsx("h3",{className:"text-lg font-medium leading-6 text-gray-900",children:t("admin.users.basicInformation","Basic Information")}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:t("admin.users.basicUserConfiguration","Basic user configuration and contact information")})]}),e.jsx("div",{className:"mt-5 md:col-span-2 md:mt-0",children:e.jsxs("div",{className:"grid grid-cols-6 gap-6",children:[e.jsxs("div",{className:"col-span-6 sm:col-span-3",children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700",children:[t("admin.users.username","Username"),E("username",o)&&e.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),e.jsx("input",{type:"text",required:E("username",o),value:r.username||"",onChange:s=>m("username",s.target.value),disabled:!i,className:`mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm disabled:bg-gray-100 ${d.username?"border-red-300":""}`,placeholder:"Enter username"}),d.username&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:d.username}),!i&&e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:t("admin.users.usernameCannotBeChanged","Username cannot be changed after creation")})]}),e.jsxs("div",{className:"col-span-6 sm:col-span-3",children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700",children:[t("admin.users.email","Email"),E("email",o)&&e.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),e.jsx("input",{type:"email",required:E("email",o),value:r.email||"",onChange:s=>m("email",s.target.value),className:`mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm ${d.email?"border-red-300":""}`,placeholder:"Enter email address"}),d.email&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:d.email})]}),e.jsxs("div",{className:"col-span-6",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:t("admin.users.fullName","Full Name")}),e.jsx("input",{type:"text",value:r.fullName||"",onChange:s=>m("fullName",s.target.value),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm",placeholder:"Enter full name"})]}),e.jsxs("div",{className:"col-span-6",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:r.enabled!==!1,onChange:s=>m("enabled",s.target.checked),className:"h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded"}),e.jsx("label",{className:"ml-2 block text-sm text-gray-900",children:t("admin.users.enabled","Enabled")})]}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Disabled users cannot log in or access the system"})]})]})})]})}),e.jsx("div",{className:"bg-white shadow px-4 py-5 sm:rounded-lg sm:p-6",children:e.jsxs("div",{className:"md:grid md:grid-cols-3 md:gap-6",children:[e.jsxs("div",{className:"md:col-span-1",children:[e.jsx("h3",{className:"text-lg font-medium leading-6 text-gray-900",children:t("admin.users.passwordSettings","Password Settings")}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:i?t("admin.users.setInitialPassword","Set the initial password for this user"):t("admin.users.changePassword","Leave blank to keep current password")})]}),e.jsx("div",{className:"mt-5 md:col-span-2 md:mt-0",children:e.jsxs("div",{className:"grid grid-cols-6 gap-6",children:[e.jsxs("div",{className:"col-span-6 sm:col-span-3",children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700",children:[i?t("admin.users.password","Password"):t("admin.users.newPassword","New Password"),i&&e.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),e.jsx("input",{type:"password",required:i,value:r.password||"",onChange:s=>m("password",s.target.value),className:`mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm ${d.password?"border-red-300":""}`,placeholder:i?"Enter password":"Enter new password (optional)"}),d.password&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:d.password})]}),e.jsxs("div",{className:"col-span-6 sm:col-span-3",children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700",children:[t("admin.users.confirmPassword","Confirm Password"),(i||r.password)&&e.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),e.jsx("input",{type:"password",required:i||r.password,value:h,onChange:s=>N(s.target.value),className:`mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm ${d.confirmPassword?"border-red-300":""}`,placeholder:"Confirm password"}),d.confirmPassword&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:d.confirmPassword})]}),e.jsx("div",{className:"col-span-6",children:e.jsx("p",{className:"text-xs text-gray-500",children:"Password must be at least 6 characters long and should contain a mix of letters, numbers, and special characters."})})]})})]})}),e.jsx("div",{className:"bg-white shadow px-4 py-5 sm:rounded-lg sm:p-6",children:e.jsxs("div",{className:"md:grid md:grid-cols-3 md:gap-6",children:[e.jsxs("div",{className:"md:col-span-1",children:[e.jsx("h3",{className:"text-lg font-medium leading-6 text-gray-900",children:t("admin.users.groupMembership","Group Membership")}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"Assign this user to groups to control their permissions and access levels"})]}),e.jsx("div",{className:"mt-5 md:col-span-2 md:mt-0",children:e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Groups (comma-separated)"}),e.jsx("input",{type:"text",value:(r.groups||[]).join(", "),onChange:s=>C(s.target.value),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm",placeholder:"admin, users, editors"}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Enter group names separated by commas. Users inherit permissions from all assigned groups."}),r.groups&&r.groups.length>0&&e.jsxs("div",{className:"mt-3",children:[e.jsx("p",{className:"text-sm font-medium text-gray-700 mb-2",children:"Current Groups:"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:r.groups.map((s,n)=>e.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800",children:[e.jsx(w,{name:"users",size:"xs",className:"mr-1"}),s]},n))})]})]})})]})})]}):e.jsxs("div",{className:"p-8 text-center text-gray-500",children:[e.jsx(w,{name:"exclamation-triangle",className:"h-12 w-12 mx-auto mb-4 text-gray-400"}),e.jsx("p",{className:"text-lg font-medium",children:t("admin.users.edit.noUserData","No user data available")})]})},ee=()=>{const{t:r}=q(),{userId:p}=T(),g=I(),[i,o]=x.useState(null),[t,d]=x.useState(!0),[v,h]=x.useState(!1),[N,f]=x.useState(null),[m,C]=x.useState(null),s=p==="new";x.useEffect(()=>{n(),s?(o({username:"",email:"",fullName:"",name:"",password:"",groups:[],internalGroups:[],enabled:!0,active:!0}),d(!1),f(null)):(async()=>{try{d(!0);const j=(await U("/admin/auth/users")).data,u=Object.values(j.users||{}).find(S=>S.id===p);if(!u)throw new Error("User not found");o({...u,password:""})}catch(c){f(c.message)}finally{d(!1)}})()},[p]);const n=async()=>{try{const a=await R("user");C(a)}catch(a){console.error("Failed to load user schema:",a)}},l=async a=>{if(a||(a=i),!a.username||!a.email){f("Username and email are required");return}try{h(!0);const c=s?"POST":"PUT",j=s?"/admin/auth/users":`/admin/auth/users/${p}`,u={username:a.username,email:a.email,name:a.fullName||a.name||"",internalGroups:a.groups||a.internalGroups||[],active:a.enabled!==!1};if(a.password&&(u.password=a.password),s&&!a.password)throw new Error("Password is required for new users");const S=await U(j,{method:c,headers:{"Content-Type":"application/json"},body:JSON.stringify(u)});g("/admin/users")}catch(c){throw f(c.message),c}finally{h(!1)}},y=a=>{o(a)},b=async a=>{a.preventDefault(),await l(i)};return t?e.jsxs(k,{children:[e.jsx(P,{}),e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsx(A,{size:"lg"})})]}):N?e.jsxs(k,{children:[e.jsx(P,{}),e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-md p-4",children:e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx(w,{name:"warning",size:"md",className:"text-red-400"})}),e.jsxs("div",{className:"ml-3",children:[e.jsx("h3",{className:"text-sm font-medium text-red-800",children:"Error"}),e.jsx("div",{className:"mt-2 text-sm text-red-700",children:N})]})]})})})]}):e.jsxs(k,{children:[e.jsx(P,{}),e.jsxs("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[e.jsx("div",{className:"mb-8",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-semibold text-gray-900",children:s?r("admin.users.edit.createTitle","Create New User"):r("admin.users.edit.editTitle","Edit User")}),e.jsx("p",{className:"mt-1 text-sm text-gray-600",children:s?r("admin.users.edit.createDesc","Create a new user account with permissions and settings"):r("admin.users.edit.editDesc","Edit user account, permissions, and settings")})]}),e.jsxs("div",{className:"flex space-x-3",children:[!s&&e.jsxs("button",{type:"button",onClick:()=>{const a=JSON.stringify(i,null,2),c="data:application/json;charset=utf-8,"+encodeURIComponent(a),j=`user-${i.username}.json`,u=document.createElement("a");u.setAttribute("href",c),u.setAttribute("download",j),u.click()},className:"inline-flex items-center px-4 py-2 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500",children:[e.jsx(w,{name:"download",className:"h-4 w-4 mr-2"}),r("common.download")]}),e.jsxs("button",{onClick:()=>g("/admin/users"),className:"inline-flex items-center px-4 py-2 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500",children:[e.jsx(w,{name:"arrow-left",className:"h-4 w-4 mr-2"}),r("admin.users.edit.backToList","Back to Users")]})]})]})}),e.jsxs("form",{onSubmit:b,className:"space-y-8",children:[e.jsx(F,{value:i,onChange:y,formComponent:B,formProps:{isNewUser:s,jsonSchema:m},jsonSchema:m,title:s?r("admin.users.edit.createTitle","Create New User"):r("admin.users.edit.editTitle","Edit User")}),e.jsxs("div",{className:"flex justify-end space-x-4",children:[e.jsx("button",{type:"button",onClick:()=>g("/admin/users"),className:"px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500",children:r("admin.users.edit.cancel","Cancel")}),e.jsx("button",{type:"submit",disabled:v,className:"px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 disabled:opacity-50",children:v?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2 inline-block"}),r("admin.users.edit.saving","Saving...")]}):r("admin.users.edit.save",s?"Create User":"Save User")})]})]})]})]})};export{ee as default};
