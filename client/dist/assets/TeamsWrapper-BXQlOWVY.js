import{u as I,c as v,k as w,e as S,j as a,L as N}from"./index-CdJiYb_a.js";import{r as n}from"./vendor-react-9AdXaApd.js";import{B as j,E,L as P,p as z,w as A,k as F,m as D,s as R,f as W}from"./teams-CwMtNG0x.js";import"./mermaid-DechTdnA.js";import"./vendor-utils-CF1RCcgi.js";import"./vendor-forms-DyVXvDXu.js";import"./vendor-ui-lZiltAcz.js";function B(){const{t:s}=I(),[f,l]=n.useState(!1),[o,m]=n.useState(!1),[h,u]=n.useState(null),[,c]=n.useState(null),{loginWithToken:g,isAuthenticated:x}=v();n.useEffect(()=>{p()},[p]);const p=n.useCallback(async()=>{try{await j(),E(e=>{c(e),console.log("Teams context:",e),k(e.theme),C(e.locale),P(k),l(!0),x||d()})}catch(e){console.error("Failed to initialize Teams:",e),u(s("teams.errors.initializationFailed")),l(!0)}},[s,d,x]),C=e=>{if(!e)return;const t={"en-US":"en","en-GB":"en",en:"en","de-DE":"de","de-AT":"de","de-CH":"de",de:"de"},r=e.split("-")[0],i=t[e]||t[r]||"en";w.language!==i&&w.changeLanguage(i).catch(b=>{console.warn("Failed to change language to",i,b)})},k=e=>{const t=document.documentElement;switch(e){case"dark":t.classList.add("dark"),t.style.setProperty("--teams-bg","#1e1e1e"),t.style.setProperty("--teams-text","#ffffff");break;case"contrast":t.classList.add("dark"),t.style.setProperty("--teams-bg","#000000"),t.style.setProperty("--teams-text","#ffffff");break;default:t.classList.remove("dark"),t.style.setProperty("--teams-bg","#ffffff"),t.style.setProperty("--teams-text","#323130")}},d=n.useCallback(async()=>{var e,t;if(!o){m(!0),u(null);try{const r=await new Promise((b,L)=>{z({successCallback:T=>b(T),failureCallback:T=>L(T),resources:[]})}),i=await S.post("/auth/teams/exchange",{ssoToken:r});if(i.data.success&&i.data.token)await g(i.data.token),A();else throw new Error(i.data.error||s("teams.errors.authenticationFailed"))}catch(r){console.error("Teams authentication error:",r),u(r.message||s("teams.errors.authenticationFailed")),((e=r.message)!=null&&e.includes("consent_required")||(t=r.message)!=null&&t.includes("interaction_required"))&&y()}finally{m(!1)}}},[o,g,s,y]),y=n.useCallback(()=>{F({url:`${window.location.origin}/teams/auth-start`,width:600,height:535,successCallback:e=>{console.log("Interactive auth success:",e),d()},failureCallback:e=>{console.error("Interactive auth failed:",e),u(s("teams.errors.interactiveAuthFailed"))}})},[d,s]);return!f||o?a.jsx("div",{className:"flex items-center justify-center h-screen bg-[var(--teams-bg,#f5f5f5)]",children:a.jsxs("div",{className:"text-center",children:[a.jsx(N,{}),a.jsx("p",{className:"mt-4 text-[var(--teams-text,#323130)]",children:s(o?"teams.status.authenticating":"teams.status.initializing")})]})}):h?a.jsx("div",{className:"flex items-center justify-center h-screen bg-[var(--teams-bg,#f5f5f5)]",children:a.jsxs("div",{className:"text-center max-w-md p-6",children:[a.jsx("div",{className:"text-red-600 mb-4",children:a.jsx("svg",{className:"w-16 h-16 mx-auto",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})})}),a.jsx("h2",{className:"text-xl font-semibold mb-2 text-[var(--teams-text,#323130)]",children:s("teams.errors.authenticationError")}),a.jsx("p",{className:"text-[var(--teams-text,#323130)] opacity-75 mb-4",children:h}),a.jsx("button",{onClick:d,className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700",children:s("common.retry")})]})}):null}function O({children:s}){const[f,l]=n.useState(!1),[o,m]=n.useState(!1),{isAuthenticated:h}=v();return n.useEffect(()=>{(()=>{const c=new URLSearchParams(window.location.search),g=c.has("loginHint")||c.has("userObjectId")||c.has("theme"),x=window.name==="embedded"||window.location.hostname==="teams.microsoft.com"||c.has("isTeams");(g||x)&&typeof D<"u"?(l(!0),j(()=>{console.log("Teams SDK initialized"),m(!0),R(),W()})):(l(!1),m(!0))})()},[]),f&&o&&!h?a.jsx(B,{}):f?a.jsx("div",{className:"teams-container min-h-screen bg-[var(--teams-bg,#f5f5f5)]",children:s}):s}export{O as default};
