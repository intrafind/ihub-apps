import{n as Ge,o as Ye,e as Ze,u as re,j as e,I as F,F as es,p as Xe,q as ss,g as ce,l as as,i as ts}from"./index-CdJiYb_a.js";import{r as o,u as is,e as ls}from"./vendor-react-9AdXaApd.js";import{D as ns}from"./DualModeEditor-u5gL3giJ.js";import{D as O}from"./DynamicLanguageEditor-DFv1lM-q.js";import{x as ds,m as Qe}from"./adminApi-DCK2UDnY.js";import{i as ne,v as rs,e as os}from"./schemaValidation-BmW9IFx4.js";import{f as cs}from"./schemaService-Ch_9A-Q2.js";import{A as ms}from"./AdminAuth-w86Ms2_j.js";import{A as ps}from"./AdminNavigation-CghX6zwW.js";import"./mermaid-DechTdnA.js";import"./vendor-utils-CF1RCcgi.js";import"./teams-CwMtNG0x.js";import"./vendor-ui-lZiltAcz.js";import"./vendor-forms-DyVXvDXu.js";import"./monaco-CCrBizaJ.js";const us=async(s={})=>{const{skipCache:h=!1,language:f=null}=s,C=h?null:"tools",p={};return f&&(p.language=f),Ge(()=>Ze.get("/tools",{params:p}),C,Ye.SHORT)},xs=({selectedTools:s=[],onToolsChange:h})=>{const{t:f}=re(),[C,p]=o.useState(""),[N,t]=o.useState(!1),[E,T]=o.useState([]),[b,L]=o.useState(!0),k=o.useRef(null),n=o.useRef(null);o.useEffect(()=>{(async()=>{try{L(!0);const w=await us();T(w||[])}catch(w){console.error("Failed to fetch tools:",w),T([])}finally{L(!1)}})()},[]);const c=E.filter(r=>{const U=`${r.name||r.id} ${r.description||""}`.toLowerCase().includes(C.toLowerCase()),z=!s.includes(r.id);return U&&z});o.useEffect(()=>{const r=w=>{k.current&&!k.current.contains(w.target)&&(t(!1),p(""))};return document.addEventListener("mousedown",r),()=>document.removeEventListener("mousedown",r)},[]),o.useEffect(()=>{N&&n.current&&n.current.focus()},[N]);const S=r=>{const w=typeof r=="string"?r:r.id;s.includes(w)||h([...s,w]),p(""),t(!1)},I=r=>{h(s.filter(w=>w!==r))},R=r=>{p(r.target.value),t(!0)},$=r=>{r.key==="Enter"&&c.length>0?S(c[0]):r.key==="Escape"&&(t(!1),p(""))};return e.jsxs("div",{className:"space-y-3",children:[s.length>0&&e.jsx("div",{className:"flex flex-wrap gap-2",children:s.map(r=>{const w=E.find(z=>z.id===r),U=w?w.name:r;return e.jsxs("span",{className:"inline-flex items-center gap-1 px-3 py-1 rounded-full text-sm font-medium bg-indigo-100 text-indigo-800",children:[U,e.jsx("button",{onClick:()=>I(r),className:"ml-1 flex-shrink-0 text-indigo-600 hover:text-indigo-800","aria-label":`Remove ${U}`,children:e.jsx(F,{name:"x",className:"w-3 h-3"})})]},r)})}),e.jsxs("div",{className:"relative",ref:k,children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(F,{name:"search",className:"h-5 w-5 text-gray-400"})}),e.jsx("input",{ref:n,type:"text",placeholder:f("admin.apps.edit.searchTools","Search tools to add..."),value:C,onChange:R,onKeyDown:$,onFocus:()=>t(!0),className:"block w-full pl-10 pr-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500",autoComplete:"off"})]}),N&&e.jsx("div",{className:"absolute z-10 mt-1 w-full bg-white border border-gray-300 rounded-lg shadow-lg max-h-60 overflow-auto",children:b?e.jsx("div",{className:"px-3 py-2 text-sm text-gray-500",children:f("common.loading","Loading...")}):c.length>0?c.map(r=>e.jsxs("button",{onClick:()=>S(r),className:"w-full text-left px-3 py-3 text-sm text-gray-700 hover:bg-gray-100 focus:bg-gray-100 focus:outline-none border-b border-gray-100 last:border-b-0",children:[e.jsx("div",{className:"font-medium text-gray-900",children:r.name}),r.description&&e.jsx("div",{className:"text-xs text-gray-500 mt-1 line-clamp-2",children:r.description})]},r.id)):e.jsx("div",{className:"px-3 py-2 text-sm text-gray-500",children:C?f("admin.apps.wizard.tools.noResults","No tools match your search"):f("admin.apps.wizard.tools.noTools","No tools available")})})]}),e.jsx("p",{className:"text-sm text-gray-500",children:f("admin.apps.edit.toolsHelper","Search and select tools to add to this app. Click on selected tools to remove them.")})]})};function gs({value:s=[],onChange:h,allowMultiple:f=!0,className:C="",disabled:p=!1}){const[N,t]=o.useState([]),[E,T]=o.useState(!0),[b,L]=o.useState(null),[k,n]=o.useState(""),[c,S]=o.useState("all"),[I,R]=o.useState(new Set(s||[]));o.useEffect(()=>{$()},[]),o.useEffect(()=>{R(new Set(s||[]))},[s]);const $=async()=>{try{T(!0),L(null);const j=(await ds.getSources()).filter(P=>P.enabled!==!1);t(j),console.log(`Loaded ${j.length} enabled sources for picker`)}catch(l){console.error("Failed to load sources:",l),L("Failed to load available sources. Please try again.")}finally{T(!1)}},r=l=>{if(p)return;const j=new Set(I);j.has(l)?j.delete(l):(f||j.clear(),j.add(l)),R(j);const P=Array.from(j);h==null||h(P)},w=l=>typeof l.name=="string"?l.name:typeof l.name=="object"&&(l.name.en||l.name.de||Object.values(l.name)[0])||l.id,U=l=>typeof l.description=="string"?l.description:typeof l.description=="object"&&(l.description.en||l.description.de||Object.values(l.description)[0])||"",z=()=>N.filter(l=>{if(c!=="all"&&l.type!==c)return!1;if(k.trim()){const j=k.toLowerCase(),P=w(l).toLowerCase(),v=U(l).toLowerCase(),u=l.id.toLowerCase();return P.includes(j)||v.includes(j)||u.includes(j)}return!0}),J=l=>{switch(l){case"filesystem":return"ðŸ“";case"url":return"ðŸŒ";case"ifinder":return"ðŸ”";default:return"ðŸ“„"}},K=()=>{p||(R(new Set),h==null||h([]))},B=z();return e.jsxs("div",{className:`source-picker ${C}`,children:[e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"relative mb-3",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(es,{className:"h-5 w-5 text-gray-400"})}),e.jsx("input",{type:"text",value:k,onChange:l=>n(l.target.value),placeholder:"Search sources by name, description, or ID...",disabled:p||E,className:"block w-full pl-10 pr-3 py-2 border border-gray-300 rounded-md leading-5 bg-white placeholder-gray-500 focus:outline-none focus:placeholder-gray-400 focus:ring-1 focus:ring-blue-500 focus:border-blue-500 sm:text-sm disabled:bg-gray-50 disabled:text-gray-500"})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("select",{value:c,onChange:l=>S(l.target.value),disabled:p||E,className:"block w-32 px-3 py-1.5 text-sm border border-gray-300 rounded-md bg-white focus:outline-none focus:ring-1 focus:ring-blue-500 focus:border-blue-500 disabled:bg-gray-50 disabled:text-gray-500",children:[e.jsx("option",{value:"all",children:"All Types"}),e.jsx("option",{value:"filesystem",children:"ðŸ“ Files"}),e.jsx("option",{value:"url",children:"ðŸŒ URLs"}),e.jsx("option",{value:"ifinder",children:"ðŸ” iFinder"})]}),e.jsx("span",{className:"text-sm text-gray-500",children:I.size>0&&`${I.size} selected`})]}),I.size>0&&e.jsx("button",{onClick:K,disabled:p,className:"text-sm text-gray-500 hover:text-gray-700 disabled:text-gray-400",children:"Clear all"})]})]}),E&&e.jsxs("div",{className:"flex items-center justify-center py-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-blue-500"}),e.jsx("span",{className:"ml-2 text-sm text-gray-500",children:"Loading sources..."})]}),b&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-md p-4 mb-4",children:e.jsxs("div",{className:"flex",children:[e.jsx(Xe,{className:"h-5 w-5 text-red-400"}),e.jsxs("div",{className:"ml-3",children:[e.jsx("h3",{className:"text-sm font-medium text-red-800",children:"Error Loading Sources"}),e.jsx("p",{className:"mt-1 text-sm text-red-700",children:b}),e.jsx("button",{onClick:$,className:"mt-2 text-sm text-red-600 hover:text-red-500 underline",children:"Try again"})]})]})}),!E&&!b&&e.jsx("div",{className:"border border-gray-200 rounded-md max-h-64 overflow-y-auto",children:B.length===0?e.jsx("div",{className:"p-4 text-center text-gray-500",children:k||c!=="all"?e.jsxs("div",{children:[e.jsx("p",{children:"No sources match your filters."}),e.jsx("button",{onClick:()=>{n(""),S("all")},className:"mt-1 text-sm text-blue-600 hover:text-blue-500",children:"Clear filters"})]}):e.jsxs("div",{children:[e.jsx("p",{children:"No sources available."}),e.jsx("p",{className:"text-sm mt-1",children:"Create sources in the admin interface first."})]})}):e.jsx("div",{className:"divide-y divide-gray-200",children:B.map(l=>{var u,x;const j=I.has(l.id),P=w(l),v=U(l);return e.jsxs("div",{onClick:()=>r(l.id),className:`flex items-center p-3 cursor-pointer transition-colors ${j?"bg-blue-50 hover:bg-blue-100":"hover:bg-gray-50"} ${p?"cursor-not-allowed opacity-50":""}`,children:[e.jsx("div",{className:`w-5 h-5 rounded border-2 flex items-center justify-center mr-3 ${j?"bg-blue-600 border-blue-600":"border-gray-300"}`,children:j&&e.jsx(ss,{className:"w-3 h-3 text-white"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"text-lg mr-2",children:J(l.type)}),e.jsx("h4",{className:"text-sm font-medium text-gray-900 truncate",children:P}),e.jsx("span",{className:"ml-2 px-2 py-0.5 text-xs bg-gray-100 text-gray-600 rounded",children:l.id})]}),v&&e.jsx("p",{className:"mt-1 text-sm text-gray-500 truncate",children:v}),e.jsxs("div",{className:"mt-1 flex items-center space-x-2 text-xs text-gray-400",children:[e.jsxs("span",{children:["Type: ",l.type]}),((u=l.config)==null?void 0:u.path)&&e.jsxs("span",{children:["â€¢ Path: ",l.config.path]}),((x=l.config)==null?void 0:x.url)&&e.jsxs("span",{children:["â€¢ URL: ",new URL(l.config.url).hostname]})]})]})]},l.id)})})}),I.size>0&&e.jsxs("div",{className:"mt-3 p-3 bg-gray-50 rounded-md",children:[e.jsxs("h4",{className:"text-sm font-medium text-gray-700 mb-2",children:["Selected Sources (",I.size,")"]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:Array.from(I).map(l=>{const j=N.find(P=>P.id===l);return j?e.jsxs("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800",children:[J(j.type)," ",w(j),e.jsx("button",{onClick:P=>{P.stopPropagation(),r(l)},disabled:p,className:"ml-1.5 inline-flex items-center justify-center w-4 h-4 rounded-full text-blue-400 hover:bg-blue-200 hover:text-blue-600 focus:outline-none disabled:cursor-not-allowed",children:e.jsx(Xe,{className:"w-3 h-3"})})]},l):null})})]})]})}const de=["academic-cap","arrow-right","briefcase","calendar","camera","chat","chat-bubbles","check","check-circle","chevron-down","clock","close","code","cog","color-swatch","copy","cpu-chip","document-search","document-text","download","edit","exclamation-circle","exclamation-triangle","external-link","eye","eye-slash","face-frown","format","globe","information-circle","light-bulb","link","list","login","logout","mail","menu","microphone","minus-circle","paint-brush","paper-clip","pencil","play","plus","plus-circle","question-mark-circle","redo","refresh","save","search","settings","share","sliders","sparkles","star","thumbs-down","thumbs-up","trash","undo","user","users","warning"].sort(),hs=({value:s,onChange:h,className:f="",error:C})=>{const{t:p}=re(),[N,t]=o.useState(!1),[E,T]=o.useState(""),b=o.useRef(null),L=o.useRef(null),k=de.filter(c=>c.toLowerCase().includes(E.toLowerCase()));o.useEffect(()=>{const c=S=>{b.current&&!b.current.contains(S.target)&&t(!1)};return N&&(document.addEventListener("mousedown",c),setTimeout(()=>{var S;(S=L.current)==null||S.focus()},100)),()=>{document.removeEventListener("mousedown",c)}},[N]);const n=c=>{h(c),t(!1),T("")};return e.jsxs("div",{className:`relative ${f}`,ref:b,children:[e.jsxs("button",{type:"button",onClick:()=>t(!N),className:`w-full flex items-center justify-between px-3 py-2 border rounded-md shadow-sm text-sm bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-indigo-500 ${C?"border-red-300":"border-gray-300"}`,children:[e.jsx("div",{className:"flex items-center space-x-2",children:s?e.jsxs(e.Fragment,{children:[e.jsx(F,{name:s,size:"md",className:"text-gray-700"}),e.jsx("span",{className:"text-gray-900",children:s})]}):e.jsx("span",{className:"text-gray-400",children:p("admin.apps.edit.selectIcon","Select an icon")})}),e.jsx(F,{name:"chevron-down",size:"sm",className:"text-gray-400"})]}),C&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:C}),N&&e.jsxs("div",{className:"absolute z-50 mt-1 w-full bg-white border border-gray-300 rounded-md shadow-lg max-h-96 overflow-hidden",children:[e.jsx("div",{className:"p-2 border-b border-gray-200",children:e.jsxs("div",{className:"relative",children:[e.jsx(F,{name:"search",size:"sm",className:"absolute left-2 top-1/2 transform -translate-y-1/2 text-gray-400"}),e.jsx("input",{ref:L,type:"text",value:E,onChange:c=>T(c.target.value),placeholder:p("admin.apps.edit.searchIcons","Search icons..."),className:"w-full pl-8 pr-3 py-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500"})]})}),e.jsx("div",{className:"p-2 overflow-y-auto max-h-80",children:k.length>0?e.jsx("div",{className:"grid grid-cols-6 gap-1",children:k.map(c=>e.jsxs("button",{type:"button",onClick:()=>n(c),className:`flex flex-col items-center justify-center p-3 rounded-md hover:bg-indigo-50 transition-colors ${s===c?"bg-indigo-100 ring-2 ring-indigo-500":"bg-gray-50"}`,title:c,children:[e.jsx(F,{name:c,size:"lg",className:"text-gray-700"}),e.jsx("span",{className:"mt-1 text-xs text-gray-600 truncate w-full text-center",children:c.split("-")[0]})]},c))}):e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(F,{name:"search",size:"xl",className:"mx-auto mb-2 text-gray-400"}),e.jsx("p",{className:"text-sm",children:p("admin.apps.edit.noIconsFound","No icons found")})]})}),e.jsx("div",{className:"p-2 border-t border-gray-200 bg-gray-50",children:e.jsx("p",{className:"text-xs text-gray-600 text-center",children:k.length===de.length?p("admin.apps.edit.iconCount","{{count}} icons available",{count:de.length}):p("admin.apps.edit.iconCountFiltered","{{filtered}} of {{total}} icons",{filtered:k.length,total:de.length})})})]})]})},fs=({value:s,onChange:h,onValidationChange:f,availableModels:C=[],uiConfig:p=null,jsonSchema:N})=>{var B,l,j,P,v,u,x,g,W,H,X,Q,G,Y,Z,ee,se,ae,te,ie,M,le,me,pe,ue,xe,ge,he,fe,be,je,ye,ve,Ne,we,ke,Ce,Se,Me,Ae,Fe,Ee,Pe,Te,Ie,Ue,Le,Re,Ve,De,Oe,ze,qe,$e,He,Be,Je,We,_e,Ke;const{t,i18n:E}=re(),T=E.language,[b,L]=o.useState({}),k=a=>{let i={};if(N){const y=rs(a,N);y.isValid||(i=os(y.errors))}else a.id?/^[a-zA-Z0-9_-]+$/.test(a.id)||(i.id=t("admin.apps.edit.validation.idInvalid","App ID can only contain letters, numbers, hyphens, and underscores")):i.id=t("admin.apps.edit.validation.idRequired","App ID is required"),(!a.name||!Object.keys(a.name).length)&&(i.name=t("admin.apps.edit.validation.nameRequired","App name is required"));(!a.description||!Object.keys(a.description).length)&&(i.description=t("admin.apps.edit.validation.descriptionRequired","App description is required")),(a.type||"chat")==="chat"&&(!a.system||!Object.keys(a.system).length)&&(i.system=t("admin.apps.edit.validation.systemRequired","System instructions are required")),a.color?/^#[0-9A-Fa-f]{6}$/.test(a.color)||(i.color=t("admin.apps.edit.validation.colorInvalid","Color must be a valid hex code")):i.color=t("admin.apps.edit.validation.colorRequired","Color is required"),a.icon||(i.icon=t("admin.apps.edit.validation.iconRequired","Icon is required")),L(i);const m=Object.keys(i).length===0;return f&&f({isValid:m,errors:Object.entries(i).map(([y,A])=>({field:y,message:A,severity:"error"}))}),m};o.useEffect(()=>{s&&k(s)},[s,N]);const n=(a,i)=>{const d={...s,[a]:i};h(d)},c=(a,i)=>{const d={...s,[a]:i};h(d)},S=(a,i,d)=>{const m={...s,variables:s.variables.map((y,A)=>A===a?{...y,[i]:d}:y)};h(m)},I=(a,i,d,m)=>{const y={...s,variables:s.variables.map((A,V)=>V===a?{...A,predefinedValues:A.predefinedValues.map((D,q)=>q===i?{...D,[d]:m}:D)}:A)};h(y)},R=a=>{const i={...s,variables:s.variables.map((d,m)=>m===a?{...d,predefinedValues:[...d.predefinedValues||[],{label:{en:""},value:""}]}:d)};h(i)},$=(a,i)=>{const d={...s,variables:s.variables.map((m,y)=>y===a?{...m,predefinedValues:m.predefinedValues.filter((A,V)=>V!==i)}:m)};h(d)},r=()=>{const a={...s,variables:[...s.variables||[],{name:"",label:{en:""},type:"string",required:!1}]};h(a)},w=a=>{const i={...s,variables:s.variables.filter((d,m)=>m!==a)};h(i)},U=(a,i,d)=>{const m={...s,starterPrompts:s.starterPrompts.map((y,A)=>A===a?{...y,[i]:d}:y)};h(m)},z=()=>{const a={...s,starterPrompts:[...s.starterPrompts||[],{title:{en:""},message:{en:""},variables:{},autoSend:!1}]};h(a)},J=a=>{const i={...s,starterPrompts:s.starterPrompts.filter((d,m)=>m!==a)};h(i)},K=a=>{const i={...s,sources:a};h(i)};return s?e.jsxs("div",{className:"app-form-editor space-y-6",children:[e.jsx("div",{className:"bg-white shadow px-4 py-5 sm:rounded-lg sm:p-6",children:e.jsxs("div",{className:"md:grid md:grid-cols-3 md:gap-6",children:[e.jsxs("div",{className:"md:col-span-1",children:[e.jsx("h3",{className:"text-lg font-medium leading-6 text-gray-900",children:t("admin.apps.edit.basicInfo","Basic Information")}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:t("admin.apps.edit.basicInfoDesc","Basic app configuration and metadata")})]}),e.jsx("div",{className:"mt-5 md:col-span-2 md:mt-0",children:e.jsxs("div",{className:"grid grid-cols-6 gap-6",children:[e.jsxs("div",{className:"col-span-6 sm:col-span-3",children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700",children:[t("admin.apps.edit.appId","App ID"),ne("id",N)&&e.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),e.jsx("input",{type:"text",required:ne("id",N),value:s.id||"",onChange:a=>n("id",a.target.value),className:`mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm ${b.id?"border-red-300":""}`}),b.id&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:b.id})]}),e.jsxs("div",{className:"col-span-6 sm:col-span-3",children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700",children:[t("admin.apps.edit.appType","App Type"),e.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),e.jsxs("select",{value:s.type||"chat",onChange:a=>n("type",a.target.value),className:"mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm",children:[e.jsx("option",{value:"chat",children:t("admin.apps.edit.typeChat","Chat")}),e.jsx("option",{value:"iframe",children:t("admin.apps.edit.typeIframe","Iframe")}),e.jsx("option",{value:"redirect",children:t("admin.apps.edit.typeRedirect","Redirect")})]}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:t("admin.apps.edit.appTypeHint","Chat apps use AI models, Iframe apps embed external content, Redirect apps open external links")})]}),e.jsxs("div",{className:"col-span-6 sm:col-span-3",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:t("admin.apps.edit.order","Order")}),e.jsx("input",{type:"number",value:s.order||0,onChange:a=>n("order",parseInt(a.target.value)||0),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm"})]}),e.jsxs("div",{className:"col-span-6 sm:col-span-3",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:t("admin.apps.edit.category","Category")}),e.jsxs("select",{value:s.category||"",onChange:a=>n("category",a.target.value),className:"mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm",children:[e.jsx("option",{value:"",children:t("admin.apps.edit.selectCategory","Select category...")}),(j=(l=(B=p==null?void 0:p.appsList)==null?void 0:B.categories)==null?void 0:l.list)==null?void 0:j.filter(a=>a.id!=="all").map(a=>e.jsx("option",{value:a.id,children:ce(a.name,T)},a.id))]})]}),e.jsx("div",{className:"col-span-6",children:e.jsx(O,{label:e.jsxs("span",{children:[t("admin.apps.edit.name","Name"),e.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),value:s.name||{},onChange:a=>c("name",a),required:!0,placeholder:{en:"Enter app name in English",de:"App-Name auf Deutsch eingeben"},error:b.name})}),e.jsx("div",{className:"col-span-6",children:e.jsx(O,{label:e.jsxs("span",{children:[t("admin.apps.edit.description","Description"),e.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),value:s.description||{},onChange:a=>c("description",a),required:!0,type:"textarea",placeholder:{en:"Enter app description in English",de:"App-Beschreibung auf Deutsch eingeben"},error:b.description})}),e.jsxs("div",{className:"col-span-6 sm:col-span-3",children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700",children:[t("admin.apps.edit.color","Color"),e.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),e.jsx("input",{type:"color",value:s.color||"#4F46E5",onChange:a=>n("color",a.target.value),className:`mt-1 block w-full h-10 rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm ${b.color?"border-red-300":""}`}),b.color&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:b.color})]}),e.jsxs("div",{className:"col-span-6 sm:col-span-3",children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700",children:[t("admin.apps.edit.icon","Icon"),e.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),e.jsx(hs,{value:s.icon||"",onChange:a=>n("icon",a),error:b.icon,className:"mt-1"})]}),e.jsxs("div",{className:"col-span-6 sm:col-span-3",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:t("admin.apps.edit.preferredModel","Preferred Model")}),e.jsxs("select",{value:s.preferredModel||"",onChange:a=>n("preferredModel",a.target.value),className:"mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm",children:[e.jsx("option",{value:"",children:t("admin.apps.edit.selectModel","Select model...")}),C.map(a=>e.jsx("option",{value:a.id,children:ce(a.name,T)},a.id))]})]}),e.jsxs("div",{className:"col-span-6 sm:col-span-3",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:t("admin.apps.edit.temperature","Temperature")}),e.jsx("input",{type:"number",min:"0",max:"2",step:"0.1",value:s.preferredTemperature||.7,onChange:a=>n("preferredTemperature",parseFloat(a.target.value)),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm"})]}),e.jsxs("div",{className:"col-span-6 sm:col-span-3",children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700",children:[t("admin.apps.edit.tokenLimit","Token Limit"),ne("tokenLimit",N)&&e.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),e.jsx("input",{type:"number",min:"1",value:s.tokenLimit||4096,onChange:a=>n("tokenLimit",parseInt(a.target.value)),className:`mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm ${b.tokenLimit?"border-red-300":""}`,required:ne("tokenLimit",N)}),b.tokenLimit&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:b.tokenLimit})]}),e.jsxs("div",{className:"col-span-6 sm:col-span-3",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:t("admin.apps.edit.outputFormat","Output Format")}),e.jsxs("select",{value:s.preferredOutputFormat||"markdown",onChange:a=>n("preferredOutputFormat",a.target.value),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm",children:[e.jsx("option",{value:"markdown",children:t("appConfig.markdown","Markdown")}),e.jsx("option",{value:"text",children:t("appConfig.plainText","Plain Text")}),e.jsx("option",{value:"json",children:t("appConfig.json","JSON")})]})]}),e.jsx("div",{className:"col-span-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:s.enabled!==!1,onChange:a=>n("enabled",a.target.checked),className:"h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded"}),e.jsx("label",{className:"ml-2 block text-sm text-gray-900",children:t("admin.apps.edit.enabled","Enabled")})]})})]})})]})}),(s.type==="chat"||!s.type)&&e.jsx(e.Fragment,{children:e.jsx("div",{className:"bg-white shadow px-4 py-5 sm:rounded-lg sm:p-6",children:e.jsxs("div",{className:"md:grid md:grid-cols-3 md:gap-6",children:[e.jsxs("div",{className:"md:col-span-1",children:[e.jsx("h3",{className:"text-lg font-medium leading-6 text-gray-900",children:t("admin.apps.edit.systemInstructions","System Instructions")}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:t("admin.apps.edit.systemInstructionsDesc","System prompts that define the app behavior")})]}),e.jsxs("div",{className:"mt-5 md:col-span-2 md:mt-0",children:[e.jsx(O,{label:e.jsxs("span",{children:[t("admin.apps.edit.systemInstructions","System Instructions"),e.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),value:s.system||{},onChange:a=>c("system",a),type:"textarea",placeholder:{en:"Enter system instructions in English",de:"Systeminstruktionen auf Deutsch eingeben"},className:"mb-6",error:b.system}),e.jsx(O,{label:t("admin.apps.edit.messagePlaceholder","Message Placeholder"),value:s.messagePlaceholder||{},onChange:a=>c("messagePlaceholder",a),placeholder:{en:"Enter message placeholder in English",de:"Nachrichtenplatzhalter auf Deutsch eingeben"},className:"mb-6"}),e.jsx(O,{label:t("admin.apps.edit.prompt","Prompt Template"),value:s.prompt||{},onChange:a=>c("prompt",a),type:"textarea",placeholder:{en:"Enter prompt template in English",de:"Prompt-Vorlage auf Deutsch eingeben"}})]})]})})}),s.type==="iframe"&&e.jsx("div",{className:"bg-white shadow px-4 py-5 sm:rounded-lg sm:p-6",children:e.jsxs("div",{className:"md:grid md:grid-cols-3 md:gap-6",children:[e.jsxs("div",{className:"md:col-span-1",children:[e.jsx("h3",{className:"text-lg font-medium leading-6 text-gray-900",children:t("admin.apps.edit.iframeConfig","Iframe Configuration")}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:t("admin.apps.edit.iframeConfigDesc","Configure the embedded iframe content")})]}),e.jsx("div",{className:"mt-5 md:col-span-2 md:mt-0",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700",children:[t("admin.apps.edit.iframeUrl","Iframe URL"),e.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),e.jsx("input",{type:"url",value:((P=s.iframeConfig)==null?void 0:P.url)||"",onChange:a=>n("iframeConfig",{...s.iframeConfig,url:a.target.value}),placeholder:"https://example.com",className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm"})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:((v=s.iframeConfig)==null?void 0:v.allowFullscreen)!==!1,onChange:a=>n("iframeConfig",{...s.iframeConfig,allowFullscreen:a.target.checked}),className:"h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded"}),e.jsx("label",{className:"ml-2 block text-sm text-gray-900",children:t("admin.apps.edit.allowFullscreen","Allow Fullscreen")})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:t("admin.apps.edit.sandboxPermissions","Sandbox Permissions")}),e.jsx("p",{className:"text-xs text-gray-500 mb-3",children:t("admin.apps.edit.sandboxPermissionsDesc","Control what the embedded content is allowed to do. Uncheck options to restrict permissions for better security.")}),e.jsx("div",{className:"space-y-2 pl-4",children:[{value:"allow-scripts",label:t("admin.apps.edit.allowScripts","Allow Scripts (required for most interactive content)")},{value:"allow-same-origin",label:t("admin.apps.edit.allowSameOrigin","Allow Same Origin (enables localStorage, cookies)")},{value:"allow-forms",label:t("admin.apps.edit.allowForms","Allow Forms (enable form submission)")},{value:"allow-popups",label:t("admin.apps.edit.allowPopups","Allow Popups")},{value:"allow-modals",label:t("admin.apps.edit.allowModals","Allow Modals (alert, confirm, etc.)")},{value:"allow-top-navigation",label:t("admin.apps.edit.allowTopNavigation","Allow Top Navigation (navigate parent window)")}].map(a=>{var m;const d=(((m=s.iframeConfig)==null?void 0:m.sandbox)||(s.iframeConfig?[]:["allow-scripts","allow-same-origin","allow-forms"])).includes(a.value);return e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:d,onChange:y=>{var D;const A=((D=s.iframeConfig)==null?void 0:D.sandbox)||["allow-scripts","allow-same-origin","allow-forms"],V=y.target.checked?[...A,a.value]:A.filter(q=>q!==a.value);n("iframeConfig",{...s.iframeConfig,sandbox:V})},className:"h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded"}),e.jsx("label",{className:"ml-2 block text-sm text-gray-700",children:a.label})]},a.value)})})]})]})})]})}),s.type==="redirect"&&e.jsx("div",{className:"bg-white shadow px-4 py-5 sm:rounded-lg sm:p-6",children:e.jsxs("div",{className:"md:grid md:grid-cols-3 md:gap-6",children:[e.jsxs("div",{className:"md:col-span-1",children:[e.jsx("h3",{className:"text-lg font-medium leading-6 text-gray-900",children:t("admin.apps.edit.redirectConfig","Redirect Configuration")}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:t("admin.apps.edit.redirectConfigDesc","Configure the redirect behavior")})]}),e.jsx("div",{className:"mt-5 md:col-span-2 md:mt-0",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700",children:[t("admin.apps.edit.redirectUrl","Redirect URL"),e.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),e.jsx("input",{type:"url",value:((u=s.redirectConfig)==null?void 0:u.url)||"",onChange:a=>n("redirectConfig",{...s.redirectConfig,url:a.target.value}),placeholder:"https://example.com",className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm"})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:((x=s.redirectConfig)==null?void 0:x.openInNewTab)!==!1,onChange:a=>n("redirectConfig",{...s.redirectConfig,openInNewTab:a.target.checked}),className:"h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded"}),e.jsx("label",{className:"ml-2 block text-sm text-gray-900",children:t("admin.apps.edit.openInNewTab","Open in New Tab")})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:((g=s.redirectConfig)==null?void 0:g.showWarning)!==!1,onChange:a=>n("redirectConfig",{...s.redirectConfig,showWarning:a.target.checked}),className:"h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded"}),e.jsx("label",{className:"ml-2 block text-sm text-gray-900",children:t("admin.apps.edit.showWarning","Show Warning Before Redirect")})]})]})})]})}),(s.type==="chat"||!s.type)&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"bg-white shadow px-4 py-5 sm:rounded-lg sm:p-6",children:e.jsxs("div",{className:"md:grid md:grid-cols-3 md:gap-6",children:[e.jsxs("div",{className:"md:col-span-1",children:[e.jsx("h3",{className:"text-lg font-medium leading-6 text-gray-900",children:t("admin.apps.edit.tools","Tools")}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:t("admin.apps.edit.toolsDesc","Configure which tools are available for this app")})]}),e.jsx("div",{className:"mt-5 md:mt-0 md:col-span-2",children:e.jsx(xs,{selectedTools:s.tools||[],onToolsChange:a=>n("tools",a)})})]})}),e.jsx("div",{className:"bg-white shadow px-4 py-5 sm:rounded-lg sm:p-6",children:e.jsxs("div",{className:"md:grid md:grid-cols-3 md:gap-6",children:[e.jsxs("div",{className:"md:col-span-1",children:[e.jsx("h3",{className:"text-lg font-medium leading-6 text-gray-900",children:t("admin.apps.edit.variables","Variables")}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:t("admin.apps.edit.variablesDesc","Configure input variables for dynamic prompts")})]}),e.jsx("div",{className:"mt-5 md:col-span-2 md:mt-0",children:e.jsxs("div",{className:"space-y-4",children:[(s.variables||[]).map((a,i)=>e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsxs("h4",{className:"text-sm font-medium text-gray-900",children:[t("admin.apps.edit.variable","Variable")," ",i+1]}),e.jsx("button",{type:"button",onClick:()=>w(i),className:"text-red-600 hover:text-red-800",children:e.jsx(F,{name:"trash",className:"h-4 w-4"})})]}),e.jsxs("div",{className:"grid grid-cols-6 gap-4",children:[e.jsxs("div",{className:"col-span-6 sm:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:t("admin.apps.edit.variableName","Name")}),e.jsx("input",{type:"text",value:a.name||"",onChange:d=>S(i,"name",d.target.value),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm"})]}),e.jsxs("div",{className:"col-span-6 sm:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:t("admin.apps.edit.variableType","Type")}),e.jsxs("select",{value:a.type||"string",onChange:d=>S(i,"type",d.target.value),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm",children:[e.jsx("option",{value:"string",children:t("admin.apps.edit.typeString","String")}),e.jsx("option",{value:"text",children:t("admin.apps.edit.typeText","Text")}),e.jsx("option",{value:"select",children:t("admin.apps.edit.typeSelect","Select")}),e.jsx("option",{value:"date",children:t("admin.apps.edit.typeDate","Date")}),e.jsx("option",{value:"number",children:t("admin.apps.edit.typeNumber","Number")})]})]}),e.jsx("div",{className:"col-span-6 sm:col-span-2 flex items-end",children:e.jsxs("div",{className:"flex items-center h-5",children:[e.jsx("input",{type:"checkbox",checked:a.required||!1,onChange:d=>S(i,"required",d.target.checked),className:"h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded"}),e.jsx("label",{className:"ml-2 block text-sm text-gray-900",children:t("admin.apps.edit.required","Required")})]})}),e.jsx("div",{className:"col-span-6",children:e.jsx(O,{label:t("admin.apps.edit.variableLabel","Label"),value:a.label||{},onChange:d=>S(i,"label",d),placeholder:{en:"Enter variable label in English",de:"Variablenbeschriftung auf Deutsch eingeben"}})}),e.jsx("div",{className:"col-span-6",children:e.jsx(O,{label:t("admin.apps.edit.defaultValue","Default Value"),value:a.defaultValue||{},onChange:d=>S(i,"defaultValue",d),placeholder:{en:"Enter default value in English",de:"Standardwert auf Deutsch eingeben"}})}),e.jsxs("div",{className:"col-span-6",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:t("admin.apps.edit.predefinedValues","Predefined Values")}),e.jsx("p",{className:"text-xs text-gray-500 mb-2",children:a.type==="select"?t("admin.apps.edit.predefinedValuesHintSelect","Options that will be available in the dropdown menu."):t("admin.apps.edit.predefinedValuesHint","Optional suggested values that can be used as autocomplete options.")}),e.jsxs("div",{className:"space-y-2",children:[(a.predefinedValues||[]).map((d,m)=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"flex-1",children:e.jsx(O,{label:`${t("admin.apps.edit.option","Option")} ${m+1}`,value:d.label||{},onChange:y=>I(i,m,"label",y),placeholder:{en:"Option label",de:"Options-Beschriftung"}})}),e.jsx("div",{className:"w-32",children:e.jsx("input",{type:"text",value:d.value||"",onChange:y=>I(i,m,"value",y.target.value),placeholder:t("admin.apps.edit.value","Value"),className:"block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm"})}),e.jsx("button",{type:"button",onClick:()=>$(i,m),className:"text-red-600 hover:text-red-800",children:e.jsx(F,{name:"trash",className:"h-4 w-4"})})]},m)),e.jsxs("button",{type:"button",onClick:()=>R(i),className:"inline-flex items-center px-3 py-2 border border-gray-300 shadow-sm text-sm leading-4 font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500",children:[e.jsx(F,{name:"plus",className:"h-4 w-4 mr-2"}),t("admin.apps.edit.addOption","Add Option")]})]})]})]})]},i)),e.jsxs("button",{type:"button",onClick:r,className:"inline-flex items-center px-4 py-2 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500",children:[e.jsx(F,{name:"plus",className:"h-4 w-4 mr-2"}),t("admin.apps.edit.addVariable","Add Variable")]})]})})]})}),e.jsx("div",{className:"bg-white shadow px-4 py-5 sm:rounded-lg sm:p-6",children:e.jsxs("div",{className:"md:grid md:grid-cols-3 md:gap-6",children:[e.jsxs("div",{className:"md:col-span-1",children:[e.jsx("h3",{className:"text-lg font-medium leading-6 text-gray-900",children:t("admin.apps.edit.starterPrompts","Starter Prompts")}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:t("admin.apps.edit.starterPromptsDesc","Pre-defined prompts to help users get started")})]}),e.jsx("div",{className:"mt-5 md:col-span-2 md:mt-0",children:e.jsxs("div",{className:"space-y-4",children:[(s.starterPrompts||[]).map((a,i)=>e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsxs("h4",{className:"text-sm font-medium text-gray-900",children:[t("admin.apps.edit.starterPrompt","Starter Prompt")," ",i+1]}),e.jsx("button",{type:"button",onClick:()=>J(i),className:"text-red-600 hover:text-red-800",children:e.jsx(F,{name:"trash",className:"h-4 w-4"})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(O,{label:t("admin.apps.edit.title","Title"),value:a.title||{},onChange:d=>U(i,"title",d),placeholder:{en:"Enter prompt title in English",de:"Prompt-Titel auf Deutsch eingeben"}}),e.jsx(O,{label:t("admin.apps.edit.message","Message"),value:a.message||{},onChange:d=>U(i,"message",d),type:"textarea",placeholder:{en:"Enter prompt message in English",de:"Prompt-Nachricht auf Deutsch eingeben"}}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:a.autoSend||!1,onChange:d=>U(i,"autoSend",d.target.checked),className:"h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded"}),e.jsx("label",{className:"ml-2 block text-sm text-gray-900",children:t("admin.apps.edit.autoSendPrompt","Send immediately when clicked")})]})]})]},i)),e.jsxs("button",{type:"button",onClick:z,className:"inline-flex items-center px-4 py-2 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500",children:[e.jsx(F,{name:"plus",className:"h-4 w-4 mr-2"}),t("admin.apps.edit.addStarterPrompt","Add Starter Prompt")]})]})})]})}),e.jsx("div",{className:"bg-white shadow px-4 py-5 sm:rounded-lg sm:p-6",children:e.jsxs("div",{className:"md:grid md:grid-cols-3 md:gap-6",children:[e.jsxs("div",{className:"md:col-span-1",children:[e.jsx("h3",{className:"text-lg font-medium leading-6 text-gray-900",children:t("admin.apps.edit.upload","Upload Configuration")}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:t("admin.apps.edit.uploadDesc","Configure file and image upload capabilities")})]}),e.jsx("div",{className:"mt-5 md:col-span-2 md:mt-0",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:((W=s.upload)==null?void 0:W.enabled)||!1,onChange:a=>n("upload",{...s.upload,enabled:a.target.checked}),className:"h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded"}),e.jsx("label",{className:"ml-2 block text-sm text-gray-900",children:t("admin.apps.edit.enableUpload","Enable Upload")})]}),((H=s.upload)==null?void 0:H.enabled)&&e.jsxs("div",{className:"space-y-4 pl-6",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:((X=s.upload)==null?void 0:X.allowMultiple)||!1,onChange:a=>n("upload",{...s.upload,allowMultiple:a.target.checked}),className:"h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded"}),e.jsx("label",{className:"ml-2 block text-sm text-gray-900",children:t("admin.apps.edit.allowMultiple","Allow Multiple Files")})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center mb-2",children:[e.jsx("input",{type:"checkbox",checked:((G=(Q=s.upload)==null?void 0:Q.imageUpload)==null?void 0:G.enabled)||!1,onChange:a=>n("upload",{...s.upload,imageUpload:{...s.upload.imageUpload,enabled:a.target.checked}}),className:"h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded"}),e.jsx("label",{className:"ml-2 block text-sm font-medium text-gray-900",children:t("admin.apps.edit.enableImageUpload","Enable Image Upload")})]}),((Z=(Y=s.upload)==null?void 0:Y.imageUpload)==null?void 0:Z.enabled)&&e.jsxs("div",{className:"ml-6 space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700",children:t("admin.apps.edit.maxImageSize","Max Image Size (MB)")}),e.jsx("input",{type:"number",min:"1",max:"50",value:((se=(ee=s.upload)==null?void 0:ee.imageUpload)==null?void 0:se.maxFileSizeMB)||10,onChange:a=>n("upload",{...s.upload,imageUpload:{...s.upload.imageUpload,maxFileSizeMB:parseInt(a.target.value)}}),className:"mt-1 block w-20 rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 text-xs"})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:((te=(ae=s.upload)==null?void 0:ae.imageUpload)==null?void 0:te.resizeImages)!==!1,onChange:a=>n("upload",{...s.upload,imageUpload:{...s.upload.imageUpload,resizeImages:a.target.checked}}),className:"h-3 w-3 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded"}),e.jsx("label",{className:"ml-2 block text-xs text-gray-700",children:t("admin.apps.edit.resizeImages","Resize Images")})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700",children:t("admin.apps.edit.supportedImageFormats","Supported Image Formats")}),e.jsx("div",{className:"mt-1 space-y-1",children:["image/jpeg","image/jpg","image/png","image/gif","image/webp"].map(a=>{var i,d,m;return e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:((m=(d=(i=s.upload)==null?void 0:i.imageUpload)==null?void 0:d.supportedFormats)==null?void 0:m.includes(a))!==!1,onChange:y=>{var D,q;const A=((q=(D=s.upload)==null?void 0:D.imageUpload)==null?void 0:q.supportedFormats)||["image/jpeg","image/jpg","image/png","image/gif","image/webp"],V=y.target.checked?[...A.filter(_=>_!==a),a]:A.filter(_=>_!==a);n("upload",{...s.upload,imageUpload:{...s.upload.imageUpload,supportedFormats:V}})},className:"h-3 w-3 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded"}),e.jsx("label",{className:"ml-2 block text-xs text-gray-700",children:a.replace("image/","").toUpperCase()})]},a)})})]})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center mb-2",children:[e.jsx("input",{type:"checkbox",checked:((M=(ie=s.upload)==null?void 0:ie.fileUpload)==null?void 0:M.enabled)||!1,onChange:a=>n("upload",{...s.upload,fileUpload:{...s.upload.fileUpload,enabled:a.target.checked}}),className:"h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded"}),e.jsx("label",{className:"ml-2 block text-sm font-medium text-gray-900",children:t("admin.apps.edit.enableFileUpload","Enable File Upload")})]}),((me=(le=s.upload)==null?void 0:le.fileUpload)==null?void 0:me.enabled)&&e.jsxs("div",{className:"ml-6 space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700",children:t("admin.apps.edit.maxFileSize","Max File Size (MB)")}),e.jsx("input",{type:"number",min:"1",max:"100",value:((ue=(pe=s.upload)==null?void 0:pe.fileUpload)==null?void 0:ue.maxFileSizeMB)||5,onChange:a=>n("upload",{...s.upload,fileUpload:{...s.upload.fileUpload,maxFileSizeMB:parseInt(a.target.value)}}),className:"mt-1 block w-20 rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 text-xs"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700",children:t("admin.apps.edit.supportedFormats","Supported File Formats")}),e.jsx("div",{className:"mt-1 space-y-1",children:[{mime:"text/plain",label:"TXT"},{mime:"text/markdown",label:"MD"},{mime:"text/csv",label:"CSV"},{mime:"application/json",label:"JSON"},{mime:"text/html",label:"HTML"},{mime:"text/css",label:"CSS"},{mime:"text/javascript",label:"JS"},{mime:"application/javascript",label:"JS"},{mime:"text/xml",label:"XML"},{mime:"message/rfc822",label:"EML"},{mime:"application/pdf",label:"PDF"},{mime:"application/vnd.openxmlformats-officedocument.wordprocessingml.document",label:"DOCX"},{mime:"application/vnd.ms-outlook",label:"MSG"},{mime:"application/vnd.oasis.opendocument.text",label:"ODT"},{mime:"application/vnd.oasis.opendocument.spreadsheet",label:"ODS"},{mime:"application/vnd.oasis.opendocument.presentation",label:"ODP"}].map(({mime:a,label:i})=>{var d,m,y;return e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:((y=(m=(d=s.upload)==null?void 0:d.fileUpload)==null?void 0:m.supportedFormats)==null?void 0:y.includes(a))!==!1,onChange:A=>{var q,_;const V=((_=(q=s.upload)==null?void 0:q.fileUpload)==null?void 0:_.supportedFormats)||["text/plain","text/markdown","text/csv","application/json","text/html","text/css","text/javascript","application/javascript","text/xml","message/rfc822","application/pdf","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/vnd.ms-outlook","application/vnd.oasis.opendocument.text","application/vnd.oasis.opendocument.spreadsheet","application/vnd.oasis.opendocument.presentation"],D=A.target.checked?[...V.filter(oe=>oe!==a),a]:V.filter(oe=>oe!==a);n("upload",{...s.upload,fileUpload:{...s.upload.fileUpload,supportedFormats:D}})},className:"h-3 w-3 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded"}),e.jsx("label",{className:"ml-2 block text-xs text-gray-700",children:i})]},a)})})]})]})]})]})]})})]})}),e.jsx("div",{className:"bg-white shadow px-4 py-5 sm:rounded-lg sm:p-6",children:e.jsxs("div",{className:"md:grid md:grid-cols-3 md:gap-6",children:[e.jsxs("div",{className:"md:col-span-1",children:[e.jsx("h3",{className:"text-lg font-medium leading-6 text-gray-900",children:t("admin.apps.edit.magicPrompt","Magic Prompt")}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:t("admin.apps.edit.magicPromptDesc","AI-powered prompt enhancement feature")})]}),e.jsx("div",{className:"mt-5 md:col-span-2 md:mt-0",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:((ge=(xe=s.features)==null?void 0:xe.magicPrompt)==null?void 0:ge.enabled)||!1,onChange:a=>{var i;return n("features",{...s.features,magicPrompt:{...(i=s.features)==null?void 0:i.magicPrompt,enabled:a.target.checked}})},className:"h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded"}),e.jsx("label",{className:"ml-2 block text-sm text-gray-900",children:t("admin.apps.edit.enableMagicPrompt","Enable Magic Prompt")})]}),((fe=(he=s.features)==null?void 0:he.magicPrompt)==null?void 0:fe.enabled)&&e.jsxs("div",{className:"space-y-4 pl-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:t("admin.apps.edit.magicPromptModel","Magic Prompt Model")}),e.jsxs("select",{value:((je=(be=s.features)==null?void 0:be.magicPrompt)==null?void 0:je.model)||"",onChange:a=>{var i;return n("features",{...s.features,magicPrompt:{...(i=s.features)==null?void 0:i.magicPrompt,model:a.target.value||void 0}})},className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm",children:[e.jsx("option",{value:"",children:t("admin.apps.edit.selectModel","Select model...")}),C.map(a=>e.jsx("option",{value:a.id,children:ce(a.name,T)},a.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:t("admin.apps.edit.magicPromptInstructions","Magic Prompt Instructions")}),e.jsx("textarea",{value:((ve=(ye=s.features)==null?void 0:ye.magicPrompt)==null?void 0:ve.prompt)||"You are a helpful assistant that improves user prompts to be more specific and effective. Improve this prompt: {{prompt}}",onChange:a=>{var i;return n("features",{...s.features,magicPrompt:{...(i=s.features)==null?void 0:i.magicPrompt,prompt:a.target.value}})},rows:3,className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm",placeholder:"Enter instructions for the magic prompt feature..."}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:t("admin.apps.edit.magicPromptPlaceholder","Use {{prompt}} to reference the user's original prompt")})]})]})]})})]})}),e.jsx("div",{className:"bg-white shadow px-4 py-5 sm:rounded-lg sm:p-6",children:e.jsxs("div",{className:"md:grid md:grid-cols-3 md:gap-6",children:[e.jsxs("div",{className:"md:col-span-1",children:[e.jsx("h3",{className:"text-lg font-medium leading-6 text-gray-900",children:t("admin.apps.edit.inputMode","Input Mode & Microphone")}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:t("admin.apps.edit.inputModeDesc","Configure input methods and voice recognition")})]}),e.jsx("div",{className:"mt-5 md:col-span-2 md:mt-0",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:t("admin.apps.edit.inputType","Input Type")}),e.jsxs("select",{value:((Ne=s.inputMode)==null?void 0:Ne.type)||"multiline",onChange:a=>n("inputMode",{...s.inputMode,type:a.target.value}),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm",children:[e.jsx("option",{value:"singleline",children:t("admin.apps.edit.singleLine","Single Line")}),e.jsx("option",{value:"multiline",children:t("admin.apps.edit.multiLine","Multi Line")})]})]}),((we=s.inputMode)==null?void 0:we.type)==="multiline"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:t("admin.apps.edit.textareaRows","Textarea Rows")}),e.jsx("input",{type:"number",min:"1",max:"20",value:((ke=s.inputMode)==null?void 0:ke.rows)||5,onChange:a=>n("inputMode",{...s.inputMode,rows:parseInt(a.target.value)}),className:"mt-1 block w-20 rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm"})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center mb-2",children:[e.jsx("input",{type:"checkbox",checked:((Se=(Ce=s.inputMode)==null?void 0:Ce.microphone)==null?void 0:Se.enabled)!==!1,onChange:a=>{var i;return n("inputMode",{...s.inputMode,microphone:{...(i=s.inputMode)==null?void 0:i.microphone,enabled:a.target.checked}})},className:"h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded"}),e.jsx("label",{className:"ml-2 block text-sm font-medium text-gray-900",children:t("admin.apps.edit.enableMicrophone","Enable Microphone")})]}),((Ae=(Me=s.inputMode)==null?void 0:Me.microphone)==null?void 0:Ae.enabled)&&e.jsxs("div",{className:"space-y-3 pl-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:t("admin.apps.edit.microphoneMode","Microphone Mode")}),e.jsxs("select",{value:((Ee=(Fe=s.inputMode)==null?void 0:Fe.microphone)==null?void 0:Ee.mode)||"manual",onChange:a=>{var i;return n("inputMode",{...s.inputMode,microphone:{...(i=s.inputMode)==null?void 0:i.microphone,mode:a.target.value}})},className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm",children:[e.jsx("option",{value:"manual",children:t("admin.apps.edit.manualMode","Manual (Click to Record)")}),e.jsx("option",{value:"continuous",children:t("admin.apps.edit.continuousMode","Continuous (Voice Activation)")})]})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:((Te=(Pe=s.inputMode)==null?void 0:Pe.microphone)==null?void 0:Te.showTranscript)!==!1,onChange:a=>{var i;return n("inputMode",{...s.inputMode,microphone:{...(i=s.inputMode)==null?void 0:i.microphone,showTranscript:a.target.checked}})},className:"h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded"}),e.jsx("label",{className:"ml-2 block text-sm text-gray-900",children:t("admin.apps.edit.showTranscript","Show Transcript")})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:t("admin.apps.edit.speechRecognitionService","Speech Recognition Service")}),e.jsxs("select",{value:((Ue=(Ie=s.settings)==null?void 0:Ie.speechRecognition)==null?void 0:Ue.service)||"default",onChange:a=>{var i;return n("settings",{...s.settings,speechRecognition:{...(i=s.settings)==null?void 0:i.speechRecognition,service:a.target.value}})},className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm",children:[e.jsx("option",{value:"default",children:t("admin.apps.edit.defaultService","Default (Browser)")}),e.jsx("option",{value:"custom",children:t("admin.apps.edit.customService","Custom Service")})]})]}),((Re=(Le=s.settings)==null?void 0:Le.speechRecognition)==null?void 0:Re.service)==="custom"&&e.jsxs("div",{className:"pl-6",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:t("admin.apps.edit.customServiceHost","Custom Service Host")}),e.jsx("input",{type:"url",value:((De=(Ve=s.settings)==null?void 0:Ve.speechRecognition)==null?void 0:De.host)||"",onChange:a=>{var i;return n("settings",{...s.settings,speechRecognition:{...(i=s.settings)==null?void 0:i.speechRecognition,host:a.target.value}})},placeholder:"https://your-speech-service.com",className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm"})]})]})})]})}),e.jsx("div",{className:"bg-white shadow px-4 py-5 sm:rounded-lg sm:p-6",children:e.jsxs("div",{className:"md:grid md:grid-cols-3 md:gap-6",children:[e.jsxs("div",{className:"md:col-span-1",children:[e.jsx("h3",{className:"text-lg font-medium leading-6 text-gray-900",children:t("admin.apps.edit.sources","Sources Configuration")}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:t("admin.apps.edit.sourcesDesc","Configure data sources that provide content to this app")})]}),e.jsx("div",{className:"mt-5 md:col-span-2 md:mt-0",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 mb-4",children:t("admin.apps.edit.sourcesDesc","Select data sources configured in the admin interface to provide content to this app")}),e.jsx(gs,{value:s.sources||[],onChange:K,allowMultiple:!0,className:"mb-4"})]}),s.sources&&s.sources.length>0&&e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-md p-4",children:e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx(F,{name:"information-circle",className:"h-5 w-5 text-blue-400"})}),e.jsxs("div",{className:"ml-3",children:[e.jsx("h3",{className:"text-sm font-medium text-blue-800",children:t("admin.apps.edit.sourcesConfigured","Sources Configured")}),e.jsxs("div",{className:"mt-2 text-sm text-blue-700",children:[e.jsx("p",{children:t("admin.apps.edit.sourcesCount","This app has {{count}} source(s) configured:",{count:s.sources.length})}),e.jsx("ul",{className:"list-disc list-inside mt-1 space-y-1",children:s.sources.map((a,i)=>e.jsx("li",{children:e.jsx("span",{className:"font-mono text-xs bg-blue-100 px-1 rounded",children:a})},`source-${i}`))}),e.jsx("p",{className:"mt-2 text-xs",children:t("admin.apps.edit.sourcesUsage","Sources will be loaded and their content made available via {{sources}} template in system prompts.")})]})]})]})})]})})]})}),e.jsx("div",{className:"bg-white shadow px-4 py-5 sm:rounded-lg sm:p-6",children:e.jsxs("div",{className:"md:grid md:grid-cols-3 md:gap-6",children:[e.jsxs("div",{className:"md:col-span-1",children:[e.jsx("h3",{className:"text-lg font-medium leading-6 text-gray-900",children:t("admin.apps.edit.settings","User Settings")}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:t("admin.apps.edit.settingsDesc","Configure which settings users can modify")})]}),e.jsx("div",{className:"mt-5 md:col-span-2 md:mt-0",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:((ze=(Oe=s.settings)==null?void 0:Oe.model)==null?void 0:ze.enabled)!==!1,onChange:a=>n("settings",{...s.settings,model:{enabled:a.target.checked}}),className:"h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded"}),e.jsx("label",{className:"ml-2 block text-sm text-gray-900",children:t("admin.apps.edit.enableModelSelection","Enable Model Selection")})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:(($e=(qe=s.settings)==null?void 0:qe.temperature)==null?void 0:$e.enabled)!==!1,onChange:a=>n("settings",{...s.settings,temperature:{enabled:a.target.checked}}),className:"h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded"}),e.jsx("label",{className:"ml-2 block text-sm text-gray-900",children:t("admin.apps.edit.enableTemperatureControl","Enable Temperature Control")})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:((Be=(He=s.settings)==null?void 0:He.outputFormat)==null?void 0:Be.enabled)!==!1,onChange:a=>n("settings",{...s.settings,outputFormat:{enabled:a.target.checked}}),className:"h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded"}),e.jsx("label",{className:"ml-2 block text-sm text-gray-900",children:t("admin.apps.edit.enableOutputFormat","Enable Output Format Selection")})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:((We=(Je=s.settings)==null?void 0:Je.chatHistory)==null?void 0:We.enabled)!==!1,onChange:a=>n("settings",{...s.settings,chatHistory:{enabled:a.target.checked}}),className:"h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded"}),e.jsx("label",{className:"ml-2 block text-sm text-gray-900",children:t("admin.apps.edit.enableChatHistory","Enable Chat History Control")})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:((Ke=(_e=s.settings)==null?void 0:_e.style)==null?void 0:Ke.enabled)!==!1,onChange:a=>n("settings",{...s.settings,style:{enabled:a.target.checked}}),className:"h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded"}),e.jsx("label",{className:"ml-2 block text-sm text-gray-900",children:t("admin.apps.edit.enableStyleControl","Enable Style Control")})]})]})})]})})]})]}):e.jsxs("div",{className:"p-8 text-center text-gray-500",children:[e.jsx(F,{name:"exclamation-triangle",className:"h-12 w-12 mx-auto mb-4 text-gray-400"}),e.jsx("p",{className:"text-lg font-medium",children:t("admin.apps.edit.noAppData","No app data available")})]})},Is=()=>{const{t:s,i18n:h}=re();h.language;const{appId:f}=is(),C=ls(),[p,N]=o.useState(null),[t,E]=o.useState(!0),[T,b]=o.useState(!1),[L,k]=o.useState(null),[n,c]=o.useState([]),[S,I]=o.useState(null),[R,$]=o.useState(null),[r,w]=o.useState("form"),[U,z]=o.useState({isValid:!0,errors:[]});o.useEffect(()=>{const v=async()=>{try{const g=await as();c(g)}catch(g){console.error("Failed to load models:",g)}},u=async()=>{try{const g=await ts();I(g)}catch(g){console.error("Failed to load UI config:",g)}},x=async()=>{try{const g=await cs("app");$(g)}catch(g){console.error("Failed to load app JSON schema:",g)}};v(),u(),x()},[]),o.useEffect(()=>{f==="new"?(N({id:"",type:"chat",order:0,name:{en:""},description:{en:""},color:"#4F46E5",icon:"chat-bubbles",system:{en:""},tokenLimit:4096,preferredModel:void 0,preferredOutputFormat:"markdown",preferredStyle:"keep",preferredTemperature:.7,enabled:!0,variables:[],starterPrompts:[],tools:[],greeting:{en:{title:"ðŸ‘‹ Hello!",subtitle:"How can I help you today?"},de:{title:"ðŸ‘‹ Hallo!",subtitle:"Wie kann ich Ihnen heute helfen?"}},allowEmptyContent:!1,sendChatHistory:!0,category:"utility",inputMode:{type:"singleline",rows:5,microphone:{enabled:!0,mode:"manual",showTranscript:!0}},upload:{enabled:!1,imageUpload:{enabled:!1,resizeImages:!0,maxFileSizeMB:10,supportedFormats:["image/jpeg","image/jpg","image/png","image/gif","image/webp"]},fileUpload:{enabled:!1,maxFileSizeMB:5,supportedFormats:["text/plain","text/markdown","text/csv","application/json","text/html","text/css","text/javascript","application/javascript","text/xml","message/rfc822","application/pdf","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/vnd.ms-outlook","application/vnd.oasis.opendocument.text","application/vnd.oasis.opendocument.spreadsheet","application/vnd.oasis.opendocument.presentation"]}}}),E(!1)):J()},[f]);const J=o.useCallback(async()=>{var v,u,x,g,W,H,X,Q,G,Y,Z,ee,se,ae,te;try{E(!0);const M=(await Qe(`/admin/apps/${f}`)).data,le={...M,tools:M.tools||[],greeting:M.greeting||{en:{title:"ðŸ‘‹ Hello!",subtitle:"How can I help you today?"},de:{title:"ðŸ‘‹ Hallo!",subtitle:"Wie kann ich Ihnen heute helfen?"}},allowEmptyContent:M.allowEmptyContent??!1,sendChatHistory:M.sendChatHistory??!0,inputMode:{type:"singleline",rows:5,microphone:{enabled:!0,mode:"manual",showTranscript:!0},...M.inputMode||{}},upload:{enabled:((v=M.upload)==null?void 0:v.enabled)||!1,imageUpload:{enabled:((x=(u=M.upload)==null?void 0:u.imageUpload)==null?void 0:x.enabled)||!1,resizeImages:((W=(g=M.upload)==null?void 0:g.imageUpload)==null?void 0:W.resizeImages)??!0,maxFileSizeMB:((X=(H=M.upload)==null?void 0:H.imageUpload)==null?void 0:X.maxFileSizeMB)||10,supportedFormats:((G=(Q=M.upload)==null?void 0:Q.imageUpload)==null?void 0:G.supportedFormats)||["image/jpeg","image/jpg","image/png","image/gif","image/webp"]},fileUpload:{enabled:((Z=(Y=M.upload)==null?void 0:Y.fileUpload)==null?void 0:Z.enabled)||!1,maxFileSizeMB:((se=(ee=M.upload)==null?void 0:ee.fileUpload)==null?void 0:se.maxFileSizeMB)||5,supportedFormats:((te=(ae=M.upload)==null?void 0:ae.fileUpload)==null?void 0:te.supportedFormats)||["text/plain","text/markdown","text/csv","application/json","text/html","text/css","text/javascript","application/javascript","text/xml","message/rfc822","application/pdf","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/vnd.ms-outlook","application/vnd.oasis.opendocument.text","application/vnd.oasis.opendocument.spreadsheet","application/vnd.oasis.opendocument.presentation"]},...M.upload||{}}};N(le)}catch(ie){k(ie.message)}finally{E(!1)}},[f]),K=v=>{const u={...v};if(u.variables&&(u.variables=u.variables.map(x=>{const g={...x};return g.defaultValue&&(Object.values(g.defaultValue).some(H=>H&&H!=="")||delete g.defaultValue),g.predefinedValues&&g.predefinedValues.length===0&&delete g.predefinedValues,g})),u.upload){const x={...u.upload};x.imageUpload&&x.imageUpload.enabled===!1&&delete x.imageUpload,x.fileUpload&&x.fileUpload.enabled===!1&&delete x.fileUpload,x.enabled===!1?delete u.upload:u.upload=x}if(u.features){const x={...u.features};x.magicPrompt&&x.magicPrompt.enabled===!1&&delete x.magicPrompt,Object.keys(x).length===0?delete u.features:u.features=x}return u},B=async v=>{if(v.preventDefault(),!U.isValid){k(s("admin.apps.edit.validationErrorsExist","Please fix validation errors before saving"));return}if(!p.id){k("App ID is required");return}try{b(!0);const u=f==="new"?"POST":"PUT",x=f==="new"?"/admin/apps":`/admin/apps/${f}`,g=K(p);await Qe(x,{method:u,body:JSON.stringify(g)}),C("/admin/apps")}catch(u){k(u.message)}finally{b(!1)}},l=v=>{N(v)},j=v=>{z(v)},P=v=>{w(v)};return t?e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600 mx-auto"}),e.jsx("p",{className:"mt-2 text-gray-600",children:s("admin.apps.loading","Loading...")})]})}):L?e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-md p-4",children:e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("svg",{className:"h-5 w-5 text-red-400",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"})})}),e.jsxs("div",{className:"ml-3",children:[e.jsx("h3",{className:"text-sm font-medium text-red-800",children:s("admin.apps.errorTitle","Error")}),e.jsx("div",{className:"mt-2 text-sm text-red-700",children:L}),e.jsx("button",{type:"button",onClick:()=>k(null),className:"mt-2 text-sm text-red-600 hover:text-red-500 underline",children:s("common.dismiss","Dismiss")})]})]})})}):e.jsxs(ms,{children:[e.jsx(ps,{}),e.jsxs("div",{className:"max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[e.jsxs("div",{className:"sm:flex sm:items-center",children:[e.jsxs("div",{className:"sm:flex-auto",children:[e.jsx("h1",{className:"text-2xl font-semibold text-gray-900",children:f==="new"?s("admin.apps.edit.titleNew","Add New App"):s("admin.apps.edit.titleEdit","Edit App")}),e.jsx("p",{className:"mt-2 text-sm text-gray-700",children:f==="new"?s("admin.apps.edit.subtitleNew","Configure a new iHub application"):s("admin.apps.edit.subtitleEdit","Modify app settings and configuration")})]}),e.jsx("div",{className:"mt-4 sm:mt-0 sm:ml-16 sm:flex-none",children:e.jsxs("div",{className:"flex space-x-3",children:[f!=="new"&&e.jsxs("button",{type:"button",onClick:()=>{const v=JSON.stringify(p,null,2),u="data:application/json;charset=utf-8,"+encodeURIComponent(v),x=`app-${p.id}.json`,g=document.createElement("a");g.setAttribute("href",u),g.setAttribute("download",x),g.click()},className:"inline-flex items-center justify-center rounded-md border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 shadow-sm hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 sm:w-auto",children:[e.jsx(F,{name:"download",className:"w-4 h-4 mr-2"}),s("common.download")]}),e.jsx("button",{type:"button",className:"inline-flex items-center justify-center rounded-md border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 shadow-sm hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 sm:w-auto",onClick:()=>C("/admin/apps"),children:s("admin.apps.edit.back","Back to Apps")})]})})]}),e.jsxs("form",{onSubmit:B,className:"mt-8",children:[e.jsx(ns,{value:p,onChange:l,formComponent:fs,formProps:{availableModels:n,uiConfig:S,jsonSchema:R},jsonSchema:R,defaultMode:r,onModeChange:P,onValidationChange:j,title:f==="new"?s("admin.apps.edit.configureNewApp","Configure New App"):s("admin.apps.edit.editAppConfig","Edit App Configuration"),description:f==="new"?s("admin.apps.edit.configureNewAppDesc","Set up the configuration for your new iHub app using the form interface or JSON editor."):s("admin.apps.edit.editAppConfigDesc","Modify the app configuration using the form interface or raw JSON editor."),showValidationSummary:!0,className:"mb-6"}),e.jsxs("div",{className:"flex justify-end space-x-3",children:[e.jsx("button",{type:"button",onClick:()=>C("/admin/apps"),className:"bg-white py-2 px-4 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500",children:s("admin.apps.edit.cancel","Cancel")}),e.jsx("button",{type:"submit",disabled:T||!U.isValid,className:"inline-flex justify-center py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 disabled:opacity-50 disabled:cursor-not-allowed",children:T?e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),s("admin.apps.edit.saving","Saving...")]}):e.jsxs("div",{className:"flex items-center",children:[e.jsx(F,{name:"check",className:"h-4 w-4 mr-2"}),s("admin.apps.edit.save","Save App")]})})]})]})]})]})};export{Is as default};
