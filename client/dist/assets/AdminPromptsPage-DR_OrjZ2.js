import{u as O,j as e,I as d,g as p,i as Z}from"./index-CdJiYb_a.js";import{e as I,r as x}from"./vendor-react-9AdXaApd.js";import{A as _}from"./AdminAuth-w86Ms2_j.js";import{A as ee}from"./AdminNavigation-CghX6zwW.js";import{k as se,m as k,l as $}from"./adminApi-DCK2UDnY.js";import"./mermaid-DechTdnA.js";import"./vendor-utils-CF1RCcgi.js";import"./teams-CwMtNG0x.js";import"./vendor-ui-lZiltAcz.js";import"./vendor-forms-DyVXvDXu.js";const te=({prompt:t,isOpen:y,onClose:o})=>{const{t:r,i18n:P}=O(),N=P.language,A=I();if(x.useEffect(()=>{if(!y)return;const n=c=>{c.key==="Escape"&&o()};return window.addEventListener("keydown",n),()=>window.removeEventListener("keydown",n)},[y,o]),!y||!t)return null;const u=n=>p(n,N);return e.jsx("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"relative bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"sticky top-0 bg-white border-b border-gray-200 px-6 py-4 flex items-center justify-between rounded-t-lg",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-lg bg-indigo-100 flex items-center justify-center",children:e.jsx(d,{name:t.icon||"clipboard",className:"w-6 h-6 text-indigo-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:u(t.name)}),e.jsx("p",{className:"text-sm text-gray-500",children:t.id})]})]}),e.jsx("button",{onClick:o,className:"p-2 text-gray-400 hover:text-gray-600 rounded-lg hover:bg-gray-100",children:e.jsx(d,{name:"x",className:"w-5 h-5"})})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:r("admin.prompts.details.status","Status")}),e.jsx("span",{className:`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${t.enabled!==!1?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:t.enabled!==!1?r("admin.prompts.status.enabled","Enabled"):r("admin.prompts.status.disabled","Disabled")})]}),t.description&&e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700 mb-2",children:r("admin.prompts.details.description","Description")}),e.jsx("p",{className:"text-sm text-gray-600 leading-relaxed",children:u(t.description)})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700 mb-2",children:r("admin.prompts.details.promptContent","Prompt Content")}),e.jsx("div",{className:"bg-gray-50 rounded-lg p-3 max-h-60 overflow-y-auto",children:e.jsx("p",{className:"text-sm text-gray-600 leading-relaxed whitespace-pre-wrap",children:u(t.prompt)})})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700 mb-3",children:r("admin.prompts.details.technicalDetails","Technical Details")}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-gray-50 rounded-lg p-3",children:[e.jsx("div",{className:"text-xs font-medium text-gray-500 uppercase tracking-wide",children:r("admin.prompts.details.order","Order")}),e.jsx("div",{className:"text-sm text-gray-900 mt-1",children:t.order!==void 0?t.order:r("common.notSet","Not set")})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-3",children:[e.jsx("div",{className:"text-xs font-medium text-gray-500 uppercase tracking-wide",children:r("admin.prompts.details.linkedApp","Linked App")}),e.jsx("div",{className:"text-sm text-gray-900 mt-1",children:t.appId||r("common.none","None")})]})]})]}),t.variables&&t.variables.length>0&&e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700 mb-3",children:r("admin.prompts.details.variables","Variables")}),e.jsx("div",{className:"space-y-2",children:t.variables.map((n,c)=>e.jsxs("div",{className:"bg-gray-50 rounded-lg p-3",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-indigo-100 text-indigo-800",children:n.name}),e.jsx("span",{className:"text-xs text-gray-500",children:n.type}),n.required&&e.jsx("span",{className:"text-xs text-red-500",children:r("common.required","required")})]})}),e.jsx("div",{className:"text-sm text-gray-600 mt-1",children:u(n.label)}),n.defaultValue&&e.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:[r("common.default","Default"),": ",n.defaultValue]})]},c))})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700 mb-3",children:r("admin.prompts.details.availableLanguages","Available Languages")}),e.jsx("div",{className:"flex flex-wrap gap-2",children:Object.keys(t.name||{}).map(n=>e.jsx("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800",children:n.toUpperCase()},n))})]})]}),e.jsxs("div",{className:"sticky bottom-0 bg-gray-50 border-t border-gray-200 px-6 py-4 flex justify-between items-center rounded-b-lg",children:[e.jsxs("button",{onClick:()=>{A(`/admin/prompts/${t.id}`),o()},className:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500",children:[e.jsx(d,{name:"pencil",className:"w-4 h-4 mr-2"}),r("admin.prompts.details.editPrompt","Edit Prompt")]}),e.jsx("button",{onClick:o,className:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500",children:r("admin.prompts.details.close","Close")})]})]})})},ge=()=>{var D,U;const{t,i18n:y}=O(),o=y.language,r=I(),[P,N]=x.useState([]),[A,u]=x.useState(!0),[n,c]=x.useState(null),[h,T]=x.useState(""),[w,F]=x.useState("all"),[v,R]=x.useState("all"),[q,J]=x.useState(null),[V,E]=x.useState(!1),[g,z]=x.useState(null),[b,L]=x.useState(!1);x.useEffect(()=>{f(),B()},[]);const B=async()=>{try{const s=await Z();z(s)}catch(s){console.error("Failed to load UI config:",s)}},f=async()=>{try{u(!0),c(null);const s=await se(),a=Array.isArray(s)?s:[];N(a),a.length===0&&console.warn("No prompts returned from API")}catch(s){console.error("Error loading prompts:",s),c(s.message),N([])}finally{u(!1)}},G=async s=>{try{await k(`/admin/prompts/${s}/toggle`,{method:"POST"}),await f()}catch(a){c(a.message)}},H=async()=>{try{await $("*",!0),await f()}catch(s){c(s.message)}},K=async()=>{try{await $("*",!1),await f()}catch(s){c(s.message)}},M=async s=>{if(confirm(t("admin.prompts.deleteConfirm","Are you sure you want to delete this prompt?")))try{await k(`/admin/prompts/${s}`,{method:"DELETE"}),await f(),alert(t("admin.prompts.deleteSuccess","Prompt deleted successfully"))}catch(a){console.error("Error deleting prompt:",a),alert(a.message||"Failed to delete prompt")}},W=s=>{r("/admin/prompts/new",{state:{templatePrompt:s}})},Q=s=>{J(s),E(!0)},X=async s=>{try{const i=(await k(`/admin/prompts/${s}`)).data,m=JSON.stringify(i,null,2),C=new Blob([m],{type:"application/json"}),l=URL.createObjectURL(C),j=document.createElement("a");j.href=l,j.download=`prompt-${s}.json`,document.body.appendChild(j),j.click(),document.body.removeChild(j),URL.revokeObjectURL(l)}catch(a){c(`Failed to download prompt config: ${a.message}`)}},Y=async s=>{const a=s.target.files[0];if(!a)return;if(!a.name.endsWith(".json")){c("Please select a JSON file");return}L(!0);let i;try{const m=await a.text();if(i=JSON.parse(m),!i.id||!i.name||!i.prompt)throw new Error("Invalid prompt config: missing required fields (id, name, prompt)");await k("/admin/prompts",{method:"POST",body:i}),await f(),s.target.value=""}catch(m){m.message.includes("already exists")?c(`Prompt with ID "${(i==null?void 0:i.id)||"unknown"}" already exists`):m instanceof SyntaxError?c("Invalid JSON file format"):c(`Failed to upload prompt config: ${m.message}`)}finally{L(!1)}},S=[...P.filter(s=>{const a=h===""||p(s.name,o).toLowerCase().includes(h.toLowerCase())||p(s.prompt,o).toLowerCase().includes(h.toLowerCase())||s.description&&p(s.description,o).toLowerCase().includes(h.toLowerCase())||s.id.toLowerCase().includes(h.toLowerCase()),i=w==="all"||w==="enabled"&&s.enabled!==!1||w==="disabled"&&s.enabled===!1,m=v==="all"||(s.category||"creative")===v;return a&&i&&m})].sort((s,a)=>{if(s.order!==void 0&&a.order!==void 0)return s.order-a.order;if(s.order!==void 0)return-1;if(a.order!==void 0)return 1;const i=p(s.name,o),m=p(a.name,o);return i.localeCompare(m)});return A?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-600"})}):n?e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-md p-4",children:e.jsxs("div",{className:"flex",children:[e.jsx(d,{name:"exclamation-triangle",className:"h-5 w-5 text-red-400"}),e.jsxs("div",{className:"ml-3",children:[e.jsx("h3",{className:"text-sm font-medium text-red-800",children:t("admin.prompts.loadError","Error loading prompts")}),e.jsx("p",{className:"mt-1 text-sm text-red-700",children:n}),e.jsx("button",{onClick:()=>window.location.reload(),className:"mt-2 text-sm text-red-600 hover:text-red-500",children:t("common.retry","Retry")})]})]})}):e.jsx(_,{children:e.jsxs("div",{children:[e.jsx(ee,{}),e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[e.jsxs("div",{className:"sm:flex sm:items-center",children:[e.jsxs("div",{className:"sm:flex-auto",children:[e.jsx("h1",{className:"text-2xl font-semibold text-gray-900",children:t("admin.prompts.title","Prompt Management")}),e.jsx("p",{className:"mt-2 text-sm text-gray-700",children:t("admin.prompts.subtitle","Create, edit, and manage prompts for your iHub Apps")})]}),e.jsx("div",{className:"mt-4 sm:mt-0 sm:ml-16 sm:flex-none",children:e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs("button",{onClick:()=>r("/admin/prompts/new"),className:"inline-flex items-center justify-center rounded-md border border-transparent bg-indigo-600 px-4 py-2 text-sm font-medium text-white shadow-sm hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 sm:w-auto",children:[e.jsx(d,{name:"plus",className:"h-4 w-4 mr-2"}),t("admin.prompts.createNew","Create New Prompt")]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"file",accept:".json",onChange:Y,className:"absolute inset-0 w-full h-full opacity-0 cursor-pointer",disabled:b}),e.jsxs("button",{type:"button",className:"inline-flex items-center justify-center rounded-md border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 shadow-sm hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed",disabled:b,title:t("admin.prompts.uploadConfig","Upload Prompt Config"),children:[e.jsx(d,{name:b?"refresh":"upload",className:`h-4 w-4 mr-2 ${b?"animate-spin":""}`}),b?t("admin.prompts.uploading","Uploading..."):t("admin.prompts.uploadConfig","Upload Config")]})]}),e.jsx("button",{type:"button",className:"inline-flex items-center justify-center rounded-md border border-gray-300 bg-white px-3 py-2 text-sm font-medium text-gray-700 shadow-sm hover:bg-gray-50",onClick:H,children:t("admin.common.enableAll","Enable All")}),e.jsx("button",{type:"button",className:"inline-flex items-center justify-center rounded-md border border-gray-300 bg-white px-3 py-2 text-sm font-medium text-gray-700 shadow-sm hover:bg-gray-50",onClick:K,children:t("admin.common.disableAll","Disable All")})]})})]}),e.jsxs("div",{className:"mt-8 flex flex-col sm:flex-row gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(d,{name:"search",className:"h-5 w-5 text-gray-400"})}),e.jsx("input",{type:"text",className:"block w-full pl-10 pr-3 py-2 border border-gray-300 rounded-md leading-5 bg-white placeholder-gray-500 focus:outline-none focus:placeholder-gray-400 focus:ring-1 focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm",placeholder:t("admin.prompts.searchPlaceholder","Search prompts..."),value:h,onChange:s=>T(s.target.value)})]})}),e.jsx("div",{className:"sm:w-48",children:e.jsxs("select",{value:w,onChange:s=>F(s.target.value),className:"block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm",children:[e.jsx("option",{value:"all",children:t("admin.prompts.filterAll","All Prompts")}),e.jsx("option",{value:"enabled",children:t("admin.prompts.filterEnabled","Enabled Only")}),e.jsx("option",{value:"disabled",children:t("admin.prompts.filterDisabled","Disabled Only")})]})})]}),((U=(D=g==null?void 0:g.promptsList)==null?void 0:D.categories)==null?void 0:U.enabled)&&e.jsx("div",{className:"mt-4 flex flex-wrap gap-2 justify-center",children:g.promptsList.categories.list.map(s=>e.jsx("button",{onClick:()=>R(s.id),className:`px-4 py-2 rounded-full text-sm font-medium transition-all ${v===s.id?"text-white shadow-lg transform scale-105":"text-gray-600 bg-gray-100 hover:bg-gray-200"}`,style:{backgroundColor:v===s.id?s.color:void 0},children:p(s.name,o)},s.id))}),e.jsx("div",{className:"mt-8 flex flex-col",children:e.jsx("div",{className:"-my-2 -mx-4 sm:-mx-6 lg:-mx-8",children:e.jsx("div",{className:"inline-block w-full py-2 align-middle md:px-6 lg:px-8",children:e.jsx("div",{className:"overflow-hidden shadow ring-1 ring-black ring-opacity-5 md:rounded-lg",children:e.jsxs("table",{className:"w-full divide-y divide-gray-300",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:t("admin.prompts.table.name","Name")}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:t("admin.prompts.table.category","Category")}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:t("admin.prompts.table.description","Description")}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:t("admin.prompts.table.order","Order")}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:t("admin.prompts.table.appConnected","App Connected")}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:t("admin.prompts.table.status","Status")}),e.jsx("th",{scope:"col",className:"relative px-6 py-3",children:e.jsx("span",{className:"sr-only",children:t("admin.prompts.table.actions","Actions")})})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:S.map(s=>{var a,i,m,C;return e.jsxs("tr",{className:"hover:bg-gray-50 cursor-pointer",onClick:()=>Q(s),children:[e.jsx("td",{className:"px-6 py-4 ",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0 h-8 w-8",children:e.jsx("div",{className:"h-8 w-8 rounded-full bg-indigo-100 flex items-center justify-center",children:e.jsx(d,{name:s.icon||"clipboard",className:"h-4 w-4 text-indigo-600"})})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:p(s.name,o)}),e.jsx("div",{className:"text-sm text-gray-500",children:s.id})]})]})}),e.jsx("td",{className:"px-6 py-4 ",children:s.category?e.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-purple-100 text-purple-800",children:(C=(m=(i=(a=g==null?void 0:g.promptsList)==null?void 0:a.categories)==null?void 0:i.list)==null?void 0:m.find(l=>l.id===s.category))!=null&&C.name?p(g.promptsList.categories.list.find(l=>l.id===s.category).name,o):s.category}):e.jsx("span",{className:"text-gray-400 text-sm",children:t("common.notAvailable","N/A")})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("div",{className:"text-sm text-gray-900 max-w-xs truncate",children:s.description?p(s.description,o):"-"})}),e.jsx("td",{className:"px-6 py-4  text-sm text-gray-900",children:s.order!==void 0?s.order:"-"}),e.jsx("td",{className:"px-6 py-4  text-sm text-gray-900",children:s.appId?e.jsx("div",{className:"flex items-center justify-center",children:e.jsx(d,{name:"check",className:"h-5 w-5 text-green-600"})}):e.jsx("div",{className:"flex items-center justify-center",children:e.jsx("span",{className:"text-gray-400",children:"-"})})}),e.jsx("td",{className:"px-6 py-4 ",children:e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${s.enabled!==!1?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"}`,children:s.enabled!==!1?t("admin.prompts.enabled","Enabled"):t("admin.prompts.disabled","Disabled")})}),e.jsx("td",{className:"px-6 py-4  text-right text-sm font-medium",children:e.jsxs("div",{className:"flex items-center justify-end space-x-2",children:[e.jsx("button",{onClick:l=>{l.stopPropagation(),G(s.id)},className:`p-2 rounded-full ${s.enabled!==!1?"text-red-600 hover:bg-red-50":"text-green-600 hover:bg-green-50"}`,title:s.enabled!==!1?t("admin.prompts.disable","Disable"):t("admin.prompts.enable","Enable"),children:e.jsx(d,{name:s.enabled!==!1?"eye-slash":"eye",className:"h-4 w-4"})}),e.jsx("button",{onClick:l=>{l.stopPropagation(),W(s)},className:"p-2 text-blue-600 hover:bg-blue-50 rounded-full",title:t("admin.prompts.clone","Clone"),children:e.jsx(d,{name:"copy",className:"h-4 w-4"})}),e.jsx("button",{onClick:l=>{l.stopPropagation(),X(s.id)},className:"p-2 text-green-600 hover:bg-green-50 rounded-full",title:t("admin.prompts.download","Download Config"),children:e.jsx(d,{name:"download",className:"h-4 w-4"})}),e.jsx("button",{onClick:l=>{l.stopPropagation(),r(`/admin/prompts/${s.id}`)},className:"p-2 text-indigo-600 hover:bg-indigo-50 rounded-full",title:t("admin.prompts.edit","Edit"),children:e.jsx(d,{name:"pencil",className:"h-4 w-4"})}),e.jsx("button",{onClick:l=>{l.stopPropagation(),M(s.id)},className:"p-2 text-red-600 hover:bg-red-50 rounded-full",title:t("admin.prompts.delete","Delete"),children:e.jsx(d,{name:"trash",className:"h-4 w-4"})})]})})]},s.id)})})]})})})})}),S.length===0&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(d,{name:"clipboard",className:"mx-auto h-12 w-12 text-gray-400"}),e.jsx("h3",{className:"mt-2 text-sm font-medium text-gray-900",children:t("admin.prompts.noPrompts","No prompts found")}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:t("admin.prompts.noPromptsDesc","Get started by creating a new prompt.")}),e.jsx("div",{className:"mt-6",children:e.jsxs("button",{onClick:()=>r("/admin/prompts/new"),className:"inline-flex items-center px-4 py-2 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500",children:[e.jsx(d,{name:"plus",className:"h-4 w-4 mr-2"}),t("admin.prompts.createNew","Create New Prompt")]})})]}),e.jsx(te,{prompt:q,isOpen:V,onClose:()=>E(!1)})]})]})})};export{ge as default};
